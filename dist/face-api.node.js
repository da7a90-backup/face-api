/*
  Face-API
  homepage: <https://github.com/vladmandic/face-api>
  author: <https://github.com/vladmandic>'
*/

var ln=Object.defineProperty;var Do=(n,t,e)=>t in n?ln(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Xt=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var kr=(n,t)=>{for(var e in t)ln(n,e,{get:t[e],enumerable:!0})};var mn=(n,t,e)=>(Do(n,typeof t!="symbol"?t+"":t,e),e);var m={};kr(m,{default:()=>ai,version:()=>ri});import{Readable as Jo}from"stream";var So=Object.create,un=Object.defineProperty,Mo=Object.getOwnPropertyDescriptor,Lo=Object.getOwnPropertyNames,Ro=Object.getPrototypeOf,Co=Object.prototype.hasOwnProperty,U=(n=>typeof Xt<"u"?Xt:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof Xt<"u"?Xt:t)[e]}):n)(function(n){if(typeof Xt<"u")return Xt.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')}),Y=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Io=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Lo(t))!Co.call(n,i)&&i!==e&&un(n,i,{get:()=>t[i],enumerable:!(r=Mo(t,i))||r.enumerable});return n},ko=(n,t,e)=>(e=n!=null?So(Ro(n)):{},Io(t||!n||!n.__esModule?un(e,"default",{value:n,enumerable:!0}):e,n)),Ie=Y((n,t)=>{"use strict";var e=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"]]),r=t.exports=i=>i?Object.keys(i).map(a=>[e.has(a)?e.get(a):a,i[a]]).reduce((a,s)=>(a[s[0]]=s[1],a),Object.create(null)):{}}),qe=Y((n,t)=>{var e=U("buffer"),r=e.Buffer;function i(s,o){for(var l in s)o[l]=s[l]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=e:(i(e,n),n.Buffer=a);function a(s,o,l){return r(s,o,l)}a.prototype=Object.create(r.prototype),i(r,a),a.from=function(s,o,l){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,o,l)},a.alloc=function(s,o,l){if(typeof s!="number")throw new TypeError("Argument must be a number");var c=r(s);return o!==void 0?typeof l=="string"?c.fill(o,l):c.fill(o):c.fill(0),c},a.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},a.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return e.SlowBuffer(s)}}),qt=Y((n,t)=>{"use strict";var e=Buffer;e.alloc||(e=qe().Buffer),t.exports=e}),Ao=Y((n,t)=>{"use strict";t.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let r=this.head;r;r=r.next)yield r.value}}}),ke=Y((n,t)=>{"use strict";t.exports=e,e.Node=s,e.create=e;function e(o){var l=this;if(l instanceof e||(l=new e),l.tail=null,l.head=null,l.length=0,o&&typeof o.forEach=="function")o.forEach(function(d){l.push(d)});else if(arguments.length>0)for(var c=0,p=arguments.length;c<p;c++)l.push(arguments[c]);return l}e.prototype.removeNode=function(o){if(o.list!==this)throw new Error("removing node which does not belong to this list");var l=o.next,c=o.prev;return l&&(l.prev=c),c&&(c.next=l),o===this.head&&(this.head=l),o===this.tail&&(this.tail=c),o.list.length--,o.next=null,o.prev=null,o.list=null,l},e.prototype.unshiftNode=function(o){if(o!==this.head){o.list&&o.list.removeNode(o);var l=this.head;o.list=this,o.next=l,l&&(l.prev=o),this.head=o,this.tail||(this.tail=o),this.length++}},e.prototype.pushNode=function(o){if(o!==this.tail){o.list&&o.list.removeNode(o);var l=this.tail;o.list=this,o.prev=l,l&&(l.next=o),this.tail=o,this.head||(this.head=o),this.length++}},e.prototype.push=function(){for(var o=0,l=arguments.length;o<l;o++)i(this,arguments[o]);return this.length},e.prototype.unshift=function(){for(var o=0,l=arguments.length;o<l;o++)a(this,arguments[o]);return this.length},e.prototype.pop=function(){if(this.tail){var o=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,o}},e.prototype.shift=function(){if(this.head){var o=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,o}},e.prototype.forEach=function(o,l){l=l||this;for(var c=this.head,p=0;c!==null;p++)o.call(l,c.value,p,this),c=c.next},e.prototype.forEachReverse=function(o,l){l=l||this;for(var c=this.tail,p=this.length-1;c!==null;p--)o.call(l,c.value,p,this),c=c.prev},e.prototype.get=function(o){for(var l=0,c=this.head;c!==null&&l<o;l++)c=c.next;if(l===o&&c!==null)return c.value},e.prototype.getReverse=function(o){for(var l=0,c=this.tail;c!==null&&l<o;l++)c=c.prev;if(l===o&&c!==null)return c.value},e.prototype.map=function(o,l){l=l||this;for(var c=new e,p=this.head;p!==null;)c.push(o.call(l,p.value,this)),p=p.next;return c},e.prototype.mapReverse=function(o,l){l=l||this;for(var c=new e,p=this.tail;p!==null;)c.push(o.call(l,p.value,this)),p=p.prev;return c},e.prototype.reduce=function(o,l){var c,p=this.head;if(arguments.length>1)c=l;else if(this.head)p=this.head.next,c=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var d=0;p!==null;d++)c=o(c,p.value,d),p=p.next;return c},e.prototype.reduceReverse=function(o,l){var c,p=this.tail;if(arguments.length>1)c=l;else if(this.tail)p=this.tail.prev,c=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var d=this.length-1;p!==null;d--)c=o(c,p.value,d),p=p.prev;return c},e.prototype.toArray=function(){for(var o=new Array(this.length),l=0,c=this.head;c!==null;l++)o[l]=c.value,c=c.next;return o},e.prototype.toArrayReverse=function(){for(var o=new Array(this.length),l=0,c=this.tail;c!==null;l++)o[l]=c.value,c=c.prev;return o},e.prototype.slice=function(o,l){l=l||this.length,l<0&&(l+=this.length),o=o||0,o<0&&(o+=this.length);var c=new e;if(l<o||l<0)return c;o<0&&(o=0),l>this.length&&(l=this.length);for(var p=0,d=this.head;d!==null&&p<o;p++)d=d.next;for(;d!==null&&p<l;p++,d=d.next)c.push(d.value);return c},e.prototype.sliceReverse=function(o,l){l=l||this.length,l<0&&(l+=this.length),o=o||0,o<0&&(o+=this.length);var c=new e;if(l<o||l<0)return c;o<0&&(o=0),l>this.length&&(l=this.length);for(var p=this.length,d=this.tail;d!==null&&p>l;p--)d=d.prev;for(;d!==null&&p>o;p--,d=d.prev)c.push(d.value);return c},e.prototype.splice=function(o,l){o>this.length&&(o=this.length-1),o<0&&(o=this.length+o);for(var c=0,p=this.head;p!==null&&c<o;c++)p=p.next;for(var d=[],c=0;p&&c<l;c++)d.push(p.value),p=this.removeNode(p);p===null&&(p=this.tail),p!==this.head&&p!==this.tail&&(p=p.prev);for(var c=2;c<arguments.length;c++)p=r(this,p,arguments[c]);return d},e.prototype.reverse=function(){for(var o=this.head,l=this.tail,c=o;c!==null;c=c.prev){var p=c.prev;c.prev=c.next,c.next=p}return this.head=l,this.tail=o,this};function r(o,l,c){var p=l===o.head?new s(c,null,l,o):new s(c,l,l.next,o);return p.next===null&&(o.tail=p),p.prev===null&&(o.head=p),o.length++,p}function i(o,l){o.tail=new s(l,o.tail,null,o),o.head||(o.head=o.tail),o.length++}function a(o,l){o.head=new s(l,null,o.head,o),o.tail||(o.tail=o.head),o.length++}function s(o,l,c,p){if(!(this instanceof s))return new s(o,l,c,p);this.list=p,this.value=o,l?(l.next=this,this.prev=l):this.prev=null,c?(c.prev=this,this.next=c):this.next=null}try{Ao()(e)}catch{}}),Ar=Y((n,t)=>{"use strict";var e=U("events"),r=ke(),i=U("string_decoder").StringDecoder,a=Symbol("EOF"),s=Symbol("maybeEmitEnd"),o=Symbol("emittedEnd"),l=Symbol("emittingEnd"),c=Symbol("closed"),p=Symbol("read"),d=Symbol("flush"),y=Symbol("flushChunk"),x=Symbol("encoding"),M=Symbol("decoder"),w=Symbol("flowing"),b=Symbol("paused"),g=Symbol("resume"),v=Symbol("bufferLength"),_=Symbol("bufferPush"),T=Symbol("bufferShift"),D=Symbol("objectMode"),F=Symbol("destroyed"),k=global._MP_NO_ITERATOR_SYMBOLS_!=="1",P=k&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),S=k&&Symbol.iterator||Symbol("iterator not implemented"),R=Buffer.alloc?Buffer:qe().Buffer,A=B=>B==="end"||B==="finish"||B==="prefinish",W=B=>B instanceof ArrayBuffer||typeof B=="object"&&B.constructor&&B.constructor.name==="ArrayBuffer"&&B.byteLength>=0,z=B=>!R.isBuffer(B)&&ArrayBuffer.isView(B);t.exports=class fn extends e{constructor(h){super(),this[w]=!1,this[b]=!1,this.pipes=new r,this.buffer=new r,this[D]=h&&h.objectMode||!1,this[D]?this[x]=null:this[x]=h&&h.encoding||null,this[x]==="buffer"&&(this[x]=null),this[M]=this[x]?new i(this[x]):null,this[a]=!1,this[o]=!1,this[l]=!1,this[c]=!1,this.writable=!0,this.readable=!0,this[v]=0,this[F]=!1}get bufferLength(){return this[v]}get encoding(){return this[x]}set encoding(h){if(this[D])throw new Error("cannot set encoding in objectMode");if(this[x]&&h!==this[x]&&(this[M]&&this[M].lastNeed||this[v]))throw new Error("cannot change encoding");this[x]!==h&&(this[M]=h?new i(h):null,this.buffer.length&&(this.buffer=this.buffer.map(E=>this[M].write(E)))),this[x]=h}setEncoding(h){this.encoding=h}get objectMode(){return this[D]}set objectMode(h){this[D]=this[D]||!!h}write(h,E,N){if(this[a])throw new Error("write after end");if(this[F])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;if(typeof E=="function"&&(N=E,E="utf8"),E||(E="utf8"),!this[D]&&!R.isBuffer(h)&&(z(h)?h=R.from(h.buffer,h.byteOffset,h.byteLength):W(h)?h=R.from(h):typeof h!="string"&&(this.objectMode=!0)),!this.objectMode&&!h.length){let O=this.flowing;return this[v]!==0&&this.emit("readable"),N&&N(),O}typeof h=="string"&&!this[D]&&!(E===this[x]&&!this[M].lastNeed)&&(h=R.from(h,E)),R.isBuffer(h)&&this[x]&&(h=this[M].write(h));try{return this.flowing?(this.emit("data",h),this.flowing):(this[_](h),!1)}finally{this[v]!==0&&this.emit("readable"),N&&N()}}read(h){if(this[F])return null;try{return this[v]===0||h===0||h>this[v]?null:(this[D]&&(h=null),this.buffer.length>1&&!this[D]&&(this.encoding?this.buffer=new r([Array.from(this.buffer).join("")]):this.buffer=new r([R.concat(Array.from(this.buffer),this[v])])),this[p](h||null,this.buffer.head.value))}finally{this[s]()}}[p](h,E){return h===E.length||h===null?this[T]():(this.buffer.head.value=E.slice(h),E=E.slice(0,h),this[v]-=h),this.emit("data",E),!this.buffer.length&&!this[a]&&this.emit("drain"),E}end(h,E,N){return typeof h=="function"&&(N=h,h=null),typeof E=="function"&&(N=E,E="utf8"),h&&this.write(h,E),N&&this.once("end",N),this[a]=!0,this.writable=!1,(this.flowing||!this[b])&&this[s](),this}[g](){this[F]||(this[b]=!1,this[w]=!0,this.emit("resume"),this.buffer.length?this[d]():this[a]?this[s]():this.emit("drain"))}resume(){return this[g]()}pause(){this[w]=!1,this[b]=!0}get destroyed(){return this[F]}get flowing(){return this[w]}get paused(){return this[b]}[_](h){return this[D]?this[v]+=1:this[v]+=h.length,this.buffer.push(h)}[T](){return this.buffer.length&&(this[D]?this[v]-=1:this[v]-=this.buffer.head.value.length),this.buffer.shift()}[d](){do;while(this[y](this[T]()));!this.buffer.length&&!this[a]&&this.emit("drain")}[y](h){return h?(this.emit("data",h),this.flowing):!1}pipe(h,E){if(this[F])return;let N=this[o];E=E||{},h===process.stdout||h===process.stderr?E.end=!1:E.end=E.end!==!1;let O={dest:h,opts:E,ondrain:Z=>this[g]()};return this.pipes.push(O),h.on("drain",O.ondrain),this[g](),N&&O.opts.end&&O.dest.end(),h}addListener(h,E){return this.on(h,E)}on(h,E){try{return super.on(h,E)}finally{h==="data"&&!this.pipes.length&&!this.flowing?this[g]():A(h)&&this[o]&&(super.emit(h),this.removeAllListeners(h))}}get emittedEnd(){return this[o]}[s](){!this[l]&&!this[o]&&!this[F]&&this.buffer.length===0&&this[a]&&(this[l]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[c]&&this.emit("close"),this[l]=!1)}emit(h,E){if(h!=="error"&&h!=="close"&&h!==F&&this[F])return;if(h==="data"){if(!E)return;this.pipes.length&&this.pipes.forEach(O=>O.dest.write(E)===!1&&this.pause())}else if(h==="end"){if(this[o]===!0)return;this[o]=!0,this.readable=!1,this[M]&&(E=this[M].end(),E&&(this.pipes.forEach(O=>O.dest.write(E)),super.emit("data",E))),this.pipes.forEach(O=>{O.dest.removeListener("drain",O.ondrain),O.opts.end&&O.dest.end()})}else if(h==="close"&&(this[c]=!0,!this[o]&&!this[F]))return;let N=new Array(arguments.length);if(N[0]=h,N[1]=E,arguments.length>2)for(let O=2;O<arguments.length;O++)N[O]=arguments[O];try{return super.emit.apply(this,N)}finally{A(h)?this.removeAllListeners(h):this[s]()}}collect(){let h=[];return h.dataLength=0,this.on("data",E=>{h.push(E),h.dataLength+=E.length}),this.promise().then(()=>h)}concat(){return this[D]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(h=>this[D]?Promise.reject(new Error("cannot concat in objectMode")):this[x]?h.join(""):R.concat(h,h.dataLength))}promise(){return new Promise((h,E)=>{this.on(F,()=>E(new Error("stream destroyed"))),this.on("end",()=>h()),this.on("error",N=>E(N))})}[P](){return{next:()=>{let h=this.read();if(h!==null)return Promise.resolve({done:!1,value:h});if(this[a])return Promise.resolve({done:!0});let E=null,N=null,O=L=>{this.removeListener("data",Z),this.removeListener("end",X),N(L)},Z=L=>{this.removeListener("error",O),this.removeListener("end",X),this.pause(),E({value:L,done:!!this[a]})},X=()=>{this.removeListener("error",O),this.removeListener("data",Z),E({done:!0})},q=()=>O(new Error("stream destroyed"));return new Promise((L,C)=>{N=C,E=L,this.once(F,q),this.once("error",O),this.once("end",X),this.once("data",Z)})}}}[S](){return{next:()=>{let h=this.read();return{value:h,done:h===null}}}}destroy(h){return this[F]?(h?this.emit("error",h):this.emit(F),this):(this[F]=!0,this.buffer=new r,this[v]=0,typeof this.close=="function"&&!this[c]&&this.close(),h?this.emit("error",h):this.emit(F),this)}static isStream(h){return!!h&&(h instanceof fn||h instanceof e&&(typeof h.pipe=="function"||typeof h.write=="function"&&typeof h.end=="function"))}}}),No=Y((n,t)=>{var e=U("zlib").constants||{ZLIB_VERNUM:4736};t.exports=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},e))}),Oo=Y((n,t)=>{"use strict";var e=U("events"),r=ke(),i=U("string_decoder").StringDecoder,a=Symbol("EOF"),s=Symbol("maybeEmitEnd"),o=Symbol("emittedEnd"),l=Symbol("emittingEnd"),c=Symbol("closed"),p=Symbol("read"),d=Symbol("flush"),y=Symbol("flushChunk"),x=Symbol("encoding"),M=Symbol("decoder"),w=Symbol("flowing"),b=Symbol("paused"),g=Symbol("resume"),v=Symbol("bufferLength"),_=Symbol("bufferPush"),T=Symbol("bufferShift"),D=Symbol("objectMode"),F=Symbol("destroyed"),k=global._MP_NO_ITERATOR_SYMBOLS_!=="1",P=k&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),S=k&&Symbol.iterator||Symbol("iterator not implemented"),R=Buffer.alloc?Buffer:qe().Buffer,A=B=>B==="end"||B==="finish"||B==="prefinish",W=B=>B instanceof ArrayBuffer||typeof B=="object"&&B.constructor&&B.constructor.name==="ArrayBuffer"&&B.byteLength>=0,z=B=>!R.isBuffer(B)&&ArrayBuffer.isView(B);t.exports=class dn extends e{constructor(h){super(),this[w]=!1,this[b]=!1,this.pipes=new r,this.buffer=new r,this[D]=h&&h.objectMode||!1,this[D]?this[x]=null:this[x]=h&&h.encoding||null,this[x]==="buffer"&&(this[x]=null),this[M]=this[x]?new i(this[x]):null,this[a]=!1,this[o]=!1,this[l]=!1,this[c]=!1,this.writable=!0,this.readable=!0,this[v]=0,this[F]=!1}get bufferLength(){return this[v]}get encoding(){return this[x]}set encoding(h){if(this[D])throw new Error("cannot set encoding in objectMode");if(this[x]&&h!==this[x]&&(this[M]&&this[M].lastNeed||this[v]))throw new Error("cannot change encoding");this[x]!==h&&(this[M]=h?new i(h):null,this.buffer.length&&(this.buffer=this.buffer.map(E=>this[M].write(E)))),this[x]=h}setEncoding(h){this.encoding=h}get objectMode(){return this[D]}set objectMode(h){this[D]=this[D]||!!h}write(h,E,N){if(this[a])throw new Error("write after end");if(this[F])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;if(typeof E=="function"&&(N=E,E="utf8"),E||(E="utf8"),!this[D]&&!R.isBuffer(h)&&(z(h)?h=R.from(h.buffer,h.byteOffset,h.byteLength):W(h)?h=R.from(h):typeof h!="string"&&(this.objectMode=!0)),!this.objectMode&&!h.length){let O=this.flowing;return this[v]!==0&&this.emit("readable"),N&&N(),O}typeof h=="string"&&!this[D]&&!(E===this[x]&&!this[M].lastNeed)&&(h=R.from(h,E)),R.isBuffer(h)&&this[x]&&(h=this[M].write(h));try{return this.flowing?(this.emit("data",h),this.flowing):(this[_](h),!1)}finally{this[v]!==0&&this.emit("readable"),N&&N()}}read(h){if(this[F])return null;try{return this[v]===0||h===0||h>this[v]?null:(this[D]&&(h=null),this.buffer.length>1&&!this[D]&&(this.encoding?this.buffer=new r([Array.from(this.buffer).join("")]):this.buffer=new r([R.concat(Array.from(this.buffer),this[v])])),this[p](h||null,this.buffer.head.value))}finally{this[s]()}}[p](h,E){return h===E.length||h===null?this[T]():(this.buffer.head.value=E.slice(h),E=E.slice(0,h),this[v]-=h),this.emit("data",E),!this.buffer.length&&!this[a]&&this.emit("drain"),E}end(h,E,N){return typeof h=="function"&&(N=h,h=null),typeof E=="function"&&(N=E,E="utf8"),h&&this.write(h,E),N&&this.once("end",N),this[a]=!0,this.writable=!1,(this.flowing||!this[b])&&this[s](),this}[g](){this[F]||(this[b]=!1,this[w]=!0,this.emit("resume"),this.buffer.length?this[d]():this[a]?this[s]():this.emit("drain"))}resume(){return this[g]()}pause(){this[w]=!1,this[b]=!0}get destroyed(){return this[F]}get flowing(){return this[w]}get paused(){return this[b]}[_](h){return this[D]?this[v]+=1:this[v]+=h.length,this.buffer.push(h)}[T](){return this.buffer.length&&(this[D]?this[v]-=1:this[v]-=this.buffer.head.value.length),this.buffer.shift()}[d](){do;while(this[y](this[T]()));!this.buffer.length&&!this[a]&&this.emit("drain")}[y](h){return h?(this.emit("data",h),this.flowing):!1}pipe(h,E){if(this[F])return;let N=this[o];E=E||{},h===process.stdout||h===process.stderr?E.end=!1:E.end=E.end!==!1;let O={dest:h,opts:E,ondrain:Z=>this[g]()};return this.pipes.push(O),h.on("drain",O.ondrain),this[g](),N&&O.opts.end&&O.dest.end(),h}addListener(h,E){return this.on(h,E)}on(h,E){try{return super.on(h,E)}finally{h==="data"&&!this.pipes.length&&!this.flowing?this[g]():A(h)&&this[o]&&(super.emit(h),this.removeAllListeners(h))}}get emittedEnd(){return this[o]}[s](){!this[l]&&!this[o]&&!this[F]&&this.buffer.length===0&&this[a]&&(this[l]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[c]&&this.emit("close"),this[l]=!1)}emit(h,E){if(h!=="error"&&h!=="close"&&h!==F&&this[F])return;if(h==="data"){if(!E)return;this.pipes.length&&this.pipes.forEach(O=>O.dest.write(E)===!1&&this.pause())}else if(h==="end"){if(this[o]===!0)return;this[o]=!0,this.readable=!1,this[M]&&(E=this[M].end(),E&&(this.pipes.forEach(O=>O.dest.write(E)),super.emit("data",E))),this.pipes.forEach(O=>{O.dest.removeListener("drain",O.ondrain),O.opts.end&&O.dest.end()})}else if(h==="close"&&(this[c]=!0,!this[o]&&!this[F]))return;let N=new Array(arguments.length);if(N[0]=h,N[1]=E,arguments.length>2)for(let O=2;O<arguments.length;O++)N[O]=arguments[O];try{return super.emit.apply(this,N)}finally{A(h)?this.removeAllListeners(h):this[s]()}}collect(){let h=[];return h.dataLength=0,this.on("data",E=>{h.push(E),h.dataLength+=E.length}),this.promise().then(()=>h)}concat(){return this[D]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(h=>this[D]?Promise.reject(new Error("cannot concat in objectMode")):this[x]?h.join(""):R.concat(h,h.dataLength))}promise(){return new Promise((h,E)=>{this.on(F,()=>E(new Error("stream destroyed"))),this.on("end",()=>h()),this.on("error",N=>E(N))})}[P](){return{next:()=>{let h=this.read();if(h!==null)return Promise.resolve({done:!1,value:h});if(this[a])return Promise.resolve({done:!0});let E=null,N=null,O=L=>{this.removeListener("data",Z),this.removeListener("end",X),N(L)},Z=L=>{this.removeListener("error",O),this.removeListener("end",X),this.pause(),E({value:L,done:!!this[a]})},X=()=>{this.removeListener("error",O),this.removeListener("data",Z),E({done:!0})},q=()=>O(new Error("stream destroyed"));return new Promise((L,C)=>{N=C,E=L,this.once(F,q),this.once("error",O),this.once("end",X),this.once("data",Z)})}}}[S](){return{next:()=>{let h=this.read();return{value:h,done:h===null}}}}destroy(h){return this[F]?(h?this.emit("error",h):this.emit(F),this):(this[F]=!0,this.buffer=new r,this[v]=0,typeof this.close=="function"&&!this[c]&&this.close(),h?this.emit("error",h):this.emit(F),this)}static isStream(h){return!!h&&(h instanceof dn||h instanceof e&&(typeof h.pipe=="function"||typeof h.write=="function"&&typeof h.end=="function"))}}}),bn=Y(n=>{"use strict";var t=U("assert"),e=U("buffer").Buffer,r=U("zlib"),i=n.constants=No(),a=Oo(),s=e.concat,o=class extends Error{constructor(h){super("zlib: "+h.message),this.code=h.code,this.errno=h.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+h.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},l=Symbol("opts"),c=Symbol("flushFlag"),p=Symbol("finishFlushFlag"),d=Symbol("fullFlushFlag"),y=Symbol("handle"),x=Symbol("onError"),M=Symbol("sawError"),w=Symbol("level"),b=Symbol("strategy"),g=Symbol("ended"),v=Symbol("_defaultFullFlush"),_=class extends a{constructor(h,E){if(!h||typeof h!="object")throw new TypeError("invalid options for ZlibBase constructor");super(h),this[g]=!1,this[l]=h,this[c]=h.flush,this[p]=h.finishFlush;try{this[y]=new r[E](h)}catch(N){throw new o(N)}this[x]=N=>{this[M]=!0,this.close(),this.emit("error",N)},this[y].on("error",N=>this[x](new o(N))),this.once("end",()=>this.close)}close(){this[y]&&(this[y].close(),this[y]=null,this.emit("close"))}reset(){if(!this[M])return t(this[y],"zlib binding closed"),this[y].reset()}flush(h){this.ended||(typeof h!="number"&&(h=this[d]),this.write(Object.assign(e.alloc(0),{[c]:h})))}end(h,E,N){return h&&this.write(h,E),this.flush(this[p]),this[g]=!0,super.end(null,null,N)}get ended(){return this[g]}write(h,E,N){if(typeof E=="function"&&(N=E,E="utf8"),typeof h=="string"&&(h=e.from(h,E)),this[M])return;t(this[y],"zlib binding closed");let O=this[y]._handle,Z=O.close;O.close=()=>{};let X=this[y].close;this[y].close=()=>{},e.concat=C=>C;let q;try{let C=typeof h[c]=="number"?h[c]:this[c];q=this[y]._processChunk(h,C),e.concat=s}catch(C){e.concat=s,this[x](new o(C))}finally{this[y]&&(this[y]._handle=O,O.close=Z,this[y].close=X,this[y].removeAllListeners("error"))}let L;if(q)if(Array.isArray(q)&&q.length>0){L=super.write(e.from(q[0]));for(let C=1;C<q.length;C++)L=super.write(q[C])}else L=super.write(e.from(q));return N&&N(),L}},T=class extends _{constructor(h,E){h=h||{},h.flush=h.flush||i.Z_NO_FLUSH,h.finishFlush=h.finishFlush||i.Z_FINISH,super(h,E),this[d]=i.Z_FULL_FLUSH,this[w]=h.level,this[b]=h.strategy}params(h,E){if(!this[M]){if(!this[y])throw new Error("cannot switch params when binding is closed");if(!this[y].params)throw new Error("not supported in this implementation");if(this[w]!==h||this[b]!==E){this.flush(i.Z_SYNC_FLUSH),t(this[y],"zlib binding closed");let N=this[y].flush;this[y].flush=(O,Z)=>{this.flush(O),Z()};try{this[y].params(h,E)}finally{this[y].flush=N}this[y]&&(this[w]=h,this[b]=E)}}}},D=class extends T{constructor(h){super(h,"Deflate")}},F=class extends T{constructor(h){super(h,"Inflate")}},k=class extends T{constructor(h){super(h,"Gzip")}},P=class extends T{constructor(h){super(h,"Gunzip")}},S=class extends T{constructor(h){super(h,"DeflateRaw")}},R=class extends T{constructor(h){super(h,"InflateRaw")}},A=class extends T{constructor(h){super(h,"Unzip")}},W=class extends _{constructor(h,E){h=h||{},h.flush=h.flush||i.BROTLI_OPERATION_PROCESS,h.finishFlush=h.finishFlush||i.BROTLI_OPERATION_FINISH,super(h,E),this[d]=i.BROTLI_OPERATION_FLUSH}},z=class extends W{constructor(h){super(h,"BrotliCompress")}},B=class extends W{constructor(h){super(h,"BrotliDecompress")}};n.Deflate=D,n.Inflate=F,n.Gzip=k,n.Gunzip=P,n.DeflateRaw=S,n.InflateRaw=R,n.Unzip=A,typeof r.BrotliCompress=="function"?(n.BrotliCompress=z,n.BrotliDecompress=B):n.BrotliCompress=n.BrotliDecompress=class{constructor(){throw new Error("Brotli is not supported in this version of Node.js")}}}),Nr=Y(n=>{"use strict";n.name=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),n.code=new Map(Array.from(n.name).map(t=>[t[1],t[0]]))}),he=Y((n,t)=>{var e=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform;t.exports=e!=="win32"?r=>r:r=>r&&r.replace(/\\/g,"/")}),Je=Y((n,t)=>{"use strict";var e=Nr(),r=Ar(),i=he(),a=Symbol("slurp");t.exports=class extends r{constructor(s,o,l){switch(super(),this.pause(),this.extended=o,this.globalExtended=l,this.header=s,this.startBlockSize=512*Math.ceil(s.size/512),this.blockRemain=this.startBlockSize,this.remain=s.size,this.type=s.type,this.meta=!1,this.ignore=!1,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}this.path=i(s.path),this.mode=s.mode,this.mode&&(this.mode=this.mode&4095),this.uid=s.uid,this.gid=s.gid,this.uname=s.uname,this.gname=s.gname,this.size=s.size,this.mtime=s.mtime,this.atime=s.atime,this.ctime=s.ctime,this.linkpath=i(s.linkpath),this.uname=s.uname,this.gname=s.gname,o&&this[a](o),l&&this[a](l,!0)}write(s){let o=s.length;if(o>this.blockRemain)throw new Error("writing more to entry than is appropriate");let l=this.remain,c=this.blockRemain;return this.remain=Math.max(0,l-o),this.blockRemain=Math.max(0,c-o),this.ignore?!0:l>=o?super.write(s):super.write(s.slice(0,l))}[a](s,o){for(let l in s)s[l]!==null&&s[l]!==void 0&&!(o&&l==="path")&&(this[l]=l==="path"||l==="linkpath"?i(s[l]):s[l])}}}),Bo=Y(n=>{"use strict";var t=n.encode=(c,p)=>{if(Number.isSafeInteger(c))c<0?r(c,p):e(c,p);else throw TypeError("cannot encode number outside of javascript safe integer range");return p},e=(c,p)=>{p[0]=128;for(var d=p.length;d>1;d--)p[d-1]=c&255,c=Math.floor(c/256)},r=(c,p)=>{p[0]=255;var d=!1;c=c*-1;for(var y=p.length;y>1;y--){var x=c&255;c=Math.floor(c/256),d?p[y-1]=o(x):x===0?p[y-1]=0:(d=!0,p[y-1]=l(x))}},i=n.parse=c=>{var p=c[c.length-1],d=c[0],y;if(d===128)y=s(c.slice(1,c.length));else if(d===255)y=a(c);else throw TypeError("invalid base256 encoding");if(!Number.isSafeInteger(y))throw TypeError("parsed number outside of javascript safe integer range");return y},a=c=>{for(var p=c.length,d=0,y=!1,x=p-1;x>-1;x--){var M=c[x],w;y?w=o(M):M===0?w=M:(y=!0,w=l(M)),w!==0&&(d-=w*Math.pow(256,p-x-1))}return d},s=c=>{for(var p=c.length,d=0,y=p-1;y>-1;y--){var x=c[y];x!==0&&(d+=x*Math.pow(256,p-y-1))}return d},o=c=>(255^c)&255,l=c=>(255^c)+1&255}),Ae=Y((n,t)=>{"use strict";var e=qt(),r=Nr(),i=U("path").posix,a=Bo(),s=Symbol("slurp"),o=Symbol("type"),l=class{constructor(P,S,R,A){this.cksumValid=!1,this.needPax=!1,this.nullBlock=!1,this.block=null,this.path=null,this.mode=null,this.uid=null,this.gid=null,this.size=null,this.mtime=null,this.cksum=null,this[o]="0",this.linkpath=null,this.uname=null,this.gname=null,this.devmaj=0,this.devmin=0,this.atime=null,this.ctime=null,e.isBuffer(P)?this.decode(P,S||0,R,A):P&&this.set(P)}decode(P,S,R,A){if(S||(S=0),!P||!(P.length>=S+512))throw new Error("need 512 bytes for header");if(this.path=p(P,S,100),this.mode=x(P,S+100,8),this.uid=x(P,S+108,8),this.gid=x(P,S+116,8),this.size=x(P,S+124,12),this.mtime=d(P,S+136,12),this.cksum=x(P,S+148,12),this[s](R),this[s](A,!0),this[o]=p(P,S+156,1),this[o]===""&&(this[o]="0"),this[o]==="0"&&this.path.substr(-1)==="/"&&(this[o]="5"),this[o]==="5"&&(this.size=0),this.linkpath=p(P,S+157,100),P.slice(S+257,S+265).toString()==="ustar\x0000")if(this.uname=p(P,S+265,32),this.gname=p(P,S+297,32),this.devmaj=x(P,S+329,8),this.devmin=x(P,S+337,8),P[S+475]!==0){let z=p(P,S+345,155);this.path=z+"/"+this.path}else{let z=p(P,S+345,130);z&&(this.path=z+"/"+this.path),this.atime=d(P,S+476,12),this.ctime=d(P,S+488,12)}let W=8*32;for(let z=S;z<S+148;z++)W+=P[z];for(let z=S+156;z<S+512;z++)W+=P[z];this.cksumValid=W===this.cksum,this.cksum===null&&W===8*32&&(this.nullBlock=!0)}[s](P,S){for(let R in P)P[R]!==null&&P[R]!==void 0&&!(S&&R==="path")&&(this[R]=P[R])}encode(P,S){if(P||(P=this.block=e.alloc(512),S=0),S||(S=0),!(P.length>=S+512))throw new Error("need 512 bytes for header");let R=this.ctime||this.atime?130:155,A=c(this.path||"",R),W=A[0],z=A[1];this.needPax=A[2],this.needPax=k(P,S,100,W)||this.needPax,this.needPax=g(P,S+100,8,this.mode)||this.needPax,this.needPax=g(P,S+108,8,this.uid)||this.needPax,this.needPax=g(P,S+116,8,this.gid)||this.needPax,this.needPax=g(P,S+124,12,this.size)||this.needPax,this.needPax=D(P,S+136,12,this.mtime)||this.needPax,P[S+156]=this[o].charCodeAt(0),this.needPax=k(P,S+157,100,this.linkpath)||this.needPax,P.write("ustar\x0000",S+257,8),this.needPax=k(P,S+265,32,this.uname)||this.needPax,this.needPax=k(P,S+297,32,this.gname)||this.needPax,this.needPax=g(P,S+329,8,this.devmaj)||this.needPax,this.needPax=g(P,S+337,8,this.devmin)||this.needPax,this.needPax=k(P,S+345,R,z)||this.needPax,P[S+475]!==0?this.needPax=k(P,S+345,155,z)||this.needPax:(this.needPax=k(P,S+345,130,z)||this.needPax,this.needPax=D(P,S+476,12,this.atime)||this.needPax,this.needPax=D(P,S+488,12,this.ctime)||this.needPax);let B=8*32;for(let h=S;h<S+148;h++)B+=P[h];for(let h=S+156;h<S+512;h++)B+=P[h];return this.cksum=B,g(P,S+148,8,this.cksum),this.cksumValid=!0,this.needPax}set(P){for(let S in P)P[S]!==null&&P[S]!==void 0&&(this[S]=P[S])}get type(){return r.name.get(this[o])||this[o]}get typeKey(){return this[o]}set type(P){r.code.has(P)?this[o]=r.code.get(P):this[o]=P}},c=(P,S)=>{let R=P,A="",W,z=i.parse(P).root||".";if(e.byteLength(R)<100)W=[R,A,!1];else{A=i.dirname(R),R=i.basename(R);do e.byteLength(R)<=100&&e.byteLength(A)<=S?W=[R,A,!1]:e.byteLength(R)>100&&e.byteLength(A)<=S?W=[R.substr(0,100-1),A,!0]:(R=i.join(i.basename(A),R),A=i.dirname(A));while(A!==z&&!W);W||(W=[P.substr(0,100-1),"",!0])}return W},p=(P,S,R)=>P.slice(S,S+R).toString("utf8").replace(/\0.*/,""),d=(P,S,R)=>y(x(P,S,R)),y=P=>P===null?null:new Date(P*1e3),x=(P,S,R)=>P[S]&128?a.parse(P.slice(S,S+R)):w(P,S,R),M=P=>isNaN(P)?null:P,w=(P,S,R)=>M(parseInt(P.slice(S,S+R).toString("utf8").replace(/\0.*$/,"").trim(),8)),b={12:8589934591,8:2097151},g=(P,S,R,A)=>A===null?!1:A>b[R]||A<0?(a.encode(A,P.slice(S,S+R)),!0):(v(P,S,R,A),!1),v=(P,S,R,A)=>P.write(_(A,R),S,R,"ascii"),_=(P,S)=>T(Math.floor(P).toString(8),S),T=(P,S)=>(P.length===S-1?P:new Array(S-P.length-1).join("0")+P+" ")+"\0",D=(P,S,R,A)=>A===null?!1:g(P,S,R,A.getTime()/1e3),F=new Array(156).join("\0"),k=(P,S,R,A)=>A===null?!1:(P.write(A+F,S,R,"utf8"),A.length!==e.byteLength(A)||A.length>R);t.exports=l}),Or=Y((n,t)=>{"use strict";var e=qt(),r=Ae(),i=U("path"),a=class{constructor(c,p){this.atime=c.atime||null,this.charset=c.charset||null,this.comment=c.comment||null,this.ctime=c.ctime||null,this.gid=c.gid||null,this.gname=c.gname||null,this.linkpath=c.linkpath||null,this.mtime=c.mtime||null,this.path=c.path||null,this.size=c.size||null,this.uid=c.uid||null,this.uname=c.uname||null,this.dev=c.dev||null,this.ino=c.ino||null,this.nlink=c.nlink||null,this.global=p||!1}encode(){let c=this.encodeBody();if(c==="")return null;let p=e.byteLength(c),d=512*Math.ceil(1+p/512),y=e.allocUnsafe(d);for(let x=0;x<512;x++)y[x]=0;new r({path:("PaxHeader/"+i.basename(this.path)).slice(0,99),mode:this.mode||420,uid:this.uid||null,gid:this.gid||null,size:p,mtime:this.mtime||null,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime||null,ctime:this.ctime||null}).encode(y),y.write(c,512,p,"utf8");for(let x=p+512;x<y.length;x++)y[x]=0;return y}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(c){if(this[c]===null||this[c]===void 0)return"";let p=this[c]instanceof Date?this[c].getTime()/1e3:this[c],d=" "+(c==="dev"||c==="ino"||c==="nlink"?"SCHILY.":"")+c+"="+p+`
`,y=e.byteLength(d),x=Math.floor(Math.log(y)/Math.log(10))+1;return y+x>=Math.pow(10,x)&&(x+=1),x+y+d}};a.parse=(c,p,d)=>new a(s(o(c),p),d);var s=(c,p)=>p?Object.keys(c).reduce((d,y)=>(d[y]=c[y],d),p):c,o=c=>c.replace(/\n$/,"").split(`
`).reduce(l,Object.create(null)),l=(c,p)=>{let d=parseInt(p,10);if(d!==e.byteLength(p)+1)return c;p=p.substr((d+" ").length);let y=p.split("="),x=y.shift().replace(/^SCHILY\.(dev|ino|nlink)/,"$1");if(!x)return c;let M=y.join("=");return c[x]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(x)?new Date(M*1e3):/^[0-9]+$/.test(M)?+M:M,c};t.exports=a}),Ne=Y((n,t)=>{var e=["/".repeat(1024),"/".repeat(512),"/".repeat(256),"/".repeat(128),"/".repeat(64),"/".repeat(32),"/".repeat(16),"/".repeat(8),"/".repeat(4),"/".repeat(2),"/"];t.exports=r=>{for(let i of e)for(;r.length>=i.length&&r.slice(-1*i.length)===i;)r=r.slice(0,-1*i.length);return r}}),Br=Y((n,t)=>{"use strict";t.exports=e=>class extends e{warn(r,i){if(!this.strict)this.emit("warn",r,i);else if(i instanceof Error)this.emit("error",i);else{let a=new Error(r);a.data=i,this.emit("error",a)}}}}),gn=Y((n,t)=>{"use strict";var e=["|","<",">","?",":"],r=e.map(s=>String.fromCharCode(61440+s.charCodeAt(0))),i=new Map(e.map((s,o)=>[s,r[o]])),a=new Map(r.map((s,o)=>[s,e[o]]));t.exports={encode:s=>e.reduce((o,l)=>o.split(l).join(i.get(l)),s),decode:s=>r.reduce((o,l)=>o.split(l).join(a.get(l)),s)}}),yn=Y((n,t)=>{var{isAbsolute:e,parse:r}=U("path").win32;t.exports=i=>{let a="",s=r(i);for(;e(i)||s.root;){let o=i.charAt(0)==="/"&&i.slice(0,4)!=="//?/"?"/":s.root;i=i.substr(o.length),a+=o,s=r(i)}return[a,i]}}),Wo=Y((n,t)=>{"use strict";t.exports=(e,r)=>(e&=4095,r&&(e&256&&(e|=64),e&32&&(e|=8),e&4&&(e|=1)),e)}),vn=Y((n,t)=>{"use strict";var e=qt(),r=Ar(),i=Or(),a=Ae(),s=Je(),o=U("fs"),l=U("path"),c=he(),p=Ne(),d=(u,I)=>I?(u=c(u).replace(/^\.(\/|$)/,""),p(I)+"/"+u):u,y=16*1024*1024,x=Symbol("process"),M=Symbol("file"),w=Symbol("directory"),b=Symbol("symlink"),g=Symbol("hardlink"),v=Symbol("header"),_=Symbol("read"),T=Symbol("lstat"),D=Symbol("onlstat"),F=Symbol("onread"),k=Symbol("onreadlink"),P=Symbol("openfile"),S=Symbol("onopenfile"),R=Symbol("close"),A=Symbol("mode"),W=Symbol("awaitDrain"),z=Symbol("ondrain"),B=Symbol("prefix"),h=Symbol("hadError"),E=Br(),N=gn(),O=yn(),Z=Wo(),X=E(class extends r{constructor(u,I){if(I=I||{},super(I),typeof u!="string")throw new TypeError("path is required");if(this.path=c(u),this.portable=!!I.portable,this.myuid=process.getuid&&process.getuid()||0,this.myuser=process.env.USER||"",this.maxReadSize=I.maxReadSize||y,this.linkCache=I.linkCache||new Map,this.statCache=I.statCache||new Map,this.preservePaths=!!I.preservePaths,this.cwd=c(I.cwd||process.cwd()),this.strict=!!I.strict,this.noPax=!!I.noPax,this.noMtime=!!I.noMtime,this.mtime=I.mtime||null,this.prefix=I.prefix?c(I.prefix):null,this.fd=null,this.blockLen=null,this.blockRemain=null,this.buf=null,this.offset=null,this.length=null,this.pos=null,this.remain=null,typeof I.onwarn=="function"&&this.on("warn",I.onwarn),!this.preservePaths){let H=O(this.path);H[0]&&(this.warn("stripping "+H[0]+" from absolute path",this.path),this.path=H[1])}this.win32=!!I.win32||process.platform==="win32",this.win32&&(this.path=N.decode(this.path.replace(/\\/g,"/")),u=u.replace(/\\/g,"/")),this.absolute=c(I.absolute||l.resolve(this.cwd,u)),this.path===""&&(this.path="./"),this.statCache.has(this.absolute)?this[D](this.statCache.get(this.absolute)):this[T]()}emit(u,...I){return u==="error"&&(this[h]=!0),super.emit(u,...I)}[T](){o.lstat(this.absolute,(u,I)=>{if(u)return this.emit("error",u);this[D](I)})}[D](u){this.statCache.set(this.absolute,u),this.stat=u,u.isFile()||(u.size=0),this.type=C(u),this.emit("stat",u),this[x]()}[x](){switch(this.type){case"File":return this[M]();case"Directory":return this[w]();case"SymbolicLink":return this[b]();default:return this.end()}}[A](u){return Z(u,this.type==="Directory")}[B](u){return d(u,this.prefix)}[v](){this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.header=new a({path:this[B](this.path),linkpath:this.type==="Link"?this[B](this.linkpath):this.linkpath,mode:this[A](this.stat.mode),uid:this.portable?null:this.stat.uid,gid:this.portable?null:this.stat.gid,size:this.stat.size,mtime:this.noMtime?null:this.mtime||this.stat.mtime,type:this.type,uname:this.portable?null:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?null:this.stat.atime,ctime:this.portable?null:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new i({atime:this.portable?null:this.header.atime,ctime:this.portable?null:this.header.ctime,gid:this.portable?null:this.header.gid,mtime:this.noMtime?null:this.mtime||this.header.mtime,path:this[B](this.path),linkpath:this.type==="Link"?this[B](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?null:this.header.uid,uname:this.portable?null:this.header.uname,dev:this.portable?null:this.stat.dev,ino:this.portable?null:this.stat.ino,nlink:this.portable?null:this.stat.nlink}).encode()),super.write(this.header.block)}[w](){this.path.substr(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[v](),this.end()}[b](){o.readlink(this.absolute,(u,I)=>{if(u)return this.emit("error",u);this[k](I)})}[k](u){this.linkpath=c(u),this[v](),this.end()}[g](u){this.type="Link",this.linkpath=c(l.relative(this.cwd,u)),this.stat.size=0,this[v](),this.end()}[M](){if(this.stat.nlink>1){let u=this.stat.dev+":"+this.stat.ino;if(this.linkCache.has(u)){let I=this.linkCache.get(u);if(I.indexOf(this.cwd)===0)return this[g](I)}this.linkCache.set(u,this.absolute)}if(this[v](),this.stat.size===0)return this.end();this[P]()}[P](){o.open(this.absolute,"r",(u,I)=>{if(u)return this.emit("error",u);this[S](I)})}[S](u){if(this.fd=u,this[h])return this[R]();this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let I=Math.min(this.blockLen,this.maxReadSize);this.buf=e.allocUnsafe(I),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[_]()}[_](){let{fd:u,buf:I,offset:H,length:et,pos:J}=this;o.read(u,I,H,et,J,(Ft,Wt)=>{if(Ft)return this[R](()=>this.emit("error",Ft));this[F](Wt)})}[R](u){o.close(this.fd,u)}[F](u){if(u<=0&&this.remain>0){let H=new Error("encountered unexpected EOF");return H.path=this.absolute,H.syscall="read",H.code="EOF",this[R](()=>this.emit("error",H))}if(u>this.remain){let H=new Error("did not encounter expected EOF");return H.path=this.absolute,H.syscall="read",H.code="EOF",this[R](()=>this.emit("error",H))}if(u===this.remain)for(let H=u;H<this.length&&u<this.blockRemain;H++)this.buf[H+this.offset]=0,u++,this.remain++;let I=this.offset===0&&u===this.buf.length?this.buf:this.buf.slice(this.offset,this.offset+u);this.write(I)?this[z]():this[W](()=>this[z]())}[W](u){this.once("drain",u)}write(u){if(this.blockRemain<u.length){let I=new Error("writing more data than expected");return I.path=this.absolute,this.emit("error",I)}return this.remain-=u.length,this.blockRemain-=u.length,this.pos+=u.length,this.offset+=u.length,super.write(u)}[z](){if(!this.remain)return this.blockRemain&&super.write(e.alloc(this.blockRemain)),this[R](u=>u?this.emit("error",u):this.end());this.offset>=this.length&&(this.buf=e.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[_]()}}),q=class extends X{constructor(u,I){super(u,I)}[T](){this[D](o.lstatSync(this.absolute))}[b](){this[k](o.readlinkSync(this.absolute))}[P](){this[S](o.openSync(this.absolute,"r"))}[_](){let u=!0;try{let{fd:I,buf:H,offset:et,length:J,pos:Ft}=this,Wt=o.readSync(I,H,et,J,Ft);this[F](Wt),u=!1}finally{if(u)try{this[R](()=>{})}catch{}}}[W](u){u()}[R](u){o.closeSync(this.fd),u()}},L=E(class extends r{constructor(u,I){if(I=I||{},super(I),this.preservePaths=!!I.preservePaths,this.portable=!!I.portable,this.strict=!!I.strict,this.noPax=!!I.noPax,this.noMtime=!!I.noMtime,this.readEntry=u,this.type=u.type,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=I.prefix||null,this.path=c(u.path),this.mode=this[A](u.mode),this.uid=this.portable?null:u.uid,this.gid=this.portable?null:u.gid,this.uname=this.portable?null:u.uname,this.gname=this.portable?null:u.gname,this.size=u.size,this.mtime=this.noMtime?null:I.mtime||u.mtime,this.atime=this.portable?null:u.atime,this.ctime=this.portable?null:u.ctime,this.linkpath=c(u.linkpath),typeof I.onwarn=="function"&&this.on("warn",I.onwarn),!this.preservePaths){let H=O(this.path);H[0]&&(this.warn("stripping "+H[0]+" from absolute path",this.path),this.path=H[1])}this.remain=u.size,this.blockRemain=u.startBlockSize,this.header=new a({path:this[B](this.path),linkpath:this.type==="Link"?this[B](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?null:this.uid,gid:this.portable?null:this.gid,size:this.size,mtime:this.noMtime?null:this.mtime,type:this.type,uname:this.portable?null:this.uname,atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime}),this.header.encode()&&!this.noPax&&super.write(new i({atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime,gid:this.portable?null:this.gid,mtime:this.noMtime?null:this.mtime,path:this[B](this.path),linkpath:this.type==="Link"?this[B](this.linkpath):this.linkpath,size:this.size,uid:this.portable?null:this.uid,uname:this.portable?null:this.uname,dev:this.portable?null:this.readEntry.dev,ino:this.portable?null:this.readEntry.ino,nlink:this.portable?null:this.readEntry.nlink}).encode()),super.write(this.header.block),u.pipe(this)}[B](u){return d(u,this.prefix)}[A](u){return Z(u,this.type==="Directory")}write(u){let I=u.length;if(I>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=I,super.write(u)}end(){return this.blockRemain&&super.write(e.alloc(this.blockRemain)),super.end()}});X.Sync=q,X.Tar=L;var C=u=>u.isFile()?"File":u.isDirectory()?"Directory":u.isSymbolicLink()?"SymbolicLink":"Unsupported";t.exports=X}),Wr=Y((n,t)=>{"use strict";var e=qt(),r=class{constructor(L,C){this.path=L||"./",this.absolute=C,this.entry=null,this.stat=null,this.readdir=null,this.pending=!1,this.ignore=!1,this.piped=!1}},i=Ar(),a=bn(),s=Je(),o=vn(),l=o.Sync,c=o.Tar,p=ke(),d=e.alloc(1024),y=Symbol("onStat"),x=Symbol("ended"),M=Symbol("queue"),w=Symbol("current"),b=Symbol("process"),g=Symbol("processing"),v=Symbol("processJob"),_=Symbol("jobs"),T=Symbol("jobDone"),D=Symbol("addFSEntry"),F=Symbol("addTarEntry"),k=Symbol("stat"),P=Symbol("readdir"),S=Symbol("onreaddir"),R=Symbol("pipe"),A=Symbol("entry"),W=Symbol("entryOpt"),z=Symbol("writeEntryClass"),B=Symbol("write"),h=Symbol("ondrain"),E=U("fs"),N=U("path"),O=Br(),Z=he(),X=O(class extends i{constructor(L){super(L),L=L||Object.create(null),this.opt=L,this.cwd=L.cwd||process.cwd(),this.maxReadSize=L.maxReadSize,this.preservePaths=!!L.preservePaths,this.strict=!!L.strict,this.noPax=!!L.noPax,this.prefix=Z(L.prefix||""),this.linkCache=L.linkCache||new Map,this.statCache=L.statCache||new Map,this.readdirCache=L.readdirCache||new Map,this[z]=o,typeof L.onwarn=="function"&&this.on("warn",L.onwarn),this.zip=null,L.gzip?(typeof L.gzip!="object"&&(L.gzip={}),this.zip=new a.Gzip(L.gzip),this.zip.on("data",C=>super.write(C)),this.zip.on("end",C=>super.end()),this.zip.on("drain",C=>this[h]()),this.on("resume",C=>this.zip.resume())):this.on("drain",this[h]),this.portable=!!L.portable,this.noDirRecurse=!!L.noDirRecurse,this.follow=!!L.follow,this.noMtime=!!L.noMtime,this.mtime=L.mtime||null,this.filter=typeof L.filter=="function"?L.filter:C=>!0,this[M]=new p,this[_]=0,this.jobs=+L.jobs||4,this[g]=!1,this[x]=!1}[B](L){return super.write(L)}add(L){return this.write(L),this}end(L){return L&&this.write(L),this[x]=!0,this[b](),this}write(L){if(this[x])throw new Error("write after end");return L instanceof s?this[F](L):this[D](L),this.flowing}[F](L){let C=Z(N.resolve(this.cwd,L.path));if(!this.filter(L.path,L))L.resume();else{let u=new r(L.path,C,!1);u.entry=new c(L,this[W](u)),u.entry.on("end",I=>this[T](u)),this[_]+=1,this[M].push(u)}this[b]()}[D](L){let C=Z(N.resolve(this.cwd,L));this[M].push(new r(L,C)),this[b]()}[k](L){L.pending=!0,this[_]+=1;let C=this.follow?"stat":"lstat";E[C](L.absolute,(u,I)=>{L.pending=!1,this[_]-=1,u?this.emit("error",u):this[y](L,I)})}[y](L,C){this.statCache.set(L.absolute,C),L.stat=C,this.filter(L.path,C)||(L.ignore=!0),this[b]()}[P](L){L.pending=!0,this[_]+=1,E.readdir(L.absolute,(C,u)=>{if(L.pending=!1,this[_]-=1,C)return this.emit("error",C);this[S](L,u)})}[S](L,C){this.readdirCache.set(L.absolute,C),L.readdir=C,this[b]()}[b](){if(!this[g]){this[g]=!0;for(let L=this[M].head;L!==null&&this[_]<this.jobs;L=L.next)if(this[v](L.value),L.value.ignore){let C=L.next;this[M].removeNode(L),L.next=C}this[g]=!1,this[x]&&!this[M].length&&this[_]===0&&(this.zip?this.zip.end(d):(super.write(d),super.end()))}}get[w](){return this[M]&&this[M].head&&this[M].head.value}[T](L){this[M].shift(),this[_]-=1,this[b]()}[v](L){if(!L.pending){if(L.entry){L===this[w]&&!L.piped&&this[R](L);return}if(L.stat||(this.statCache.has(L.absolute)?this[y](L,this.statCache.get(L.absolute)):this[k](L)),!!L.stat&&!L.ignore&&!(!this.noDirRecurse&&L.stat.isDirectory()&&!L.readdir&&(this.readdirCache.has(L.absolute)?this[S](L,this.readdirCache.get(L.absolute)):this[P](L),!L.readdir))){if(L.entry=this[A](L),!L.entry){L.ignore=!0;return}L===this[w]&&!L.piped&&this[R](L)}}}[W](L){return{onwarn:(C,u)=>{this.warn(C,u)},noPax:this.noPax,cwd:this.cwd,absolute:L.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix}}[A](L){this[_]+=1;try{return new this[z](L.path,this[W](L)).on("end",()=>this[T](L)).on("error",C=>this.emit("error",C))}catch(C){this.emit("error",C)}}[h](){this[w]&&this[w].entry&&this[w].entry.resume()}[R](L){L.piped=!0,L.readdir&&L.readdir.forEach(I=>{let H=L.path,et=H==="./"?"":H.replace(/\/*$/,"/");this[D](et+I)});let C=L.entry,u=this.zip;u?C.on("data",I=>{u.write(I)||C.pause()}):C.on("data",I=>{super.write(I)||C.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}}),q=class extends X{constructor(L){super(L),this[z]=l}pause(){}resume(){}[k](L){let C=this.follow?"statSync":"lstatSync";this[y](L,E[C](L.absolute))}[P](L,C){this[S](L,E.readdirSync(L.absolute))}[R](L){let C=L.entry,u=this.zip;L.readdir&&L.readdir.forEach(I=>{let H=L.path,et=H==="./"?"":H.replace(/\/*$/,"/");this[D](et+I)}),u?C.on("data",I=>{u.write(I)}):C.on("data",I=>{super[B](I)})}};X.Sync=q,t.exports=X}),$o=Y((n,t)=>{"use strict";var e=U("events"),r=ke(),i=U("string_decoder").StringDecoder,a=Symbol("EOF"),s=Symbol("maybeEmitEnd"),o=Symbol("emittedEnd"),l=Symbol("emittingEnd"),c=Symbol("closed"),p=Symbol("read"),d=Symbol("flush"),y=Symbol("flushChunk"),x=Symbol("encoding"),M=Symbol("decoder"),w=Symbol("flowing"),b=Symbol("paused"),g=Symbol("resume"),v=Symbol("bufferLength"),_=Symbol("bufferPush"),T=Symbol("bufferShift"),D=Symbol("objectMode"),F=Symbol("destroyed"),k=global._MP_NO_ITERATOR_SYMBOLS_!=="1",P=k&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),S=k&&Symbol.iterator||Symbol("iterator not implemented"),R=Buffer.alloc?Buffer:qe().Buffer,A=B=>B==="end"||B==="finish"||B==="prefinish",W=B=>B instanceof ArrayBuffer||typeof B=="object"&&B.constructor&&B.constructor.name==="ArrayBuffer"&&B.byteLength>=0,z=B=>!R.isBuffer(B)&&ArrayBuffer.isView(B);t.exports=class xn extends e{constructor(h){super(),this[w]=!1,this[b]=!1,this.pipes=new r,this.buffer=new r,this[D]=h&&h.objectMode||!1,this[D]?this[x]=null:this[x]=h&&h.encoding||null,this[x]==="buffer"&&(this[x]=null),this[M]=this[x]?new i(this[x]):null,this[a]=!1,this[o]=!1,this[l]=!1,this[c]=!1,this.writable=!0,this.readable=!0,this[v]=0,this[F]=!1}get bufferLength(){return this[v]}get encoding(){return this[x]}set encoding(h){if(this[D])throw new Error("cannot set encoding in objectMode");if(this[x]&&h!==this[x]&&(this[M]&&this[M].lastNeed||this[v]))throw new Error("cannot change encoding");this[x]!==h&&(this[M]=h?new i(h):null,this.buffer.length&&(this.buffer=this.buffer.map(E=>this[M].write(E)))),this[x]=h}setEncoding(h){this.encoding=h}get objectMode(){return this[D]}set objectMode(h){this[D]=this[D]||!!h}write(h,E,N){if(this[a])throw new Error("write after end");if(this[F])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;if(typeof E=="function"&&(N=E,E="utf8"),E||(E="utf8"),!this[D]&&!R.isBuffer(h)&&(z(h)?h=R.from(h.buffer,h.byteOffset,h.byteLength):W(h)?h=R.from(h):typeof h!="string"&&(this.objectMode=!0)),!this.objectMode&&!h.length){let O=this.flowing;return this[v]!==0&&this.emit("readable"),N&&N(),O}typeof h=="string"&&!this[D]&&!(E===this[x]&&!this[M].lastNeed)&&(h=R.from(h,E)),R.isBuffer(h)&&this[x]&&(h=this[M].write(h));try{return this.flowing?(this.emit("data",h),this.flowing):(this[_](h),!1)}finally{this[v]!==0&&this.emit("readable"),N&&N()}}read(h){if(this[F])return null;try{return this[v]===0||h===0||h>this[v]?null:(this[D]&&(h=null),this.buffer.length>1&&!this[D]&&(this.encoding?this.buffer=new r([Array.from(this.buffer).join("")]):this.buffer=new r([R.concat(Array.from(this.buffer),this[v])])),this[p](h||null,this.buffer.head.value))}finally{this[s]()}}[p](h,E){return h===E.length||h===null?this[T]():(this.buffer.head.value=E.slice(h),E=E.slice(0,h),this[v]-=h),this.emit("data",E),!this.buffer.length&&!this[a]&&this.emit("drain"),E}end(h,E,N){return typeof h=="function"&&(N=h,h=null),typeof E=="function"&&(N=E,E="utf8"),h&&this.write(h,E),N&&this.once("end",N),this[a]=!0,this.writable=!1,(this.flowing||!this[b])&&this[s](),this}[g](){this[F]||(this[b]=!1,this[w]=!0,this.emit("resume"),this.buffer.length?this[d]():this[a]?this[s]():this.emit("drain"))}resume(){return this[g]()}pause(){this[w]=!1,this[b]=!0}get destroyed(){return this[F]}get flowing(){return this[w]}get paused(){return this[b]}[_](h){return this[D]?this[v]+=1:this[v]+=h.length,this.buffer.push(h)}[T](){return this.buffer.length&&(this[D]?this[v]-=1:this[v]-=this.buffer.head.value.length),this.buffer.shift()}[d](){do;while(this[y](this[T]()));!this.buffer.length&&!this[a]&&this.emit("drain")}[y](h){return h?(this.emit("data",h),this.flowing):!1}pipe(h,E){if(this[F])return;let N=this[o];E=E||{},h===process.stdout||h===process.stderr?E.end=!1:E.end=E.end!==!1;let O={dest:h,opts:E,ondrain:Z=>this[g]()};return this.pipes.push(O),h.on("drain",O.ondrain),this[g](),N&&O.opts.end&&O.dest.end(),h}addListener(h,E){return this.on(h,E)}on(h,E){try{return super.on(h,E)}finally{h==="data"&&!this.pipes.length&&!this.flowing?this[g]():A(h)&&this[o]&&(super.emit(h),this.removeAllListeners(h))}}get emittedEnd(){return this[o]}[s](){!this[l]&&!this[o]&&!this[F]&&this.buffer.length===0&&this[a]&&(this[l]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[c]&&this.emit("close"),this[l]=!1)}emit(h,E){if(h!=="error"&&h!=="close"&&h!==F&&this[F])return;if(h==="data"){if(!E)return;this.pipes.length&&this.pipes.forEach(O=>O.dest.write(E)===!1&&this.pause())}else if(h==="end"){if(this[o]===!0)return;this[o]=!0,this.readable=!1,this[M]&&(E=this[M].end(),E&&(this.pipes.forEach(O=>O.dest.write(E)),super.emit("data",E))),this.pipes.forEach(O=>{O.dest.removeListener("drain",O.ondrain),O.opts.end&&O.dest.end()})}else if(h==="close"&&(this[c]=!0,!this[o]&&!this[F]))return;let N=new Array(arguments.length);if(N[0]=h,N[1]=E,arguments.length>2)for(let O=2;O<arguments.length;O++)N[O]=arguments[O];try{return super.emit.apply(this,N)}finally{A(h)?this.removeAllListeners(h):this[s]()}}collect(){let h=[];return h.dataLength=0,this.on("data",E=>{h.push(E),h.dataLength+=E.length}),this.promise().then(()=>h)}concat(){return this[D]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(h=>this[D]?Promise.reject(new Error("cannot concat in objectMode")):this[x]?h.join(""):R.concat(h,h.dataLength))}promise(){return new Promise((h,E)=>{this.on(F,()=>E(new Error("stream destroyed"))),this.on("end",()=>h()),this.on("error",N=>E(N))})}[P](){return{next:()=>{let h=this.read();if(h!==null)return Promise.resolve({done:!1,value:h});if(this[a])return Promise.resolve({done:!0});let E=null,N=null,O=L=>{this.removeListener("data",Z),this.removeListener("end",X),N(L)},Z=L=>{this.removeListener("error",O),this.removeListener("end",X),this.pause(),E({value:L,done:!!this[a]})},X=()=>{this.removeListener("error",O),this.removeListener("data",Z),E({done:!0})},q=()=>O(new Error("stream destroyed"));return new Promise((L,C)=>{N=C,E=L,this.once(F,q),this.once("error",O),this.once("end",X),this.once("data",Z)})}}}[S](){return{next:()=>{let h=this.read();return{value:h,done:h===null}}}}destroy(h){return this[F]?(h?this.emit("error",h):this.emit(F),this):(this[F]=!0,this.buffer=new r,this[v]=0,typeof this.close=="function"&&!this[c]&&this.close(),h?this.emit("error",h):this.emit(F),this)}static isStream(h){return!!h&&(h instanceof xn||h instanceof e&&(typeof h.pipe=="function"||typeof h.write=="function"&&typeof h.end=="function"))}}}),Oe=Y(n=>{"use strict";var t=$o(),e=U("events").EventEmitter,r=U("fs"),i=process.binding("fs"),a=i.writeBuffers,s=i.FSReqWrap||i.FSReqCallback,o=Symbol("_autoClose"),l=Symbol("_close"),c=Symbol("_ended"),p=Symbol("_fd"),d=Symbol("_finished"),y=Symbol("_flags"),x=Symbol("_flush"),M=Symbol("_handleChunk"),w=Symbol("_makeBuf"),b=Symbol("_mode"),g=Symbol("_needDrain"),v=Symbol("_onerror"),_=Symbol("_onopen"),T=Symbol("_onread"),D=Symbol("_onwrite"),F=Symbol("_open"),k=Symbol("_path"),P=Symbol("_pos"),S=Symbol("_queue"),R=Symbol("_read"),A=Symbol("_readSize"),W=Symbol("_reading"),z=Symbol("_remain"),B=Symbol("_size"),h=Symbol("_write"),E=Symbol("_writing"),N=Symbol("_defaultFlag"),O=class extends t{constructor(C,u){if(u=u||{},super(u),this.writable=!1,typeof C!="string")throw new TypeError("path must be a string");this[p]=typeof u.fd=="number"?u.fd:null,this[k]=C,this[A]=u.readSize||16*1024*1024,this[W]=!1,this[B]=typeof u.size=="number"?u.size:1/0,this[z]=this[B],this[o]=typeof u.autoClose=="boolean"?u.autoClose:!0,typeof this[p]=="number"?this[R]():this[F]()}get fd(){return this[p]}get path(){return this[k]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[F](){r.open(this[k],"r",(C,u)=>this[_](C,u))}[_](C,u){C?this[v](C):(this[p]=u,this.emit("open",u),this[R]())}[w](){return Buffer.allocUnsafe(Math.min(this[A],this[z]))}[R](){if(!this[W]){this[W]=!0;let C=this[w]();if(C.length===0)return process.nextTick(()=>this[T](null,0,C));r.read(this[p],C,0,C.length,null,(u,I,H)=>this[T](u,I,H))}}[T](C,u,I){this[W]=!1,C?this[v](C):this[M](u,I)&&this[R]()}[l](){this[o]&&typeof this[p]=="number"&&(r.close(this[p],C=>this.emit("close")),this[p]=null)}[v](C){this[W]=!0,this[l](),this.emit("error",C)}[M](C,u){let I=!1;return this[z]-=C,C>0&&(I=super.write(C<u.length?u.slice(0,C):u)),(C===0||this[z]<=0)&&(I=!1,this[l](),super.end()),I}emit(C,u){switch(C){case"prefinish":case"finish":break;case"drain":typeof this[p]=="number"&&this[R]();break;default:return super.emit(C,u)}}},Z=class extends O{[F](){let C=!0;try{this[_](null,r.openSync(this[k],"r")),C=!1}finally{C&&this[l]()}}[R](){let C=!0;try{if(!this[W]){this[W]=!0;do{let u=this[w](),I=u.length===0?0:r.readSync(this[p],u,0,u.length,null);if(!this[M](I,u))break}while(!0);this[W]=!1}C=!1}finally{C&&this[l]()}}[l](){if(this[o]&&typeof this[p]=="number"){try{r.closeSync(this[p])}catch{}this[p]=null,this.emit("close")}}},X=class extends e{constructor(C,u){u=u||{},super(u),this.readable=!1,this[E]=!1,this[c]=!1,this[g]=!1,this[S]=[],this[k]=C,this[p]=typeof u.fd=="number"?u.fd:null,this[b]=u.mode===void 0?438:u.mode,this[P]=typeof u.start=="number"?u.start:null,this[o]=typeof u.autoClose=="boolean"?u.autoClose:!0;let I=this[P]!==null?"r+":"w";this[N]=u.flags===void 0,this[y]=this[N]?I:u.flags,this[p]===null&&this[F]()}get fd(){return this[p]}get path(){return this[k]}[v](C){this[l](),this[E]=!0,this.emit("error",C)}[F](){r.open(this[k],this[y],this[b],(C,u)=>this[_](C,u))}[_](C,u){this[N]&&this[y]==="r+"&&C&&C.code==="ENOENT"?(this[y]="w",this[F]()):C?this[v](C):(this[p]=u,this.emit("open",u),this[x]())}end(C,u){C&&this.write(C,u),this[c]=!0,!this[E]&&!this[S].length&&typeof this[p]=="number"&&this[D](null,0)}write(C,u){return typeof C=="string"&&(C=new Buffer(C,u)),this[c]?(this.emit("error",new Error("write() after end()")),!1):this[p]===null||this[E]||this[S].length?(this[S].push(C),this[g]=!0,!1):(this[E]=!0,this[h](C),!0)}[h](C){r.write(this[p],C,0,C.length,this[P],(u,I)=>this[D](u,I))}[D](C,u){C?this[v](C):(this[P]!==null&&(this[P]+=u),this[S].length?this[x]():(this[E]=!1,this[c]&&!this[d]?(this[d]=!0,this[l](),this.emit("finish")):this[g]&&(this[g]=!1,this.emit("drain"))))}[x](){if(this[S].length===0)this[c]&&this[D](null,0);else if(this[S].length===1)this[h](this[S].pop());else{let C=this[S];this[S]=[],L(this[p],C,this[P],(u,I)=>this[D](u,I))}}[l](){this[o]&&typeof this[p]=="number"&&(r.close(this[p],C=>this.emit("close")),this[p]=null)}},q=class extends X{[F](){let C;try{C=r.openSync(this[k],this[y],this[b])}catch(u){if(this[N]&&this[y]==="r+"&&u&&u.code==="ENOENT")return this[y]="w",this[F]();throw u}this[_](null,C)}[l](){if(this[o]&&typeof this[p]=="number"){try{r.closeSync(this[p])}catch{}this[p]=null,this.emit("close")}}[h](C){try{this[D](null,r.writeSync(this[p],C,0,C.length,this[P]))}catch(u){this[D](u,0)}}},L=(C,u,I,H)=>{let et=(Ft,Wt)=>H(Ft,Wt,u),J=new s;J.oncomplete=et,i.writeBuffers(C,u,I,J)};n.ReadStream=O,n.ReadStreamSync=Z,n.WriteStream=X,n.WriteStreamSync=q}),Ke=Y((n,t)=>{"use strict";var e=Br(),r=U("path"),i=Ae(),a=U("events"),s=ke(),o=1024*1024,l=Je(),c=Or(),p=bn(),d=qt(),y=d.from([31,139]),x=Symbol("state"),M=Symbol("writeEntry"),w=Symbol("readEntry"),b=Symbol("nextEntry"),g=Symbol("processEntry"),v=Symbol("extendedHeader"),_=Symbol("globalExtendedHeader"),T=Symbol("meta"),D=Symbol("emitMeta"),F=Symbol("buffer"),k=Symbol("queue"),P=Symbol("ended"),S=Symbol("emittedEnd"),R=Symbol("emit"),A=Symbol("unzip"),W=Symbol("consumeChunk"),z=Symbol("consumeChunkSub"),B=Symbol("consumeBody"),h=Symbol("consumeMeta"),E=Symbol("consumeHeader"),N=Symbol("consuming"),O=Symbol("bufferConcat"),Z=Symbol("maybeEnd"),X=Symbol("writing"),q=Symbol("aborted"),L=Symbol("onDone"),C=u=>!0;t.exports=e(class extends a{constructor(u){u=u||{},super(u),u.ondone?this.on(L,u.ondone):this.on(L,I=>{this.emit("prefinish"),this.emit("finish"),this.emit("end"),this.emit("close")}),this.strict=!!u.strict,this.maxMetaEntrySize=u.maxMetaEntrySize||o,this.filter=typeof u.filter=="function"?u.filter:C,this.writable=!0,this.readable=!1,this[k]=new s,this[F]=null,this[w]=null,this[M]=null,this[x]="begin",this[T]="",this[v]=null,this[_]=null,this[P]=!1,this[A]=null,this[q]=!1,typeof u.onwarn=="function"&&this.on("warn",u.onwarn),typeof u.onentry=="function"&&this.on("entry",u.onentry)}[E](u,I){let H;try{H=new i(u,I,this[v],this[_])}catch(et){return this.warn("invalid entry",et)}if(H.nullBlock)this[R]("nullBlock");else if(!H.cksumValid)this.warn("invalid entry",H);else if(!H.path)this.warn("invalid: path is required",H);else{let et=H.type;if(/^(Symbolic)?Link$/.test(et)&&!H.linkpath)this.warn("invalid: linkpath required",H);else if(!/^(Symbolic)?Link$/.test(et)&&H.linkpath)this.warn("invalid: linkpath forbidden",H);else{let J=this[M]=new l(H,this[v],this[_]);J.meta?J.size>this.maxMetaEntrySize?(J.ignore=!0,this[R]("ignoredEntry",J),this[x]="ignore"):J.size>0&&(this[T]="",J.on("data",Ft=>this[T]+=Ft),this[x]="meta"):(this[v]=null,J.ignore=J.ignore||!this.filter(J.path,J),J.ignore?(this[R]("ignoredEntry",J),this[x]=J.remain?"ignore":"begin"):(J.remain?this[x]="body":(this[x]="begin",J.end()),this[w]?this[k].push(J):(this[k].push(J),this[b]())))}}}[g](u){let I=!0;return u?Array.isArray(u)?this.emit.apply(this,u):(this[w]=u,this.emit("entry",u),u.emittedEnd||(u.on("end",H=>this[b]()),I=!1)):(this[w]=null,I=!1),I}[b](){do;while(this[g](this[k].shift()));if(!this[k].length){let u=this[w];!u||u.flowing||u.size===u.remain?this[X]||this.emit("drain"):u.once("drain",I=>this.emit("drain"))}}[B](u,I){let H=this[M],et=H.blockRemain,J=et>=u.length&&I===0?u:u.slice(I,I+et);return H.write(J),H.blockRemain||(this[x]="begin",this[M]=null,H.end()),J.length}[h](u,I){let H=this[M],et=this[B](u,I);return this[M]||this[D](H),et}[R](u,I,H){!this[k].length&&!this[w]?this.emit(u,I,H):this[k].push([u,I,H])}[D](u){switch(this[R]("meta",this[T]),u.type){case"ExtendedHeader":case"OldExtendedHeader":this[v]=c.parse(this[T],this[v],!1);break;case"GlobalExtendedHeader":this[_]=c.parse(this[T],this[_],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":this[v]=this[v]||Object.create(null),this[v].path=this[T].replace(/\0.*/,"");break;case"NextFileHasLongLinkpath":this[v]=this[v]||Object.create(null),this[v].linkpath=this[T].replace(/\0.*/,"");break;default:throw new Error("unknown meta: "+u.type)}}abort(u,I){this[q]=!0,this.warn(u,I),this.emit("abort",I),this.emit("error",I)}write(u){if(this[q])return;if(this[A]===null&&u){if(this[F]&&(u=d.concat([this[F],u]),this[F]=null),u.length<y.length)return this[F]=u,!0;for(let H=0;this[A]===null&&H<y.length;H++)u[H]!==y[H]&&(this[A]=!1);if(this[A]===null){let H=this[P];this[P]=!1,this[A]=new p.Unzip,this[A].on("data",J=>this[W](J)),this[A].on("error",J=>this.abort(J.message,J)),this[A].on("end",J=>{this[P]=!0,this[W]()}),this[X]=!0;let et=this[A][H?"end":"write"](u);return this[X]=!1,et}}this[X]=!0,this[A]?this[A].write(u):this[W](u),this[X]=!1;let I=this[k].length?!1:this[w]?this[w].flowing:!0;return!I&&!this[k].length&&this[w].once("drain",H=>this.emit("drain")),I}[O](u){u&&!this[q]&&(this[F]=this[F]?d.concat([this[F],u]):u)}[Z](){if(this[P]&&!this[S]&&!this[q]&&!this[N]){this[S]=!0;let u=this[M];if(u&&u.blockRemain){let I=this[F]?this[F].length:0;this.warn("Truncated input (needed "+u.blockRemain+" more bytes, only "+I+" available)",u),this[F]&&u.write(this[F]),u.end()}this[R](L)}}[W](u){if(this[N])this[O](u);else if(!u&&!this[F])this[Z]();else{if(this[N]=!0,this[F]){this[O](u);let I=this[F];this[F]=null,this[z](I)}else this[z](u);for(;this[F]&&this[F].length>=512&&!this[q];){let I=this[F];this[F]=null,this[z](I)}this[N]=!1}(!this[F]||this[P])&&this[Z]()}[z](u){let I=0,H=u.length;for(;I+512<=H&&!this[q];)switch(this[x]){case"begin":this[E](u,I),I+=512;break;case"ignore":case"body":I+=this[B](u,I);break;case"meta":I+=this[h](u,I);break;default:throw new Error("invalid state: "+this[x])}I<H&&(this[F]?this[F]=d.concat([u.slice(I),this[F]]):this[F]=u.slice(I))}end(u){this[q]||(this[A]?this[A].end(u):(this[P]=!0,this.write(u)))}})}),$r=Y((n,t)=>{"use strict";var e=qt(),r=Ie(),i=Ke(),a=U("fs"),s=Oe(),o=U("path"),l=Ne(),c=t.exports=(w,b,g)=>{typeof w=="function"?(g=w,b=null,w={}):Array.isArray(w)&&(b=w,w={}),typeof b=="function"&&(g=b,b=null),b?b=Array.from(b):b=[];let v=r(w);if(v.sync&&typeof g=="function")throw new TypeError("callback not supported for sync tar functions");if(!v.file&&typeof g=="function")throw new TypeError("callback only supported with file option");return b.length&&d(v,b),v.noResume||p(v),v.file&&v.sync?y(v):v.file?x(v,g):M(v)},p=w=>{let b=w.onentry;w.onentry=b?g=>{b(g),g.resume()}:g=>g.resume()},d=(w,b)=>{let g=new Map(b.map(T=>[l(T),!0])),v=w.filter,_=(T,D)=>{let F=D||o.parse(T).root||".",k=T===F?!1:g.has(T)?g.get(T):_(o.dirname(T),F);return g.set(T,k),k};w.filter=v?(T,D)=>v(T,D)&&_(l(T)):T=>_(l(T))},y=w=>{let b=M(w),g=w.file,v=!0,_;try{let T=a.statSync(g),D=w.maxReadSize||16*1024*1024;if(T.size<D)b.end(a.readFileSync(g));else{let F=0,k=e.allocUnsafe(D);for(_=a.openSync(g,"r");F<T.size;){let P=a.readSync(_,k,0,D,F);F+=P,b.write(k.slice(0,P))}b.end()}v=!1}finally{if(v&&_)try{a.closeSync(_)}catch{}}},x=(w,b)=>{let g=new i(w),v=w.maxReadSize||16*1024*1024,_=w.file,T=new Promise((D,F)=>{g.on("error",F),g.on("end",D),a.stat(_,(k,P)=>{if(k)F(k);else{let S=new s.ReadStream(_,{readSize:v,size:P.size});S.on("error",F),S.pipe(g)}})});return b?T.then(b,b):T},M=w=>new i(w)}),zo=Y((n,t)=>{"use strict";var e=Ie(),r=Wr(),i=U("fs"),a=Oe(),s=$r(),o=U("path"),l=t.exports=(w,b,g)=>{if(typeof b=="function"&&(g=b),Array.isArray(w)&&(b=w,w={}),!b||!Array.isArray(b)||!b.length)throw new TypeError("no files or directories specified");b=Array.from(b);let v=e(w);if(v.sync&&typeof g=="function")throw new TypeError("callback not supported for sync tar functions");if(!v.file&&typeof g=="function")throw new TypeError("callback only supported with file option");return v.file&&v.sync?c(v,b):v.file?p(v,b,g):v.sync?x(v,b):M(v,b)},c=(w,b)=>{let g=new r.Sync(w),v=new a.WriteStreamSync(w.file,{mode:w.mode||438});g.pipe(v),d(g,b)},p=(w,b,g)=>{let v=new r(w),_=new a.WriteStream(w.file,{mode:w.mode||438});v.pipe(_);let T=new Promise((D,F)=>{_.on("error",F),_.on("close",D),v.on("error",F)});return y(v,b),g?T.then(g,g):T},d=(w,b)=>{b.forEach(g=>{g.charAt(0)==="@"?s({file:o.resolve(w.cwd,g.substr(1)),sync:!0,noResume:!0,onentry:v=>w.add(v)}):w.add(g)}),w.end()},y=(w,b)=>{for(;b.length;){let g=b.shift();if(g.charAt(0)==="@")return s({file:o.resolve(w.cwd,g.substr(1)),noResume:!0,onentry:v=>w.add(v)}).then(v=>y(w,b));w.add(g)}w.end()},x=(w,b)=>{let g=new r.Sync(w);return d(g,b),g},M=(w,b)=>{let g=new r(w);return y(g,b),g}}),wn=Y((n,t)=>{"use strict";var e=qt(),r=Ie(),i=Wr(),a=Ke(),s=U("fs"),o=Oe(),l=$r(),c=U("path"),p=Ae(),d=t.exports=(g,v,_)=>{let T=r(g);if(!T.file)throw new TypeError("file is required");if(T.gzip)throw new TypeError("cannot append to compressed archives");if(!v||!Array.isArray(v)||!v.length)throw new TypeError("no files or directories specified");return v=Array.from(v),T.sync?y(T,v):M(T,v,_)},y=(g,v)=>{let _=new i.Sync(g),T=!0,D,F;try{try{D=s.openSync(g.file,"r+")}catch(S){if(S.code==="ENOENT")D=s.openSync(g.file,"w+");else throw S}let k=s.fstatSync(D),P=e.alloc(512);t:for(F=0;F<k.size;F+=512){for(let A=0,W=0;A<512;A+=W){if(W=s.readSync(D,P,A,P.length-A,F+A),F===0&&P[0]===31&&P[1]===139)throw new Error("cannot append to compressed archives");if(!W)break t}let S=new p(P);if(!S.cksumValid)break;let R=512*Math.ceil(S.size/512);if(F+R+512>k.size)break;F+=R,g.mtimeCache&&g.mtimeCache.set(S.path,S.mtime)}T=!1,x(g,_,F,D,v)}finally{if(T)try{s.closeSync(D)}catch{}}},x=(g,v,_,T,D)=>{let F=new o.WriteStreamSync(g.file,{fd:T,start:_});v.pipe(F),w(v,D)},M=(g,v,_)=>{v=Array.from(v);let T=new i(g),D=(k,P,S)=>{let R=(h,E)=>{h?s.close(k,N=>S(h)):S(null,E)},A=0;if(P===0)return R(null,0);let W=0,z=e.alloc(512),B=(h,E)=>{if(h)return R(h);if(W+=E,W<512&&E)return s.read(k,z,W,z.length-W,A+W,B);if(A===0&&z[0]===31&&z[1]===139)return R(new Error("cannot append to compressed archives"));if(W<512)return R(null,A);let N=new p(z);if(!N.cksumValid)return R(null,A);let O=512*Math.ceil(N.size/512);if(A+O+512>P||(A+=O+512,A>=P))return R(null,A);g.mtimeCache&&g.mtimeCache.set(N.path,N.mtime),W=0,s.read(k,z,0,512,A,B)};s.read(k,z,0,512,A,B)},F=new Promise((k,P)=>{T.on("error",P);let S="r+",R=(A,W)=>{if(A&&A.code==="ENOENT"&&S==="r+")return S="w+",s.open(g.file,S,R);if(A)return P(A);s.fstat(W,(z,B)=>{if(z)return s.close(W,()=>P(z));D(W,B.size,(h,E)=>{if(h)return P(h);let N=new o.WriteStream(g.file,{fd:W,start:E});T.pipe(N),N.on("error",P),N.on("close",k),b(T,v)})})};s.open(g.file,S,R)});return _?F.then(_,_):F},w=(g,v)=>{v.forEach(_=>{_.charAt(0)==="@"?l({file:c.resolve(g.cwd,_.substr(1)),sync:!0,noResume:!0,onentry:T=>g.add(T)}):g.add(_)}),g.end()},b=(g,v)=>{for(;v.length;){let _=v.shift();if(_.charAt(0)==="@")return l({file:c.resolve(g.cwd,_.substr(1)),noResume:!0,onentry:T=>g.add(T)}).then(T=>b(g,v));g.add(_)}g.end()}}),Ho=Y((n,t)=>{"use strict";var e=Ie(),r=wn(),i=t.exports=(s,o,l)=>{let c=e(s);if(!c.file)throw new TypeError("file is required");if(c.gzip)throw new TypeError("cannot append to compressed archives");if(!o||!Array.isArray(o)||!o.length)throw new TypeError("no files or directories specified");return o=Array.from(o),a(c),r(c,o,l)},a=s=>{let o=s.filter;s.mtimeCache||(s.mtimeCache=new Map),s.filter=o?(l,c)=>o(l,c)&&!(s.mtimeCache.get(l)>c.mtime):(l,c)=>!(s.mtimeCache.get(l)>c.mtime)}}),jo=Y((n,t)=>{var e=U("path"),r=U("fs"),i=parseInt("0777",8);t.exports=a.mkdirp=a.mkdirP=a;function a(s,o,l,c){typeof o=="function"?(l=o,o={}):(!o||typeof o!="object")&&(o={mode:o});var p=o.mode,d=o.fs||r;p===void 0&&(p=i),c||(c=null);var y=l||function(){};s=e.resolve(s),d.mkdir(s,p,function(x){if(!x)return c=c||s,y(null,c);switch(x.code){case"ENOENT":if(e.dirname(s)===s)return y(x);a(e.dirname(s),o,function(M,w){M?y(M,w):a(s,o,y,w)});break;default:d.stat(s,function(M,w){M||!w.isDirectory()?y(x,c):y(null,c)});break}})}a.sync=function s(o,l,c){(!l||typeof l!="object")&&(l={mode:l});var p=l.mode,d=l.fs||r;p===void 0&&(p=i),c||(c=null),o=e.resolve(o);try{d.mkdirSync(o,p),c=c||o}catch(x){switch(x.code){case"ENOENT":c=s(e.dirname(o),l,c),s(o,l,c);break;default:var y;try{y=d.statSync(o)}catch{throw x}if(!y.isDirectory())throw x;break}}return c}}),Uo=Y((n,t)=>{"use strict";var e=U("fs"),r=U("path"),i=e.lchown?"lchown":"chown",a=e.lchownSync?"lchownSync":"chownSync",s=e.lchown&&!process.version.match(/v1[1-9]+\./)&&!process.version.match(/v10\.[6-9]/),o=(_,T,D)=>{try{return e[a](_,T,D)}catch(F){if(F.code!=="ENOENT")throw F}},l=(_,T,D)=>{try{return e.chownSync(_,T,D)}catch(F){if(F.code!=="ENOENT")throw F}},c=s?(_,T,D,F)=>k=>{!k||k.code!=="EISDIR"?F(k):e.chown(_,T,D,F)}:(_,T,D,F)=>F,p=s?(_,T,D)=>{try{return o(_,T,D)}catch(F){if(F.code!=="EISDIR")throw F;l(_,T,D)}}:(_,T,D)=>o(_,T,D),d=process.version,y=(_,T,D)=>e.readdir(_,T,D),x=(_,T)=>e.readdirSync(_,T);/^v4\./.test(d)&&(y=(_,T,D)=>e.readdir(_,D));var M=(_,T,D,F)=>{e[i](_,T,D,c(_,T,D,k=>{F(k&&k.code!=="ENOENT"?k:null)}))},w=(_,T,D,F,k)=>{if(typeof T=="string")return e.lstat(r.resolve(_,T),(P,S)=>{if(P)return k(P.code!=="ENOENT"?P:null);S.name=T,w(_,S,D,F,k)});if(T.isDirectory())b(r.resolve(_,T.name),D,F,P=>{if(P)return k(P);let S=r.resolve(_,T.name);M(S,D,F,k)});else{let P=r.resolve(_,T.name);M(P,D,F,k)}},b=(_,T,D,F)=>{y(_,{withFileTypes:!0},(k,P)=>{if(k){if(k.code==="ENOENT")return F();if(k.code!=="ENOTDIR"&&k.code!=="ENOTSUP")return F(k)}if(k||!P.length)return M(_,T,D,F);let S=P.length,R=null,A=W=>{if(!R){if(W)return F(R=W);if(--S===0)return M(_,T,D,F)}};P.forEach(W=>w(_,W,T,D,A))})},g=(_,T,D,F)=>{if(typeof T=="string")try{let k=e.lstatSync(r.resolve(_,T));k.name=T,T=k}catch(k){if(k.code==="ENOENT")return;throw k}T.isDirectory()&&v(r.resolve(_,T.name),D,F),p(r.resolve(_,T.name),D,F)},v=(_,T,D)=>{let F;try{F=x(_,{withFileTypes:!0})}catch(k){if(k.code==="ENOENT")return;if(k.code==="ENOTDIR"||k.code==="ENOTSUP")return p(_,T,D);throw k}return F&&F.length&&F.forEach(k=>g(_,k,T,D)),p(_,T,D)};t.exports=b,b.sync=v}),Go=Y((n,t)=>{"use strict";var e=jo(),r=U("fs"),i=U("path"),a=Uo(),s=he(),o=class extends Error{constructor(w,b){super("Cannot extract through symbolic link"),this.path=b,this.symlink=w}get name(){return"SylinkError"}},l=class extends Error{constructor(w,b){super(b+": Cannot cd into '"+w+"'"),this.path=w,this.code=b}get name(){return"CwdError"}},c=(w,b)=>w.get(s(b)),p=(w,b,g)=>w.set(s(b),g),d=(w,b)=>{r.stat(w,(g,v)=>{(g||!v.isDirectory())&&(g=new l(w,g&&g.code||"ENOTDIR")),b(g)})};t.exports=(w,b,g)=>{w=s(w);let v=b.umask,_=b.mode|448,T=(_&v)!==0,D=b.uid,F=b.gid,k=typeof D=="number"&&typeof F=="number"&&(D!==b.processUid||F!==b.processGid),P=b.preserve,S=b.unlink,R=b.cache,A=s(b.cwd),W=(B,h)=>{B?g(B):(p(R,w,!0),h&&k?a(h,D,F,E=>W(E)):T?r.chmod(w,_,g):g())};if(R&&c(R,w)===!0)return W();if(w===A)return d(w,W);if(P)return e(w,_,W);let z=s(i.relative(A,w)).split("/");y(A,z,_,R,S,A,null,W)};var y=(w,b,g,v,_,T,D,F)=>{if(!b.length)return F(null,D);let k=b.shift(),P=s(i.resolve(w+"/"+k));if(c(v,P))return y(P,b,g,v,_,T,D,F);r.mkdir(P,g,x(P,b,g,v,_,T,D,F))},x=(w,b,g,v,_,T,D,F)=>k=>{k?r.lstat(w,(P,S)=>{if(P)P.path=P.path&&s(P.path),F(P);else if(S.isDirectory())y(w,b,g,v,_,T,D,F);else if(_)r.unlink(w,R=>{if(R)return F(R);r.mkdir(w,g,x(w,b,g,v,_,T,D,F))});else{if(S.isSymbolicLink())return F(new o(w,w+"/"+b.join("/")));F(k)}}):(D=D||w,y(w,b,g,v,_,T,D,F))},M=w=>{let b=!1,g="ENOTDIR";try{b=r.statSync(w).isDirectory()}catch(v){g=v.code}finally{if(!b)throw new l(w,g)}};t.exports.sync=(w,b)=>{w=s(w);let g=b.umask,v=b.mode|448,_=(v&g)!==0,T=b.uid,D=b.gid,F=typeof T=="number"&&typeof D=="number"&&(T!==b.processUid||D!==b.processGid),k=b.preserve,P=b.unlink,S=b.cache,R=s(b.cwd),A=B=>{p(S,w,!0),B&&F&&a.sync(B,T,D),_&&r.chmodSync(w,v)};if(S&&c(S,w)===!0)return A();if(w===R)return M(R),A();if(k)return A(e.sync(w,v));let W=s(i.relative(R,w)).split("/"),z=null;for(let B=W.shift(),h=R;B&&(h+="/"+B);B=W.shift())if(h=s(i.resolve(h)),!c(S,h))try{r.mkdirSync(h,v),z=z||h,p(S,h,!0)}catch{let E=r.lstatSync(h);if(E.isDirectory()){p(S,h,!0);continue}else if(P){r.unlinkSync(h),r.mkdirSync(h,v),z=z||h,p(S,h,!0);continue}else if(E.isSymbolicLink())return new o(h,h+"/"+W.join("/"))}return A(z)}}),Vo=Y((n,t)=>{var e=U("assert"),r=he(),i=Ne(),{join:a}=U("path"),s=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,o=s==="win32";t.exports=()=>{let l=new Map,c=new Map,p=b=>b.split("/").slice(0,-1).reduce((g,v)=>(g.length&&(v=r(a(g[g.length-1],v))),g.push(v||"/"),g),[]),d=new Set,y=b=>{let g=c.get(b);if(!g)throw new Error("function does not have any path reservations");return{paths:g.paths.map(v=>l.get(v)),dirs:[...g.dirs].map(v=>l.get(v))}},x=b=>{let{paths:g,dirs:v}=y(b);return g.every(_=>_[0]===b)&&v.every(_=>_[0]instanceof Set&&_[0].has(b))},M=b=>d.has(b)||!x(b)?!1:(d.add(b),b(()=>w(b)),!0),w=b=>{if(!d.has(b))return!1;let{paths:g,dirs:v}=c.get(b),_=new Set;return g.forEach(T=>{let D=l.get(T);e.equal(D[0],b),D.length===1?l.delete(T):(D.shift(),typeof D[0]=="function"?_.add(D[0]):D[0].forEach(F=>_.add(F)))}),v.forEach(T=>{let D=l.get(T);e(D[0]instanceof Set),D[0].size===1&&D.length===1?l.delete(T):D[0].size===1?(D.shift(),_.add(D[0])):D[0].delete(b)}),d.delete(b),_.forEach(T=>M(T)),!0};return{check:x,reserve:(b,g)=>{b=o?["win32 parallelization disabled"]:b.map(_=>i(r(a(_))).normalize("NFKD").toLowerCase());let v=new Set(b.map(_=>p(_)).reduce((_,T)=>_.concat(T)));return c.set(g,{dirs:v,paths:b}),b.forEach(_=>{let T=l.get(_);T?T.push(g):l.set(_,[g])}),v.forEach(_=>{let T=l.get(_);T?T[T.length-1]instanceof Set?T[T.length-1].add(g):T.push(new Set([g])):l.set(_,[new Set([g])])}),M(g)}}}}),_n=Y((n,t)=>{"use strict";var e=U("assert"),r=U("events").EventEmitter,i=Ke(),a=U("fs"),s=Oe(),o=U("path"),l=Go(),c=l.sync,p=gn(),d=yn(),y=Vo(),x=he(),M=Ne(),w=Symbol("onEntry"),b=Symbol("checkFs"),g=Symbol("checkFs2"),v=Symbol("pruneCache"),_=Symbol("isReusable"),T=Symbol("makeFs"),D=Symbol("file"),F=Symbol("directory"),k=Symbol("link"),P=Symbol("symlink"),S=Symbol("hardlink"),R=Symbol("unsupported"),A=Symbol("unknown"),W=Symbol("checkPath"),z=Symbol("mkdir"),B=Symbol("onError"),h=Symbol("pending"),E=Symbol("pend"),N=Symbol("unpend"),O=Symbol("ended"),Z=Symbol("maybeClose"),X=Symbol("skip"),q=Symbol("doChown"),L=Symbol("uid"),C=Symbol("gid"),u=Symbol("checkedCwd"),I=U("crypto"),H=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,et=H==="win32",J=(f,$)=>{if(!et)return a.unlink(f,$);let j=f+".DELETE."+I.randomBytes(16).toString("hex");a.rename(f,j,V=>{if(V)return $(V);a.unlink(j,$)})},Ft=f=>{if(!et)return a.unlinkSync(f);let $=f+".DELETE."+I.randomBytes(16).toString("hex");a.renameSync(f,$),a.unlinkSync($)},Wt=(f,$,j)=>f===f>>>0?f:$===$>>>0?$:j,hn=f=>M(x(f)).normalize("NFKD").toLowerCase(),Po=(f,$)=>{$=hn($);for(let j of f.keys()){let V=hn(j);(V===$||V.indexOf($+"/")===0)&&f.delete(j)}},Eo=f=>{for(let $ of f.keys())f.delete($)},Cr=class extends i{constructor(f){if(f||(f={}),f.ondone=$=>{this[O]=!0,this[Z]()},super(f),this[u]=!1,this.reservations=y(),this.transform=typeof f.transform=="function"?f.transform:null,this.writable=!0,this.readable=!1,this[h]=0,this[O]=!1,this.dirCache=f.dirCache||new Map,typeof f.uid=="number"||typeof f.gid=="number"){if(typeof f.uid!="number"||typeof f.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(f.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=f.uid,this.gid=f.gid,this.setOwner=!0}else this.uid=null,this.gid=null,this.setOwner=!1;f.preserveOwner===void 0&&typeof f.uid!="number"?this.preserveOwner=process.getuid&&process.getuid()===0:this.preserveOwner=!!f.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():null,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():null,this.forceChown=f.forceChown===!0,this.win32=!!f.win32||et,this.newer=!!f.newer,this.keep=!!f.keep,this.noMtime=!!f.noMtime,this.preservePaths=!!f.preservePaths,this.unlink=!!f.unlink,this.cwd=x(o.resolve(f.cwd||process.cwd())),this.strip=+f.strip||0,this.processUmask=process.umask(),this.umask=typeof f.umask=="number"?f.umask:this.processUmask,this.dmode=f.dmode||511&~this.umask,this.fmode=f.fmode||438&~this.umask,this.on("entry",$=>this[w]($))}[Z](){this[O]&&this[h]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"),this.emit("close"))}[W](f){if(this.strip){let $=x(f.path).split("/");if($.length<this.strip)return!1;if(f.path=$.slice(this.strip).join("/"),f.type==="Link"){let j=x(f.linkpath).split("/");if(j.length>=this.strip)f.linkpath=j.slice(this.strip).join("/");else return!1}}if(!this.preservePaths){let $=x(f.path),j=$.split("/");if(j.includes("..")||et&&/^[a-z]:\.\.$/i.test(j[0]))return this.warn("path contains '..'",$),!1;let V=d($);V[0]&&(f.path=V[1],this.warn(`stripping ${V[0]} from absolute path`,$))}if(o.isAbsolute(f.path)?f.absolute=x(o.resolve(f.path)):f.absolute=x(o.resolve(this.cwd,f.path)),!this.preservePaths&&f.absolute.indexOf(this.cwd+"/")!==0&&f.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:f,path:x(f.path),resolvedPath:f.absolute,cwd:this.cwd}),!1;if(f.absolute===this.cwd&&f.type!=="Directory"&&f.type!=="GNUDumpDir")return!1;if(this.win32){let{root:$}=o.win32.parse(f.absolute);f.absolute=$+p.encode(f.absolute.substr($.length));let{root:j}=o.win32.parse(f.path);f.path=j+p.encode(f.path.substr(j.length))}return!0}[w](f){if(!this[W](f))return f.resume();switch(e.equal(typeof f.absolute,"string"),f.type){case"Directory":case"GNUDumpDir":f.mode&&(f.mode=f.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[b](f);case"CharacterDevice":case"BlockDevice":case"FIFO":return this[R](f)}}[B](f,$){f.name==="CwdError"?this.emit("error",f):(this.warn(f.message,f),this[N](),$.resume())}[z](f,$,j){l(x(f),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:$},j)}[q](f){return this.forceChown||this.preserveOwner&&(typeof f.uid=="number"&&f.uid!==this.processUid||typeof f.gid=="number"&&f.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[L](f){return Wt(this.uid,f.uid,this.processUid)}[C](f){return Wt(this.gid,f.gid,this.processGid)}[D](f,$){let j=f.mode&4095||this.fmode,V=new s.WriteStream(f.absolute,{mode:j,autoClose:!1});V.on("error",rt=>{V.fd&&a.close(V.fd,()=>{}),V.write=()=>!0,this[B](rt,f),$()});let it=1,st=rt=>{if(rt){V.fd&&a.close(V.fd,()=>{}),this[B](rt,f),$();return}--it===0&&a.close(V.fd,ct=>{$(),ct?this[B](ct,f):this[N]()})};V.on("finish",rt=>{let ct=f.absolute,gt=V.fd;if(f.mtime&&!this.noMtime){it++;let yt=f.atime||new Date,Lt=f.mtime;a.futimes(gt,yt,Lt,Ce=>Ce?a.utimes(ct,yt,Lt,Ir=>st(Ir&&Ce)):st())}if(this[q](f)){it++;let yt=this[L](f),Lt=this[C](f);a.fchown(gt,yt,Lt,Ce=>Ce?a.chown(ct,yt,Lt,Ir=>st(Ir&&Ce)):st())}st()});let at=this.transform&&this.transform(f)||f;at!==f&&(at.on("error",rt=>this[B](rt,f)),f.pipe(at)),at.pipe(V)}[F](f,$){let j=f.mode&4095||this.dmode;this[z](f.absolute,j,V=>{if(V)return $(),this[B](V,f);let it=1,st=at=>{--it===0&&($(),this[N](),f.resume())};f.mtime&&!this.noMtime&&(it++,a.utimes(f.absolute,f.atime||new Date,f.mtime,st)),this[q](f)&&(it++,a.chown(f.absolute,this[L](f),this[C](f),st)),st()})}[R](f){this.warn("unsupported entry type: "+f.type,f),f.resume()}[P](f,$){this[k](f,f.linkpath,"symlink",$)}[S](f,$){let j=x(o.resolve(this.cwd,f.linkpath));this[k](f,j,"link",$)}[E](){this[h]++}[N](){this[h]--,this[Z]()}[X](f){this[N](),f.resume()}[_](f,$){return f.type==="File"&&!this.unlink&&$.isFile()&&$.nlink<=1&&!et}[b](f){this[E]();let $=[f.path];f.linkpath&&$.push(f.linkpath),this.reservations.reserve($,j=>this[g](f,j))}[v](f){f.type==="SymbolicLink"?Eo(this.dirCache):f.type!=="Directory"&&Po(this.dirCache,f.absolute)}[g](f,$){this[v](f);let j=at=>{this[v](f),$(at)},V=()=>{this[z](this.cwd,this.dmode,at=>{if(at){this[B](at,f),j();return}this[u]=!0,it()})},it=()=>{if(f.absolute!==this.cwd){let at=x(o.dirname(f.absolute));if(at!==this.cwd)return this[z](at,this.dmode,rt=>{if(rt){this[B](rt,f),j();return}st()})}st()},st=()=>{a.lstat(f.absolute,(at,rt)=>{if(rt&&(this.keep||this.newer&&rt.mtime>f.mtime)){this[X](f),j();return}if(at||this[_](f,rt))return this[T](null,f,j);if(rt.isDirectory()){if(f.type==="Directory"){let ct=!this.noChmod&&f.mode&&(rt.mode&4095)!==f.mode,gt=yt=>this[T](yt,f,j);return ct?a.chmod(f.absolute,f.mode,gt):gt()}if(f.absolute!==this.cwd)return a.rmdir(f.absolute,ct=>this[T](ct,f,j))}if(f.absolute===this.cwd)return this[T](null,f,j);J(f.absolute,ct=>this[T](ct,f,j))})};this[u]?it():V()}[T](f,$,j){if(f)return this[B](f,$);switch($.type){case"File":case"OldFile":case"ContiguousFile":return this[D]($,j);case"Link":return this[S]($,j);case"SymbolicLink":return this[P]($,j);case"Directory":case"GNUDumpDir":return this[F]($,j)}}[k](f,$,j,V){a[j]($,f.absolute,it=>{if(it)return this[B](it,f);V(),this[N](),f.resume()})}},Xe=f=>{try{return[null,f()]}catch($){return[$,null]}},Fo=class extends Cr{[T](f,$){return super[T](f,$,()=>{})}[b](f){if(this[v](f),!this[u]){let it=this[z](this.cwd,this.dmode);if(it)return this[B](it,f);this[u]=!0}if(f.absolute!==this.cwd){let it=x(o.dirname(f.absolute));if(it!==this.cwd){let st=this[z](it,this.dmode);if(st)return this[B](st,f)}}let[$,j]=Xe(()=>a.lstatSync(f.absolute));if(j&&(this.keep||this.newer&&j.mtime>f.mtime))return this[X](f);if($||this[_](f,j))return this[T](null,f);if(j.isDirectory()){if(f.type==="Directory"){let st=!this.noChmod&&f.mode&&(j.mode&4095)!==f.mode,[at]=st?Xe(()=>{a.chmodSync(f.absolute,f.mode)}):[];return this[T](at,f)}let[it]=Xe(()=>a.rmdirSync(f.absolute));this[T](it,f)}let[V]=f.absolute===this.cwd?[]:Xe(()=>Ft(f.absolute));this[T](V,f)}[D](f,$){let j=f.mode&4095||this.fmode,V=rt=>{let ct;try{a.closeSync(st)}catch(gt){ct=gt}(rt||ct)&&this[B](rt||ct,f),$()},it,st;try{st=a.openSync(f.absolute,"w",j)}catch(rt){return V(rt)}let at=this.transform&&this.transform(f)||f;at!==f&&(at.on("error",rt=>this[B](rt,f)),f.pipe(at)),at.on("data",rt=>{try{a.writeSync(st,rt,0,rt.length)}catch(ct){V(ct)}}),at.on("end",rt=>{let ct=null;if(f.mtime&&!this.noMtime){let gt=f.atime||new Date,yt=f.mtime;try{a.futimesSync(st,gt,yt)}catch(Lt){try{a.utimesSync(f.absolute,gt,yt)}catch{ct=Lt}}}if(this[q](f)){let gt=this[L](f),yt=this[C](f);try{a.fchownSync(st,gt,yt)}catch(Lt){try{a.chownSync(f.absolute,gt,yt)}catch{ct=ct||Lt}}}V(ct)})}[F](f,$){let j=f.mode&4095||this.dmode,V=this[z](f.absolute,j);if(V){this[B](V,f),$();return}if(f.mtime&&!this.noMtime)try{a.utimesSync(f.absolute,f.atime||new Date,f.mtime)}catch{}if(this[q](f))try{a.chownSync(f.absolute,this[L](f),this[C](f))}catch{}$(),f.resume()}[z](f,$){try{return l.sync(x(f),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:$})}catch(j){return j}}[k](f,$,j,V){try{a[j+"Sync"]($,f.absolute),V(),f.resume()}catch(it){return this[B](it,f)}}};Cr.Sync=Fo,t.exports=Cr}),Yo=Y((n,t)=>{"use strict";var e=Ie(),r=_n(),i=U("fs"),a=Oe(),s=U("path"),o=Ne(),l=t.exports=(M,w,b)=>{typeof M=="function"?(b=M,w=null,M={}):Array.isArray(M)&&(w=M,M={}),typeof w=="function"&&(b=w,w=null),w?w=Array.from(w):w=[];let g=e(M);if(g.sync&&typeof b=="function")throw new TypeError("callback not supported for sync tar functions");if(!g.file&&typeof b=="function")throw new TypeError("callback only supported with file option");return w.length&&c(g,w),g.file&&g.sync?p(g):g.file?d(g,b):g.sync?y(g):x(g)},c=(M,w)=>{let b=new Map(w.map(_=>[o(_),!0])),g=M.filter,v=(_,T)=>{let D=T||s.parse(_).root||".",F=_===D?!1:b.has(_)?b.get(_):v(s.dirname(_),D);return b.set(_,F),F};M.filter=g?(_,T)=>g(_,T)&&v(o(_)):_=>v(o(_))},p=M=>{let w=new r.Sync(M),b=M.file,g=!0,v,_=i.statSync(b),T=M.maxReadSize||16*1024*1024;new a.ReadStreamSync(b,{readSize:T,size:_.size}).pipe(w)},d=(M,w)=>{let b=new r(M),g=M.maxReadSize||16*1024*1024,v=M.file,_=new Promise((T,D)=>{b.on("error",D),b.on("close",T),i.stat(v,(F,k)=>{if(F)D(F);else{let P=new a.ReadStream(v,{readSize:g,size:k.size});P.on("error",D),P.pipe(b)}})});return w?_.then(w,w):_},y=M=>new r.Sync(M),x=M=>new r(M)}),Zo=Y(n=>{"use strict";n.c=n.create=zo(),n.r=n.replace=wn(),n.t=n.list=$r(),n.u=n.update=Ho(),n.x=n.extract=Yo(),n.Pack=Wr(),n.Unpack=_n(),n.Parse=Ke(),n.ReadEntry=Je(),n.WriteEntry=vn(),n.Header=Ae(),n.Pax=Or(),n.types=Nr()}),Xo=Y((n,t)=>{var e=Zo(),r=U("fs"),i=U("zlib"),a=U("path"),s=U("os"),o=a.join(s.tmpdir(),"tfjs-node"),l=typeof __webpack_require__=="function"?__non_webpack_require__:U;function c(){return process.env.NOW_REGION==="dev1"?!1:!!process.env.AWS_LAMBDA_FUNCTION_NAME}async function p(){let x=l(o);return x.disableDeprecationWarnings(),x}async function d(x){return c()?(r.existsSync(o)||(r.mkdirSync(o),await new Promise((M,w)=>{let b=e.x({cwd:o});b.on("finish",M),b.on("error",w),x.pipe(i.createBrotliDecompress()).pipe(b)})),p()):l("@tensorflow/tfjs-node")}var y;t.exports=function(x){return y||(y=d(x)),y}}),qo=ko(Xo(),1),pn="4.9.0",Ko="4.9.0",Qo="4.9.0",ti="4.9.0",ei="4.9.0",ri={tfjs:pn,"tfjs-core":pn,"tfjs-converter":Ko,"tfjs-backend-cpu":Qo,"tfjs-backend-webgl":ti,"tfjs-backend-wasm":ei},ni=async n=>await(await fetch(n)).arrayBuffer(),oi=await ni("https://github.com/jlarmstrongiv/tfjs-node-lambda/releases/download/v2.0.10/nodejs12.x-tf2.8.6.br"),ii=Jo.from(Buffer.from(oi)),si=await(0,qo.default)(ii),ai=si;var jn={};kr(jn,{AnchorPosition:()=>qr,DrawBox:()=>$e,DrawBoxOptions:()=>nr,DrawFaceLandmarks:()=>dr,DrawFaceLandmarksOptions:()=>fr,DrawTextField:()=>At,DrawTextFieldOptions:()=>be,drawContour:()=>Rt,drawDetections:()=>fi,drawFaceExpressions:()=>di,drawFaceLandmarks:()=>gi});function Rt(n,t,e=!1){if(n.beginPath(),t.slice(1).forEach(({x:r,y:i},a)=>{let s=t[a];n.moveTo(s.x,s.y),n.lineTo(r,i)}),e){let r=t[t.length-1],i=t[0];if(!r||!i)return;n.moveTo(r.x,r.y),n.lineTo(i.x,i.y)}n.stroke()}var Tn={};kr(Tn,{computeReshapedDimensions:()=>jr,getCenterPoint:()=>Qt,isDimensions:()=>tr,isEven:()=>Qe,isFloat:()=>Hr,isTensor:()=>Jt,isTensor1D:()=>ci,isTensor2D:()=>zr,isTensor3D:()=>Ct,isTensor4D:()=>vt,isValidNumber:()=>Pt,isValidProbablitiy:()=>le,range:()=>Dt,round:()=>Kt});var mt=class{_width;_height;constructor(t,e){if(!Pt(t)||!Pt(e))throw new Error(`Dimensions.constructor - expected width and height to be valid numbers, instead have ${JSON.stringify({width:t,height:e})}`);this._width=t,this._height=e}get width(){return this._width}get height(){return this._height}reverse(){return new mt(1/this.width,1/this.height)}};function Jt(n,t){return n instanceof void 0&&n.shape.length===t}function ci(n){return Jt(n,1)}function zr(n){return Jt(n,2)}function Ct(n){return Jt(n,3)}function vt(n){return Jt(n,4)}function Hr(n){return n%1!==0}function Qe(n){return n%2===0}function Kt(n,t=2){let e=10**t;return Math.floor(n*e)/e}function tr(n){return n&&n.width&&n.height}function jr({width:n,height:t},e){let r=e/Math.max(t,n);return new mt(Math.round(n*r),Math.round(t*r))}function Qt(n){return n.reduce((t,e)=>t.add(e),new G(0,0)).div(new G(n.length,n.length))}function Dt(n,t,e){return Array(n).fill(0).map((r,i)=>t+i*e)}function Pt(n){return!!n&&n!==1/0&&n!==-1/0&&!Number.isNaN(n)||n===0}function le(n){return Pt(n)&&n>=0&&n<=1}var G=class{_x;_y;constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}add(t){return new G(this.x+t.x,this.y+t.y)}sub(t){return new G(this.x-t.x,this.y-t.y)}mul(t){return new G(this.x*t.x,this.y*t.y)}div(t){return new G(this.x/t.x,this.y/t.y)}abs(){return new G(Math.abs(this.x),Math.abs(this.y))}magnitude(){return Math.sqrt(this.x**2+this.y**2)}floor(){return new G(Math.floor(this.x),Math.floor(this.y))}};var tt=class{static isRect(t){return!!t&&[t.x,t.y,t.width,t.height].every(Pt)}static assertIsValidBox(t,e,r=!1){if(!tt.isRect(t))throw new Error(`${e} - invalid box: ${JSON.stringify(t)}, expected object with properties x, y, width, height`);if(!r&&(t.width<0||t.height<0))throw new Error(`${e} - width (${t.width}) and height (${t.height}) must be positive numbers`)}_x;_y;_width;_height;constructor(t,e=!0){let r=t||{},i=[r.left,r.top,r.right,r.bottom].every(Pt),a=[r.x,r.y,r.width,r.height].every(Pt);if(!a&&!i)throw new Error(`Box.constructor - expected box to be IBoundingBox | IRect, instead have ${JSON.stringify(r)}`);let[s,o,l,c]=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top];tt.assertIsValidBox({x:s,y:o,width:l,height:c},"Box.constructor",e),this._x=s,this._y=o,this._width=l,this._height=c}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get area(){return this.width*this.height}get topLeft(){return new G(this.left,this.top)}get topRight(){return new G(this.right,this.top)}get bottomLeft(){return new G(this.left,this.bottom)}get bottomRight(){return new G(this.right,this.bottom)}round(){let[t,e,r,i]=[this.x,this.y,this.width,this.height].map(a=>Math.round(a));return new tt({x:t,y:e,width:r,height:i})}floor(){let[t,e,r,i]=[this.x,this.y,this.width,this.height].map(a=>Math.floor(a));return new tt({x:t,y:e,width:r,height:i})}toSquare(){let{x:t,y:e,width:r,height:i}=this,a=Math.abs(r-i);return r<i&&(t-=a/2,r+=a),i<r&&(e-=a/2,i+=a),new tt({x:t,y:e,width:r,height:i})}rescale(t){let e=tr(t)?t.width:t,r=tr(t)?t.height:t;return new tt({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})}pad(t,e){let[r,i,a,s]=[this.x-t/2,this.y-e/2,this.width+t,this.height+e];return new tt({x:r,y:i,width:a,height:s})}clipAtImageBorders(t,e){let{x:r,y:i,right:a,bottom:s}=this,o=Math.max(r,0),l=Math.max(i,0),c=a-o,p=s-l,d=Math.min(c,t-o),y=Math.min(p,e-l);return new tt({x:o,y:l,width:d,height:y}).floor()}shift(t,e){let{width:r,height:i}=this,a=this.x+t,s=this.y+e;return new tt({x:a,y:s,width:r,height:i})}padAtBorders(t,e){let r=this.width+1,i=this.height+1,a=1,s=1,o=r,l=i,c=this.left,p=this.top,d=this.right,y=this.bottom;return d>e&&(o=-d+e+r,d=e),y>t&&(l=-y+t+i,y=t),c<1&&(l=2-c,c=1),p<1&&(l=2-p,p=1),{dy:s,edy:l,dx:a,edx:o,y:p,ey:y,x:c,ex:d,w:r,h:i}}calibrate(t){return new tt({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}};var me=class extends tt{constructor(t,e,r,i,a=!1){super({left:t,top:e,right:r,bottom:i},a)}};var $t=class{_score;_classScore;_className;_box;_imageDims;constructor(t,e,r,i,a){this._imageDims=new mt(a.width,a.height),this._score=t,this._classScore=e,this._className=r,this._box=new tt(i).rescale(this._imageDims)}get score(){return this._score}get classScore(){return this._classScore}get className(){return this._className}get box(){return this._box}get imageDims(){return this._imageDims}get imageWidth(){return this.imageDims.width}get imageHeight(){return this.imageDims.height}get relativeBox(){return new tt(this._box).rescale(this.imageDims.reverse())}forSize(t,e){return new $t(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})}};var nt=class extends $t{constructor(t,e,r){super(t,t,"",e,r)}forSize(t,e){let{score:r,relativeBox:i,imageDims:a}=super.forSize(t,e);return new nt(r,i,a)}};function Pn(n,t,e=!0){let r=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left)),i=Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top)),a=r*i;return e?a/(n.area+t.area-a):a/Math.min(n.area,t.area)}function En(n){let t=n.map(o=>o.x),e=n.map(o=>o.y),r=t.reduce((o,l)=>l<o?l:o,1/0),i=e.reduce((o,l)=>l<o?l:o,1/0),a=t.reduce((o,l)=>o<l?l:o,0),s=e.reduce((o,l)=>o<l?l:o,0);return new me(r,i,a,s)}function Fn(n,t,e,r=!0){let i=t.map((s,o)=>({score:s,boxIndex:o})).sort((s,o)=>s.score-o.score).map(s=>s.boxIndex),a=[];for(;i.length>0;){let s=i.pop();a.push(s);let o=i,l=[];for(let c=0;c<o.length;c++){let p=o[c],d=n[s],y=n[p];l.push(Pn(d,y,r))}i=i.filter((c,p)=>l[p]<=e)}return a}function St(n,t){return(void 0)(()=>{let[e,r,i]=t,a=(void 0)([...n.shape.slice(0,3),1],e,"float32"),s=(void 0)([...n.shape.slice(0,3),1],r,"float32"),o=(void 0)([...n.shape.slice(0,3),1],i,"float32"),l=(void 0)([a,s,o],3);return(void 0)(n,l)})}function Dn(n,t=!1){return(void 0)(()=>{let[e,r]=n.shape.slice(1);if(e===r)return n;let i=Math.abs(e-r),a=Math.round(i*(t?.5:1)),s=e>r?2:1,o=y=>{let x=n.shape.slice();return x[s]=y,(void 0)(x,0,"float32")},l=o(a),c=i-l.shape[s],d=[t&&c?o(c):null,n,l].filter(y=>!!y).map(y=>(void 0)(y,"float32"));return(void 0)(d,s)})}function Xs(n){let t=n.slice();for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[r],t[r]=i}return t}function er(n){return 1/(1+Math.exp(-n))}function Js(n){return Math.log(n/(1-n))}var pe=class extends tt{constructor(t,e,r,i,a=!1){super({x:t,y:e,width:r,height:i},a)}};var hi=.5,li=.43,mi=.45,xt=class{_shift;_positions;_imgDims;constructor(t,e,r=new G(0,0)){let{width:i,height:a}=e;this._imgDims=new mt(i,a),this._shift=r,this._positions=t.map(s=>s.mul(new G(i,a)).add(r))}get shift(){return new G(this._shift.x,this._shift.y)}get imageWidth(){return this._imgDims.width}get imageHeight(){return this._imgDims.height}get positions(){return this._positions}get relativePositions(){return this._positions.map(t=>t.sub(this._shift).div(new G(this.imageWidth,this.imageHeight)))}forSize(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})}shiftBy(t,e){return new this.constructor(this.relativePositions,this._imgDims,new G(t,e))}shiftByPoint(t){return this.shiftBy(t.x,t.y)}align(t,e={}){if(t){let a=t instanceof nt?t.box.floor():new tt(t);return this.shiftBy(a.x,a.y).align(null,e)}let{useDlibAlignment:r,minBoxPadding:i}={useDlibAlignment:!1,minBoxPadding:.2,...e};return r?this.alignDlib():this.alignMinBbox(i)}alignDlib(){let t=this.getRefPointsForAlignment(),[e,r,i]=t,a=d=>i.sub(d).magnitude(),s=(a(e)+a(r))/2,o=Math.floor(s/mi),l=Qt(t),c=Math.floor(Math.max(0,l.x-hi*o)),p=Math.floor(Math.max(0,l.y-li*o));return new pe(c,p,Math.min(o,this.imageWidth+c),Math.min(o,this.imageHeight+p))}alignMinBbox(t){let e=En(this.positions);return e.pad(e.width*t,e.height*t)}getRefPointsForAlignment(){throw new Error("getRefPointsForAlignment not implemented by base class")}};var Sn=class extends xt{getRefPointsForAlignment(){let t=this.positions;return[t[0],t[1],Qt([t[3],t[4]])]}};var ue=class extends xt{getJawOutline(){return this.positions.slice(0,17)}getLeftEyeBrow(){return this.positions.slice(17,22)}getRightEyeBrow(){return this.positions.slice(22,27)}getNose(){return this.positions.slice(27,36)}getLeftEye(){return this.positions.slice(36,42)}getRightEye(){return this.positions.slice(42,48)}getMouth(){return this.positions.slice(48,68)}getRefPointsForAlignment(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Qt)}};var Be=class{_label;_distance;constructor(t,e){this._label=t,this._distance=e}get label(){return this._label}get distance(){return this._distance}toString(t=!0){return`${this.label}${t?` (${Kt(this.distance)})`:""}`}};var We=class extends tt{static assertIsValidLabeledBox(t,e){if(tt.assertIsValidBox(t,e),!Pt(t.label))throw new Error(`${e} - expected property label (${t.label}) to be a number`)}_label;constructor(t,e){super(t),this._label=e}get label(){return this._label}};var It=class{_label;_descriptors;constructor(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(r=>!(r instanceof Float32Array)))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}get label(){return this._label}get descriptors(){return this._descriptors}toJSON(){return{label:this.label,descriptors:this.descriptors.map(t=>Array.from(t))}}static fromJSON(t){let e=t.descriptors.map(r=>new Float32Array(r));return new It(t.label,e)}};var Mn=class extends We{static assertIsValidPredictedBox(t,e){if(We.assertIsValidLabeledBox(t,e),!le(t.score)||!le(t.classScore))throw new Error(`${e} - expected properties score (${t.score}) and (${t.classScore}) to be a number between [0, 1]`)}_score;_classScore;constructor(t,e,r,i){super(t,e),this._score=r,this._classScore=i}get score(){return this._score}get classScore(){return this._classScore}};function kt(n){return n.detection instanceof nt}function fe(n,t){return{...n,...{detection:t}}}function Ur(){let n=window.fetch;if(!n)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:()=>document.createElement("canvas"),createImageElement:()=>document.createElement("img"),createVideoElement:()=>document.createElement("video"),fetch:n,readFile:()=>{throw new Error("readFile - filesystem not available for browser environment")}}}function rr(n){let t="";return{readFile:n?r=>new Promise((i,a)=>{n.readFile(r,(s,o)=>s?a(s):i(o))}):()=>{throw new Error(`readFile - failed to require fs in nodejs environment with error: ${t}`)}}}function Gr(){let n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=global.Video||global.HTMLVideoElement,r=()=>{if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},i=()=>{if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=()=>{if(e)return new e;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},s=global.fetch,o=rr();return{Canvas:n||class{},CanvasRenderingContext2D:global.CanvasRenderingContext2D||class{},Image:t||class{},ImageData:global.ImageData||class{},Video:global.HTMLVideoElement||class{},createCanvasElement:r,createImageElement:i,createVideoElement:a,fetch:s,...o}}function Vr(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Yr(){return typeof global=="object"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null}var ht;function pi(){if(!ht)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ht}function Zr(n){ht=n}function Xr(){return Vr()?Zr(Ur()):Yr()?Zr(Gr()):null}function ui(n){if(ht||Xr(),!ht)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");let{Canvas:t=ht.Canvas,Image:e=ht.Image}=n;ht.Canvas=t,ht.Image=e,ht.createCanvasElement=n.createCanvasElement||(()=>new t),ht.createImageElement=n.createImageElement||(()=>new e),ht.ImageData=n.ImageData||ht.ImageData,ht.Video=n.Video||ht.Video,ht.fetch=n.fetch||ht.fetch,ht.readFile=n.readFile||ht.readFile}var K={getEnv:pi,setEnv:Zr,initialize:Xr,createBrowserEnv:Ur,createFileSystem:rr,createNodejsEnv:Gr,monkeyPatch:ui,isBrowser:Vr,isNodejs:Yr};Xr();function de(n){return!K.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function dt(n){let{Canvas:t,CanvasRenderingContext2D:e}=K.getEnv();if(n instanceof e)return n;let r=de(n);if(!(r instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");let i=r.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var qr=(i=>(i.TOP_LEFT="TOP_LEFT",i.TOP_RIGHT="TOP_RIGHT",i.BOTTOM_LEFT="BOTTOM_LEFT",i.BOTTOM_RIGHT="BOTTOM_RIGHT",i))(qr||{}),be=class{anchorPosition;backgroundColor;fontColor;fontSize;fontStyle;padding;constructor(t={}){let{anchorPosition:e,backgroundColor:r,fontColor:i,fontSize:a,fontStyle:s,padding:o}=t;this.anchorPosition=e||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=s||"Georgia",this.padding=o||4}},At=class{text;anchor;options;constructor(t,e,r={}){this.text=typeof t=="string"?[t]:t instanceof At?t.text:t,this.anchor=e,this.options=new be(r)}measureWidth(t){let{padding:e}=this.options;return this.text.map(r=>t.measureText(r).width).reduce((r,i)=>r<i?i:r,0)+2*e}measureHeight(){let{fontSize:t,padding:e}=this.options;return this.text.length*t+2*e}getUpperLeft(t,e){let{anchorPosition:r}=this.options,i=r==="BOTTOM_RIGHT"||r==="TOP_RIGHT",a=r==="BOTTOM_LEFT"||r==="BOTTOM_RIGHT",s=this.measureWidth(t),o=this.measureHeight(),l=i?this.anchor.x-s:this.anchor.x,c=a?this.anchor.y-o:this.anchor.y;if(e){let{width:p,height:d}=e,y=Math.max(Math.min(l,p-s),0),x=Math.max(Math.min(c,d-o),0);return{x:y,y:x}}return{x:l,y:c}}draw(t){let e=de(t),r=dt(e),{backgroundColor:i,fontColor:a,fontSize:s,fontStyle:o,padding:l}=this.options;r.font=`${s}px ${o}`;let c=this.measureWidth(r),p=this.measureHeight();r.fillStyle=i;let d=this.getUpperLeft(r,e);r.fillRect(d.x,d.y,c,p),r.fillStyle=a,this.text.forEach((y,x)=>{let M=l+d.x,w=l+d.y+(x+1)*s;r.fillText(y,M,w)})}};var nr=class{boxColor;lineWidth;drawLabelOptions;label;constructor(t={}){let{boxColor:e,lineWidth:r,label:i,drawLabelOptions:a}=t;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=i;let s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new be({...s,...a})}},$e=class{box;options;constructor(t,e={}){this.box=new tt(t),this.options=new nr(e)}draw(t){let e=dt(t),{boxColor:r,lineWidth:i}=this.options,{x:a,y:s,width:o,height:l}=this.box;e.strokeStyle=r,e.lineWidth=i,e.strokeRect(a,s,o,l);let{label:c}=this.options;c&&new At([c],{x:a-i/2,y:s},this.options.drawLabelOptions).draw(t)}};function fi(n,t){(Array.isArray(t)?t:[t]).forEach(r=>{let i=r instanceof nt?r.score:kt(r)?r.detection.score:void 0,a=r instanceof nt?r.box:kt(r)?r.detection.box:new tt(r),s=i?`${Kt(i)}`:void 0;new $e(a,{label:s}).draw(n)})}function or(n){let{Image:t,Video:e}=K.getEnv();return n instanceof t&&n.complete||n instanceof e&&n.readyState>=3}function Ln(n){return new Promise((t,e)=>{(n instanceof K.getEnv().Canvas||or(n))&&t(null);function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",i),a.currentTarget.removeEventListener("error",r),e(a))}function i(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",i),a.currentTarget.removeEventListener("error",r),t(a))}n.addEventListener("load",i),n.addEventListener("error",r)})}function Rn(n){return new Promise((t,e)=>{n instanceof Blob||e(new Error("bufferToImage - expected buf to be of type: Blob"));let r=new FileReader;r.onload=()=>{typeof r.result!="string"&&e(new Error("bufferToImage - expected reader.result to be a string, in onload"));let i=K.getEnv().createImageElement();i.onload=()=>t(i),i.onerror=e,i.src=r.result},r.onerror=e,r.readAsDataURL(n)})}function ge(n){let{Image:t,Video:e}=K.getEnv();return n instanceof t?new mt(n.naturalWidth,n.naturalHeight):n instanceof e?new mt(n.videoWidth,n.videoHeight):new mt(n.width,n.height)}function ye({width:n,height:t}){let{createCanvasElement:e}=K.getEnv(),r=e();return r.width=n,r.height=t,r}function ir(n,t){let{ImageData:e}=K.getEnv();if(!(n instanceof e)&&!or(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");let{width:r,height:i}=t||ge(n),a=ye({width:r,height:i});return n instanceof e?dt(a).putImageData(n,0,0):dt(a).drawImage(n,0,0,r,i),a}async function Cn(n,t){let e=t||K.getEnv().createCanvasElement(),[r,i,a]=n.shape.slice(vt(n)?1:0),s=(void 0)(()=>n.as3D(r,i,a).toInt());return await(void 0).toPixels(s,e),s.dispose(),e}function Jr(n){let{Image:t,Canvas:e,Video:r}=K.getEnv();return n instanceof t||n instanceof e||n instanceof r}function In(n,t,e=!1){let{Image:r,Canvas:i}=K.getEnv();if(!(n instanceof r||n instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return ye({width:1,height:1});let a=ge(n),s=t/Math.max(a.height,a.width),o=s*a.width,l=s*a.height,c=ye({width:t,height:t}),p=n instanceof i?n:ir(n),d=Math.abs(o-l)/2,y=e&&o<l?d:0,x=e&&l<o?d:0;return p.width>0&&p.height>0&&dt(c).drawImage(p,y,x,o,l),c}var Nt=class{_imageTensors=[];_canvases=[];_batchSize;_treatAsBatchInput=!1;_inputDimensions=[];_inputSize=0;constructor(t,e=!1){if(!Array.isArray(t))throw new Error(`NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ${t}`);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach((r,i)=>{if(Ct(r)){this._imageTensors[i]=r,this._inputDimensions[i]=r.shape;return}if(vt(r)){let s=r.shape[0];if(s!==1)throw new Error(`NetInput - tf.Tensor4D with batchSize ${s} passed, but not supported in input array`);this._imageTensors[i]=r,this._inputDimensions[i]=r.shape.slice(1);return}let a=r instanceof K.getEnv().Canvas?r:ir(r);this._canvases[i]=a,this._inputDimensions[i]=[a.height,a.width,3]})}get imageTensors(){return this._imageTensors}get canvases(){return this._canvases}get isBatchInput(){return this.batchSize>1||this._treatAsBatchInput}get batchSize(){return this._batchSize}get inputDimensions(){return this._inputDimensions}get inputSize(){return this._inputSize}get reshapedInputDimensions(){return Dt(this.batchSize,0,1).map((t,e)=>this.getReshapedInputDimensions(e))}getInput(t){return this.canvases[t]||this.imageTensors[t]}getInputDimensions(t){return this._inputDimensions[t]}getInputHeight(t){return this._inputDimensions[t][0]}getInputWidth(t){return this._inputDimensions[t][1]}getReshapedInputDimensions(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");let e=this.getInputWidth(t),r=this.getInputHeight(t);return jr({width:e,height:r},this.inputSize)}toBatchTensor(t,e=!0){return this._inputSize=t,(void 0)(()=>{let r=Dt(this.batchSize,0,1).map(a=>{let s=this.getInput(a);if(s instanceof void 0){let o=vt(s)?s:(void 0)(s);return o=Dn(o,e),(o.shape[1]!==t||o.shape[2]!==t)&&(o=(void 0).resizeBilinear(o,[t,t],!1,!1)),o.as3D(t,t,3)}if(s instanceof K.getEnv().Canvas)return(void 0).fromPixels(In(s,t,e));throw new Error(`toBatchTensor - at batchIdx ${a}, expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ${s}`)});return(void 0)(r.map(a=>(void 0)(a,"float32"))).as4D(this.batchSize,t,t,3)})}};async function ot(n){if(n instanceof Nt)return n;let t=Array.isArray(n)?n:[n];if(!t.length)throw new Error("toNetInput - empty array passed as input");let e=i=>Array.isArray(n)?` at input index ${i}:`:"",r=t.map(de);return r.forEach((i,a)=>{if(!Jr(i)&&!Ct(i)&&!vt(i))throw typeof t[a]=="string"?new Error(`toNetInput -${e(a)} string passed, but could not resolve HTMLElement for element id ${t[a]}`):new Error(`toNetInput -${e(a)} expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id`);if(vt(i)){let s=i.shape[0];if(s!==1)throw new Error(`toNetInput -${e(a)} tf.Tensor4D with batchSize ${s} passed, but not supported in input array`)}}),await Promise.all(r.map(i=>Jr(i)&&Ln(i))),new Nt(r,Array.isArray(n))}async function ze(n,t){let{Canvas:e}=K.getEnv(),r=n;if(!(n instanceof e)){let s=await ot(n);if(s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");let o=s.getInput(0);r=o instanceof e?o:await Cn(o)}let i=dt(r);return t.map(s=>s instanceof nt?s.forSize(r.width,r.height).box.floor():s).map(s=>s.clipAtImageBorders(r.width,r.height)).map(({x:s,y:o,width:l,height:c})=>{let p=ye({width:l,height:c});return l>0&&c>0&&dt(p).putImageData(i.getImageData(s,o,l,c),0,0),p})}async function He(n,t){if(!Ct(n)&&!vt(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(vt(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return(void 0)(()=>{let[e,r,i]=n.shape.slice(vt(n)?1:0);return t.map(o=>o instanceof nt?o.forSize(r,e).box:o).map(o=>o.clipAtImageBorders(r,e)).filter(o=>o.width>0&&o.height>0).map(({x:o,y:l,width:c,height:p})=>(void 0)(n.as3D(e,r,i),[l,o,0],[p,c,i]))})}async function zt(n,t){let{fetch:e}=K.getEnv(),r=await e(n,t);if(!(r.status<400))throw new Error(`failed to fetch: (${r.status}) ${r.statusText}, from url: ${r.url}`);return r}async function Ah(n){let t=await zt(n),e=await t.blob();if(!e.type.startsWith("image/"))throw new Error(`fetchImage - expected blob type to be of type image/*, instead have: ${e.type}, for url: ${t.url}`);return Rn(e)}async function kn(n){return(await zt(n)).json()}async function $h(n){return new Float32Array(await(await zt(n)).arrayBuffer())}function An(n){return new Promise((t,e)=>{n instanceof Blob||e(new Error("bufferToVideo - expected buf to be of type: Blob"));let r=K.getEnv().createVideoElement();r.oncanplay=()=>t(r),r.onerror=e,r.playsInline=!0,r.muted=!0,r.src=URL.createObjectURL(n),r.play()})}async function Vh(n){let t=await zt(n),e=await t.blob();if(!e.type.startsWith("video/"))throw new Error(`fetchVideo - expected blob type to be of type video/*, instead have: ${e.type}, for url: ${t.url}`);return An(e)}function sr(n,t){let e=`${t}-weights_manifest.json`;if(!n)return{modelBaseUri:"",manifestUri:e};if(n==="/")return{modelBaseUri:"/",manifestUri:`/${e}`};let r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");let i=n.split("/").filter(o=>o),a=n.endsWith(".json")?i[i.length-1]:e,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=n.startsWith("/")?`/${s}`:s,{modelBaseUri:s,manifestUri:s==="/"?`/${a}`:`${s}/${a}`}}async function Nn(n,t){let{manifestUri:e,modelBaseUri:r}=sr(n,t),i=await kn(e);return(void 0).loadWeights(i,r)}function Qh(n,t,e=!1){let{width:r,height:i}=e?ge(t):t;return n.width=r,n.height=i,{width:r,height:i}}var lt=class{constructor(t){this._name=t}_params=void 0;_paramMappings=[];_name;get params(){return this._params}get paramMappings(){return this._paramMappings}get isLoaded(){return!!this.params}getParamFromPath(t){let{obj:e,objProp:r}=this.traversePropertyPath(t);return e[r]}reassignParamFromPath(t,e){let{obj:r,objProp:i}=this.traversePropertyPath(t);r[i].dispose(),r[i]=e}getParamList(){return this._paramMappings.map(({paramPath:t})=>({path:t,tensor:this.getParamFromPath(t)}))}getTrainableParams(){return this.getParamList().filter(t=>t.tensor instanceof void 0)}getFrozenParams(){return this.getParamList().filter(t=>!(t.tensor instanceof void 0))}variable(){this.getFrozenParams().forEach(({path:t,tensor:e})=>{this.reassignParamFromPath(t,e.variable())})}freeze(){this.getTrainableParams().forEach(({path:t,tensor:e})=>{let r=(void 0)(e.dataSync());e.dispose(),this.reassignParamFromPath(t,r)})}dispose(t=!0){this.getParamList().forEach(e=>{if(t&&e.tensor.isDisposed)throw new Error(`param tensor has already been disposed for path ${e.path}`);e.tensor.dispose()}),this._params=void 0}serializeParams(){return new Float32Array(this.getParamList().map(({tensor:t})=>Array.from(t.dataSync())).reduce((t,e)=>t.concat(e)))}async load(t){if(t instanceof Float32Array){this.extractWeights(t);return}await this.loadFromUri(t)}async loadFromUri(t){if(t&&typeof t!="string")throw new Error(`${this._name}.loadFromUri - expected model uri`);let e=await Nn(t,this.getDefaultModelName());this.loadFromWeightMap(e)}async loadFromDisk(t){if(t&&typeof t!="string")throw new Error(`${this._name}.loadFromDisk - expected model file path`);let{readFile:e}=K.getEnv(),{manifestUri:r,modelBaseUri:i}=sr(t,this.getDefaultModelName()),a=c=>Promise.all(c.map(p=>e(p).then(d=>d.buffer))),s=(void 0).weightsLoaderFactory(a),o=JSON.parse((await e(r)).toString()),l=await s(o,i);this.loadFromWeightMap(l)}loadFromWeightMap(t){let{paramMappings:e,params:r}=this.extractParamsFromWeightMap(t);this._paramMappings=e,this._params=r}extractWeights(t){let{paramMappings:e,params:r}=this.extractParams(t);this._paramMappings=e,this._params=r}traversePropertyPath(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");let e=t.split("/").reduce((a,s)=>{if(!a.nextObj.hasOwnProperty(s))throw new Error(`traversePropertyPath - object does not have property ${s}, for path ${t}`);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),{obj:r,objProp:i}=e;if(!r||!i||!(r[i]instanceof void 0))throw new Error(`traversePropertyPath - parameter is not a tensor, for path ${t}`);return{obj:r,objProp:i}}};function ft(n,t,e){return(void 0)(()=>{let r=(void 0)(n,t.depthwise_filter,t.pointwise_filter,e,"same");return r=(void 0)(r,t.bias),r})}function ar(n,t,e=!1){return(void 0)(()=>{let r=(void 0)(e?(void 0)((void 0)(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):ft(n,t.conv0,[2,2])),i=ft(r,t.conv1,[1,1]),a=(void 0)((void 0)(r,i)),s=ft(a,t.conv2,[1,1]);return(void 0)((void 0)(r,(void 0)(i,s)))})}function je(n,t,e=!1,r=!0){return(void 0)(()=>{let i=(void 0)(e?(void 0)((void 0)(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):ft(n,t.conv0,r?[2,2]:[1,1])),a=ft(i,t.conv1,[1,1]),s=(void 0)((void 0)(i,a)),o=ft(s,t.conv2,[1,1]),l=(void 0)((void 0)(i,(void 0)(a,o))),c=ft(l,t.conv3,[1,1]);return(void 0)((void 0)(i,(void 0)(a,(void 0)(o,c))))})}function te(n,t,e="same",r=!1){return(void 0)(()=>{let i=(void 0)((void 0)(n,t.filters,[1,1],e),t.bias);return r?(void 0)(i):i})}function pt(n,t){Object.keys(n).forEach(e=>{t.some(r=>r.originalPath===e)||n[e].dispose()})}function ve(n,t){return(e,r,i,a)=>{let s=(void 0)(n(e*r*i*i),[i,i,e,r]),o=(void 0)(n(r));return t.push({paramPath:`${a}/filters`},{paramPath:`${a}/bias`}),{filters:s,bias:o}}}function cr(n,t){return(e,r,i)=>{let a=(void 0)(n(e*r),[e,r]),s=(void 0)(n(r));return t.push({paramPath:`${i}/weights`},{paramPath:`${i}/bias`}),{weights:a,bias:s}}}var Ue=class{constructor(t,e,r){this.depthwise_filter=t;this.pointwise_filter=e;this.bias=r}};function xe(n,t){return(e,r,i)=>{let a=(void 0)(n(9*e),[3,3,e,1]),s=(void 0)(n(e*r),[1,1,e,r]),o=(void 0)(n(r));return t.push({paramPath:`${i}/depthwise_filter`},{paramPath:`${i}/pointwise_filter`},{paramPath:`${i}/bias`}),new Ue(a,s,o)}}function we(n){return t=>{let e=n(`${t}/depthwise_filter`,4),r=n(`${t}/pointwise_filter`,4),i=n(`${t}/bias`,1);return new Ue(e,r,i)}}function bt(n,t){return(e,r,i)=>{let a=n[e];if(!Jt(a,r))throw new Error(`expected weightMap[${e}] to be a Tensor${r}D, instead have ${a}`);return t.push({originalPath:e,paramPath:i||e}),a}}function ut(n){let t=n;function e(i){let a=t.slice(0,i);return t=t.slice(i),a}function r(){return t}return{extractWeights:e,getRemainingWeights:r}}function hr(n,t){let e=ve(n,t),r=xe(n,t);function i(s,o,l,c=!1){let p=c?e(s,o,3,`${l}/conv0`):r(s,o,`${l}/conv0`),d=r(o,o,`${l}/conv1`),y=r(o,o,`${l}/conv2`);return{conv0:p,conv1:d,conv2:y}}function a(s,o,l,c=!1){let{conv0:p,conv1:d,conv2:y}=i(s,o,l,c),x=r(o,o,`${l}/conv3`);return{conv0:p,conv1:d,conv2:y,conv3:x}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function On(n){let t=[],{extractWeights:e,getRemainingWeights:r}=ut(n),{extractDenseBlock4Params:i}=hr(e,t),a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),o=i(64,128,"dense2"),l=i(128,256,"dense3");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:o,dense3:l}}}function lr(n){return t=>{let e=n(`${t}/filters`,4),r=n(`${t}/bias`,1);return{filters:e,bias:r}}}function mr(n,t){let e=bt(n,t),r=lr(e),i=we(e);function a(o,l=!1){let c=l?r(`${o}/conv0`):i(`${o}/conv0`),p=i(`${o}/conv1`),d=i(`${o}/conv2`);return{conv0:c,conv1:p,conv2:d}}function s(o,l=!1){let c=l?r(`${o}/conv0`):i(`${o}/conv0`),p=i(`${o}/conv1`),d=i(`${o}/conv2`),y=i(`${o}/conv3`);return{conv0:c,conv1:p,conv2:d,conv3:y}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function Bn(n){let t=[],{extractDenseBlock4Params:e}=mr(n,t),r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return pt(n,t),{params:r,paramMappings:t}}var _e=class extends lt{constructor(){super("FaceFeatureExtractor")}forwardInput(t){let{params:e}=this;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return(void 0)(()=>{let r=(void 0)(t.toBatchTensor(112,!0),"float32"),a=St(r,[122.782,117.001,104.298]).div(255),s=je(a,e.dense0,!0);return s=je(s,e.dense1),s=je(s,e.dense2),s=je(s,e.dense3),s=(void 0)(s,[7,7],[2,2],"valid"),s})}async forward(t){return this.forwardInput(await ot(t))}getDefaultModelName(){return"face_feature_extractor_model"}extractParamsFromWeightMap(t){return Bn(t)}extractParams(t){return On(t)}};function Ge(n,t){return(void 0)(()=>(void 0)((void 0)(n,t.weights),t.bias))}function Wn(n,t,e){let r=[],{extractWeights:i,getRemainingWeights:a}=ut(n),o=cr(i,r)(t,e,"fc");if(a().length!==0)throw new Error(`weights remaing after extract: ${a().length}`);return{paramMappings:r,params:{fc:o}}}function $n(n){let t=[],e=bt(n,t);function r(a){let s=e(`${a}/weights`,2),o=e(`${a}/bias`,1);return{weights:s,bias:o}}let i={fc:r("fc")};return pt(n,t),{params:i,paramMappings:t}}function pr(n){let t={},e={};return Object.keys(n).forEach(r=>{let i=r.startsWith("fc")?e:t;i[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var Te=class extends lt{_faceFeatureExtractor;constructor(t,e){super(t),this._faceFeatureExtractor=e}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(t){let{params:e}=this;if(!e)throw new Error(`${this._name} - load model before inference`);return(void 0)(()=>{let r=t instanceof Nt?this.faceFeatureExtractor.forwardInput(t):t;return Ge(r.as2D(r.shape[0],-1),e.fc)})}dispose(t=!0){this.faceFeatureExtractor.dispose(t),super.dispose(t)}loadClassifierParams(t){let{params:e,paramMappings:r}=this.extractClassifierParams(t);this._params=e,this._paramMappings=r}extractClassifierParams(t){return Wn(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}extractParamsFromWeightMap(t){let{featureExtractorMap:e,classifierMap:r}=pr(t);return this.faceFeatureExtractor.loadFromWeightMap(e),$n(r)}extractParams(t){let e=this.getClassifierChannelsIn(),r=this.getClassifierChannelsOut(),i=r*e+r,a=t.slice(0,t.length-i),s=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)}};var zn=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ht=class{neutral=0;happy=0;sad=0;angry=0;fearful=0;disgusted=0;surprised=0;constructor(t){if(t.length!==7)throw new Error(`FaceExpressions.constructor - expected probabilities.length to be 7, have: ${t.length}`);zn.forEach((e,r)=>{this[e]=t[r]})}asSortedArray(){return zn.map(t=>({expression:t,probability:this[t]})).sort((t,e)=>e.probability-t.probability)}};var ur=class extends Te{constructor(t=new _e){super("FaceExpressionNet",t)}forwardInput(t){return(void 0)(()=>(void 0)(this.runNet(t)))}async forward(t){return this.forwardInput(await ot(t))}async predictExpressions(t){let e=await ot(t),r=await this.forwardInput(e),i=await Promise.all((void 0)(r).map(async s=>{let o=s.dataSync();return s.dispose(),o}));r.dispose();let a=i.map(s=>new Ht(s));return e.isBatchInput?a:a[0]}getDefaultModelName(){return"face_expression_model"}getClassifierChannelsIn(){return 256}getClassifierChannelsOut(){return 7}};function Hn(n){return n.expressions instanceof Ht}function Kr(n,t){return{...n,...{expressions:t}}}function di(n,t,e=.1,r){(Array.isArray(t)?t:[t]).forEach(a=>{let s=a instanceof Ht?a:Hn(a)?a.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");let l=s.asSortedArray().filter(d=>d.probability>e),c=kt(a)?a.detection.box.bottomLeft:r||new G(0,0);new At(l.map(d=>`${d.expression} (${Kt(d.probability)})`),c).draw(n)})}function Pe(n){return kt(n)&&n.landmarks instanceof xt&&n.unshiftedLandmarks instanceof xt&&n.alignedRect instanceof nt}function bi(n){let t=l=>l*180/Math.PI,e=(l,c)=>Math.sqrt((l._x-c._x)**2+(l._y-c._y)**2),r={roll:void 0,pitch:void 0,yaw:void 0},i=(l,c,p)=>{let d=Math.floor(l._x-c._x),y=Math.floor(c._x-p._x);return d-y},a=(l,c)=>{let p=Math.hypot(c._x-l._x,c._y-l._y),d=c._y-l._y,y=Math.asin(d/p),x=t(y),M=Math.floor(90-x),w=c._x-l._x<0?-1:1;return M*w},s=(l,c,p)=>{let d=e(l,p),y={_x:(l._x+p._x)/2,_y:(l._y+p._y)/2},x=e(c,y),M=Math.atan(x/d),w=Math.floor(t(M)),b=y._y-c._y<0?-1:1;return w*b};if(!n||!n._positions||n._positions.length!==68)return r;let o=n._positions;return r.roll=a(o[27],o[66]),r.pitch=s(o[14],o[30],o[2]),r.yaw=i(o[14],o[33],o[2]),r}function Ve(n,t){let{box:e}=n.detection,r=t.shiftBy(e.x,e.y),i=r.align(),{imageDims:a}=n.detection,s=new nt(n.detection.score,i.rescale(a.reverse()),a),o=bi(t);return{...n,...{landmarks:r,unshiftedLandmarks:t,alignedRect:s,angle:o}}}var fr=class{drawLines;drawPoints;lineWidth;pointSize;lineColor;pointColor;constructor(t={}){let{drawLines:e=!0,drawPoints:r=!0,lineWidth:i,lineColor:a,pointSize:s,pointColor:o}=t;this.drawLines=e,this.drawPoints=r,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=o||"rgba(255, 0, 255, 1)"}},dr=class{faceLandmarks;options;constructor(t,e={}){this.faceLandmarks=t,this.options=new fr(e)}draw(t){let e=dt(t),{drawLines:r,drawPoints:i,lineWidth:a,lineColor:s,pointSize:o,pointColor:l}=this.options;if(r&&this.faceLandmarks instanceof ue&&(e.strokeStyle=s,e.lineWidth=a,Rt(e,this.faceLandmarks.getJawOutline()),Rt(e,this.faceLandmarks.getLeftEyeBrow()),Rt(e,this.faceLandmarks.getRightEyeBrow()),Rt(e,this.faceLandmarks.getNose()),Rt(e,this.faceLandmarks.getLeftEye(),!0),Rt(e,this.faceLandmarks.getRightEye(),!0),Rt(e,this.faceLandmarks.getMouth(),!0)),i){e.strokeStyle=l,e.fillStyle=l;let c=p=>{e.beginPath(),e.arc(p.x,p.y,o,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(c)}}};function gi(n,t){(Array.isArray(t)?t:[t]).forEach(r=>{let i=r instanceof xt?r:Pe(r)?r.landmarks:void 0;if(!i)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new dr(i).draw(n)})}var Un="1.7.12";function xi(n,t){let e=ve(n,t),r=xe(n,t);function i(s,o,l){let c=r(s,o,`${l}/separable_conv0`),p=r(o,o,`${l}/separable_conv1`),d=e(s,o,1,`${l}/expansion_conv`);return{separable_conv0:c,separable_conv1:p,expansion_conv:d}}function a(s,o){let l=r(s,s,`${o}/separable_conv0`),c=r(s,s,`${o}/separable_conv1`),p=r(s,s,`${o}/separable_conv2`);return{separable_conv0:l,separable_conv1:c,separable_conv2:p}}return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:a}}function Gn(n,t){let e=[],{extractWeights:r,getRemainingWeights:i}=ut(n),{extractConvParams:a,extractSeparableConvParams:s,extractReductionBlockParams:o,extractMainBlockParams:l}=xi(r,e),c=a(3,32,3,"entry_flow/conv_in"),p=o(32,64,"entry_flow/reduction_block_0"),d=o(64,128,"entry_flow/reduction_block_1"),y={conv_in:c,reduction_block_0:p,reduction_block_1:d},x={};Dt(t,0,1).forEach(g=>{x[`main_block_${g}`]=l(128,`middle_flow/main_block_${g}`)});let M=o(128,256,"exit_flow/reduction_block"),w=s(256,512,"exit_flow/separable_conv"),b={reduction_block:M,separable_conv:w};if(i().length!==0)throw new Error(`weights remaing after extract: ${i().length}`);return{paramMappings:e,params:{entry_flow:y,middle_flow:x,exit_flow:b}}}function wi(n,t){let e=bt(n,t),r=lr(e),i=we(e);function a(o){let l=i(`${o}/separable_conv0`),c=i(`${o}/separable_conv1`),p=r(`${o}/expansion_conv`);return{separable_conv0:l,separable_conv1:c,expansion_conv:p}}function s(o){let l=i(`${o}/separable_conv0`),c=i(`${o}/separable_conv1`),p=i(`${o}/separable_conv2`);return{separable_conv0:l,separable_conv1:c,separable_conv2:p}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:s}}function Vn(n,t){let e=[],{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:s}=wi(n,e),o=r("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),p={conv_in:o,reduction_block_0:l,reduction_block_1:c},d={};Dt(t,0,1).forEach(w=>{d[`main_block_${w}`]=s(`middle_flow/main_block_${w}`)});let y=a("exit_flow/reduction_block"),x=i("exit_flow/separable_conv"),M={reduction_block:y,separable_conv:x};return pt(n,e),{params:{entry_flow:p,middle_flow:d,exit_flow:M},paramMappings:e}}function Yn(n,t,e){return(void 0)((void 0)(n,t.filters,e,"same"),t.bias)}function Qr(n,t,e=!0){let r=e?(void 0)(n):n;return r=ft(r,t.separable_conv0,[1,1]),r=ft((void 0)(r),t.separable_conv1,[1,1]),r=(void 0)(r,[3,3],[2,2],"same"),r=(void 0)(r,Yn(n,t.expansion_conv,[2,2])),r}function _i(n,t){let e=ft((void 0)(n),t.separable_conv0,[1,1]);return e=ft((void 0)(e),t.separable_conv1,[1,1]),e=ft((void 0)(e),t.separable_conv2,[1,1]),e=(void 0)(e,n),e}var br=class extends lt{_numMainBlocks;constructor(t){super("TinyXception"),this._numMainBlocks=t}forwardInput(t){let{params:e}=this;if(!e)throw new Error("TinyXception - load model before inference");return(void 0)(()=>{let r=(void 0)(t.toBatchTensor(112,!0),"float32"),a=St(r,[122.782,117.001,104.298]).div(255),s=(void 0)(Yn(a,e.entry_flow.conv_in,[2,2]));return s=Qr(s,e.entry_flow.reduction_block_0,!1),s=Qr(s,e.entry_flow.reduction_block_1),Dt(this._numMainBlocks,0,1).forEach(o=>{s=_i(s,e.middle_flow[`main_block_${o}`])}),s=Qr(s,e.exit_flow.reduction_block),s=(void 0)(ft(s,e.exit_flow.separable_conv,[1,1])),s})}async forward(t){return this.forwardInput(await ot(t))}getDefaultModelName(){return"tiny_xception_model"}extractParamsFromWeightMap(t){return Vn(t,this._numMainBlocks)}extractParams(t){return Gn(t,this._numMainBlocks)}};function Zn(n){let t=[],{extractWeights:e,getRemainingWeights:r}=ut(n),i=cr(e,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}function Xn(n){let t=[],e=bt(n,t);function r(a){let s=e(`${a}/weights`,2),o=e(`${a}/bias`,1);return{weights:s,bias:o}}let i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return pt(n,t),{params:i,paramMappings:t}}var tn=(e=>(e.FEMALE="female",e.MALE="male",e))(tn||{});var gr=class extends lt{_faceFeatureExtractor;constructor(t=new br(2)){super("AgeGenderNet"),this._faceFeatureExtractor=t}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(t){let{params:e}=this;if(!e)throw new Error(`${this._name} - load model before inference`);return(void 0)(()=>{let r=t instanceof Nt?this.faceFeatureExtractor.forwardInput(t):t,i=(void 0)(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1),a=Ge(i,e.fc.age).as1D(),s=Ge(i,e.fc.gender);return{age:a,gender:s}})}forwardInput(t){return(void 0)(()=>{let{age:e,gender:r}=this.runNet(t);return{age:e,gender:(void 0)(r)}})}async forward(t){return this.forwardInput(await ot(t))}async predictAgeAndGender(t){let e=await ot(t),r=await this.forwardInput(e),i=(void 0)(r.age),a=(void 0)(r.gender),s=i.map((l,c)=>({ageTensor:l,genderTensor:a[c]})),o=await Promise.all(s.map(async({ageTensor:l,genderTensor:c})=>{let p=l.dataSync()[0],d=c.dataSync()[0],y=d>.5,x=y?"male":"female",M=y?d:1-d;return l.dispose(),c.dispose(),{age:p,gender:x,genderProbability:M}}));return r.age.dispose(),r.gender.dispose(),e.isBatchInput?o:o[0]}getDefaultModelName(){return"age_gender_model"}dispose(t=!0){this.faceFeatureExtractor.dispose(t),super.dispose(t)}loadClassifierParams(t){let{params:e,paramMappings:r}=this.extractClassifierParams(t);this._params=e,this._paramMappings=r}extractClassifierParams(t){return Zn(t)}extractParamsFromWeightMap(t){let{featureExtractorMap:e,classifierMap:r}=pr(t);return this.faceFeatureExtractor.loadFromWeightMap(e),Xn(r)}extractParams(t){let r=t.slice(0,t.length-1539),i=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(r),this.extractClassifierParams(i)}};var Ee=class extends Te{postProcess(t,e,r){let i=r.map(({width:s,height:o})=>{let l=e/Math.max(o,s);return{width:s*l,height:o*l}}),a=i.length;return(void 0)(()=>{let s=(d,y)=>(void 0)([(void 0)([68],d,"float32"),(void 0)([68],y,"float32")],1).as2D(1,136).as1D(),o=(d,y)=>{let{width:x,height:M}=i[d];return y(x,M)?Math.abs(x-M)/2:0},l=d=>o(d,(y,x)=>y<x),c=d=>o(d,(y,x)=>x<y);return t.mul((void 0)([a,136],e,"float32")).sub((void 0)(Array.from(Array(a),(d,y)=>s(l(y),c(y))))).div((void 0)(Array.from(Array(a),(d,y)=>s(i[y].width,i[y].height))))})}forwardInput(t){return(void 0)(()=>{let e=this.runNet(t);return this.postProcess(e,t.inputSize,t.inputDimensions.map(([r,i])=>({height:r,width:i})))})}async forward(t){return this.forwardInput(await ot(t))}async detectLandmarks(t){let e=await ot(t),r=(void 0)(()=>(void 0)(this.forwardInput(e))),i=await Promise.all(r.map(async(a,s)=>{let o=Array.from(a.dataSync()),l=o.filter((p,d)=>Qe(d)),c=o.filter((p,d)=>!Qe(d));return new ue(Array(68).fill(0).map((p,d)=>new G(l[d],c[d])),{height:e.getInputHeight(s),width:e.getInputWidth(s)})}));return r.forEach(a=>a.dispose()),e.isBatchInput?i:i[0]}getClassifierChannelsOut(){return 136}};var Fe=class extends Ee{constructor(t=new _e){super("FaceLandmark68Net",t)}getDefaultModelName(){return"face_landmark_68_model"}getClassifierChannelsIn(){return 256}};function qn(n){let t=[],{extractDenseBlock3Params:e}=mr(n,t),r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return pt(n,t),{params:r,paramMappings:t}}function Jn(n){let t=[],{extractWeights:e,getRemainingWeights:r}=ut(n),{extractDenseBlock3Params:i}=hr(e,t),a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),o=i(64,128,"dense2");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:o}}}var yr=class extends lt{constructor(){super("TinyFaceFeatureExtractor")}forwardInput(t){let{params:e}=this;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return(void 0)(()=>{let r=(void 0)(t.toBatchTensor(112,!0),"float32"),a=St(r,[122.782,117.001,104.298]).div(255),s=ar(a,e.dense0,!0);return s=ar(s,e.dense1),s=ar(s,e.dense2),s=(void 0)(s,[14,14],[2,2],"valid"),s})}async forward(t){return this.forwardInput(await ot(t))}getDefaultModelName(){return"face_feature_extractor_tiny_model"}extractParamsFromWeightMap(t){return qn(t)}extractParams(t){return Jn(t)}};var vr=class extends Ee{constructor(t=new yr){super("FaceLandmark68TinyNet",t)}getDefaultModelName(){return"face_landmark_68_tiny_model"}getClassifierChannelsIn(){return 128}};var Kn=class extends Fe{};function Qn(n,t){return(void 0)((void 0)(n,t.weights),t.biases)}function en(n,t,e,r,i="same"){let{filters:a,bias:s}=t.conv,o=(void 0)(n,a,e,i);return o=(void 0)(o,s),o=Qn(o,t.scale),r?(void 0)(o):o}function to(n,t){return en(n,t,[1,1],!0)}function rn(n,t){return en(n,t,[1,1],!1)}function xr(n,t){return en(n,t,[2,2],!0,"valid")}function Ti(n,t){function e(o,l,c){let p=n(o),d=p.length/(l*c*c);if(Hr(d))throw new Error(`depth has to be an integer: ${d}, weights.length: ${p.length}, numFilters: ${l}, filterSize: ${c}`);return(void 0)(()=>(void 0)((void 0)(p,[l,d,c,c]),[2,3,1,0]))}function r(o,l,c,p){let d=e(o,l,c),y=(void 0)(n(l));return t.push({paramPath:`${p}/filters`},{paramPath:`${p}/bias`}),{filters:d,bias:y}}function i(o,l){let c=(void 0)(n(o)),p=(void 0)(n(o));return t.push({paramPath:`${l}/weights`},{paramPath:`${l}/biases`}),{weights:c,biases:p}}function a(o,l,c,p){let d=r(o,l,c,`${p}/conv`),y=i(l,`${p}/scale`);return{conv:d,scale:y}}function s(o,l,c,p,d=!1){let y=a((d?.5:1)*o,l,c,`${p}/conv1`),x=a(o,l,c,`${p}/conv2`);return{conv1:y,conv2:x}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function eo(n){let{extractWeights:t,getRemainingWeights:e}=ut(n),r=[],{extractConvLayerParams:i,extractResidualLayerParams:a}=Ti(t,r),s=i(4704,32,7,"conv32_down"),o=a(9216,32,3,"conv32_1"),l=a(9216,32,3,"conv32_2"),c=a(9216,32,3,"conv32_3"),p=a(36864,64,3,"conv64_down",!0),d=a(36864,64,3,"conv64_1"),y=a(36864,64,3,"conv64_2"),x=a(36864,64,3,"conv64_3"),M=a(147456,128,3,"conv128_down",!0),w=a(147456,128,3,"conv128_1"),b=a(147456,128,3,"conv128_2"),g=a(589824,256,3,"conv256_down",!0),v=a(589824,256,3,"conv256_1"),_=a(589824,256,3,"conv256_2"),T=a(589824,256,3,"conv256_down_out"),D=(void 0)(()=>(void 0)((void 0)(t(256*128),[128,256]),[1,0]));if(r.push({paramPath:"fc"}),e().length!==0)throw new Error(`weights remaing after extract: ${e().length}`);return{params:{conv32_down:s,conv32_1:o,conv32_2:l,conv32_3:c,conv64_down:p,conv64_1:d,conv64_2:y,conv64_3:x,conv128_down:M,conv128_1:w,conv128_2:b,conv256_down:g,conv256_1:v,conv256_2:_,conv256_down_out:T,fc:D},paramMappings:r}}function Pi(n,t){let e=bt(n,t);function r(s){let o=e(`${s}/scale/weights`,1),l=e(`${s}/scale/biases`,1);return{weights:o,biases:l}}function i(s){let o=e(`${s}/conv/filters`,4),l=e(`${s}/conv/bias`,1),c=r(s);return{conv:{filters:o,bias:l},scale:c}}function a(s){return{conv1:i(`${s}/conv1`),conv2:i(`${s}/conv2`)}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function ro(n){let t=[],{extractConvLayerParams:e,extractResidualLayerParams:r}=Pi(n,t),i=e("conv32_down"),a=r("conv32_1"),s=r("conv32_2"),o=r("conv32_3"),l=r("conv64_down"),c=r("conv64_1"),p=r("conv64_2"),d=r("conv64_3"),y=r("conv128_down"),x=r("conv128_1"),M=r("conv128_2"),w=r("conv256_down"),b=r("conv256_1"),g=r("conv256_2"),v=r("conv256_down_out"),{fc:_}=n;if(t.push({originalPath:"fc",paramPath:"fc"}),!zr(_))throw new Error(`expected weightMap[fc] to be a Tensor2D, instead have ${_}`);let T={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:o,conv64_down:l,conv64_1:c,conv64_2:p,conv64_3:d,conv128_down:y,conv128_1:x,conv128_2:M,conv256_down:w,conv256_1:b,conv256_2:g,conv256_down_out:v,fc:_};return pt(n,t),{params:T,paramMappings:t}}function Et(n,t){let e=to(n,t.conv1);return e=rn(e,t.conv2),e=(void 0)(e,n),e=(void 0)(e),e}function Ye(n,t){let e=xr(n,t.conv1);e=rn(e,t.conv2);let r=(void 0)(n,2,2,"valid"),i=(void 0)(r.shape),a=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){let o=[...e.shape];o[1]=1;let l=(void 0)(o);e=(void 0)([e,l],1);let c=[...e.shape];c[2]=1;let p=(void 0)(c);e=(void 0)([e,p],2)}return r=a?(void 0)([r,i],3):r,e=(void 0)(r,e),e=(void 0)(e),e}var De=class extends lt{constructor(){super("FaceRecognitionNet")}forwardInput(t){let{params:e}=this;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return(void 0)(()=>{let r=(void 0)(t.toBatchTensor(150,!0),"float32"),a=St(r,[122.782,117.001,104.298]).div(255),s=xr(a,e.conv32_down);s=(void 0)(s,3,2,"valid"),s=Et(s,e.conv32_1),s=Et(s,e.conv32_2),s=Et(s,e.conv32_3),s=Ye(s,e.conv64_down),s=Et(s,e.conv64_1),s=Et(s,e.conv64_2),s=Et(s,e.conv64_3),s=Ye(s,e.conv128_down),s=Et(s,e.conv128_1),s=Et(s,e.conv128_2),s=Ye(s,e.conv256_down),s=Et(s,e.conv256_1),s=Et(s,e.conv256_2),s=Ye(s,e.conv256_down_out);let o=s.mean([1,2]);return(void 0)(o,e.fc)})}async forward(t){return this.forwardInput(await ot(t))}async computeFaceDescriptor(t){if(t?.shape?.some(a=>a<=0))return new Float32Array(128);let e=await ot(t),r=(void 0)(()=>(void 0)(this.forwardInput(e))),i=await Promise.all(r.map(a=>a.data()));return r.forEach(a=>a.dispose()),e.isBatchInput?i:i[0]}getDefaultModelName(){return"face_recognition_model"}extractParamsFromWeightMap(t){return ro(t)}extractParams(t){return eo(t)}};function Ff(n){let t=new De;return t.extractWeights(n),t}function nn(n,t){return{...n,...{descriptor:t}}}function Lf(n){return typeof n.age=="number"}function on(n,t){return{...n,...{age:t}}}function kf(n){return(n.gender==="male"||n.gender==="female")&&le(n.genderProbability)}function sn(n,t,e){return{...n,...{gender:t,genderProbability:e}}}function Ei(n,t){function e(l,c){let p=(void 0)(n(9*l),[3,3,l,1]),d=(void 0)(n(l)),y=(void 0)(n(l)),x=(void 0)(n(l)),M=(void 0)(n(l));return t.push({paramPath:`${c}/filters`},{paramPath:`${c}/batch_norm_scale`},{paramPath:`${c}/batch_norm_offset`},{paramPath:`${c}/batch_norm_mean`},{paramPath:`${c}/batch_norm_variance`}),{filters:p,batch_norm_scale:d,batch_norm_offset:y,batch_norm_mean:x,batch_norm_variance:M}}function r(l,c,p,d,y){let x=(void 0)(n(l*c*p*p),[p,p,l,c]),M=(void 0)(n(c));return t.push({paramPath:`${d}/filters`},{paramPath:`${d}/${y?"batch_norm_offset":"bias"}`}),{filters:x,bias:M}}function i(l,c,p,d){let{filters:y,bias:x}=r(l,c,p,d,!0);return{filters:y,batch_norm_offset:x}}function a(l,c,p){let d=e(l,`${p}/depthwise_conv`),y=i(l,c,1,`${p}/pointwise_conv`);return{depthwise_conv:d,pointwise_conv:y}}function s(){let l=i(3,32,3,"mobilenetv1/conv_0"),c=a(32,64,"mobilenetv1/conv_1"),p=a(64,128,"mobilenetv1/conv_2"),d=a(128,128,"mobilenetv1/conv_3"),y=a(128,256,"mobilenetv1/conv_4"),x=a(256,256,"mobilenetv1/conv_5"),M=a(256,512,"mobilenetv1/conv_6"),w=a(512,512,"mobilenetv1/conv_7"),b=a(512,512,"mobilenetv1/conv_8"),g=a(512,512,"mobilenetv1/conv_9"),v=a(512,512,"mobilenetv1/conv_10"),_=a(512,512,"mobilenetv1/conv_11"),T=a(512,1024,"mobilenetv1/conv_12"),D=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:c,conv_2:p,conv_3:d,conv_4:y,conv_5:x,conv_6:M,conv_7:w,conv_8:b,conv_9:g,conv_10:v,conv_11:_,conv_12:T,conv_13:D}}function o(){let l=i(1024,256,1,"prediction_layer/conv_0"),c=i(256,512,3,"prediction_layer/conv_1"),p=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),y=i(256,128,1,"prediction_layer/conv_4"),x=i(128,256,3,"prediction_layer/conv_5"),M=i(256,64,1,"prediction_layer/conv_6"),w=i(64,128,3,"prediction_layer/conv_7"),b=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),v=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),T=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),D=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),F=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),P=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),R=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor");return{conv_0:l,conv_1:c,conv_2:p,conv_3:d,conv_4:y,conv_5:x,conv_6:M,conv_7:w,box_predictor_0:{box_encoding_predictor:b,class_predictor:g},box_predictor_1:{box_encoding_predictor:v,class_predictor:_},box_predictor_2:{box_encoding_predictor:T,class_predictor:D},box_predictor_3:{box_encoding_predictor:F,class_predictor:k},box_predictor_4:{box_encoding_predictor:P,class_predictor:S},box_predictor_5:{box_encoding_predictor:R,class_predictor:A}}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:o}}function no(n){let t=[],{extractWeights:e,getRemainingWeights:r}=ut(n),{extractMobilenetV1Params:i,extractPredictionLayerParams:a}=Ei(e,t),s=i(),o=a(),c={extra_dim:(void 0)(e(5118*4),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{params:{mobilenetv1:s,prediction_layer:o,output_layer:c},paramMappings:t}}function Fi(n,t){let e=bt(n,t);function r(c,p,d){let y=e(`${c}/Conv2d_${p}_pointwise/weights`,4,`${d}/filters`),x=e(`${c}/Conv2d_${p}_pointwise/convolution_bn_offset`,1,`${d}/batch_norm_offset`);return{filters:y,batch_norm_offset:x}}function i(c){let p=`mobilenetv1/conv_${c}`,d=`MobilenetV1/Conv2d_${c}_depthwise`,y=`${p}/depthwise_conv`,x=`${p}/pointwise_conv`,M=e(`${d}/depthwise_weights`,4,`${y}/filters`),w=e(`${d}/BatchNorm/gamma`,1,`${y}/batch_norm_scale`),b=e(`${d}/BatchNorm/beta`,1,`${y}/batch_norm_offset`),g=e(`${d}/BatchNorm/moving_mean`,1,`${y}/batch_norm_mean`),v=e(`${d}/BatchNorm/moving_variance`,1,`${y}/batch_norm_variance`);return{depthwise_conv:{filters:M,batch_norm_scale:w,batch_norm_offset:b,batch_norm_mean:g,batch_norm_variance:v},pointwise_conv:r("MobilenetV1",c,x)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(c,p){let d=e(`${c}/weights`,4,`${p}/filters`),y=e(`${c}/biases`,1,`${p}/bias`);return{filters:d,bias:y}}function o(c){let p=s(`Prediction/BoxPredictor_${c}/BoxEncodingPredictor`,`prediction_layer/box_predictor_${c}/box_encoding_predictor`),d=s(`Prediction/BoxPredictor_${c}/ClassPredictor`,`prediction_layer/box_predictor_${c}/class_predictor`);return{box_encoding_predictor:p,class_predictor:d}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:l}}function oo(n){let t=[],{extractMobilenetV1Params:e,extractPredictionLayerParams:r}=Fi(n,t),i=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ct(i))throw new Error(`expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ${i}`);let a={mobilenetv1:e(),prediction_layer:r(),output_layer:{extra_dim:i}};return pt(n,t),{params:a,paramMappings:t}}function wt(n,t,e){return(void 0)(()=>{let r=(void 0)(n,t.filters,e,"same");return r=(void 0)(r,t.batch_norm_offset),(void 0)(r,0,6)})}var Di=.0010000000474974513;function Si(n,t,e){return(void 0)(()=>{let r=(void 0)(n,t.filters,e,"same");return r=(void 0)(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,Di),(void 0)(r,0,6)})}function Mi(n){return[2,4,6,12].some(t=>t===n)?[2,2]:[1,1]}function io(n,t){return(void 0)(()=>{let e,r=wt(n,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((a,s)=>{let o=s+1,l=Mi(o);r=Si(r,a.depthwise_conv,l),r=wt(r,a.pointwise_conv,[1,1]),o===11&&(e=r)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}function Li(n,t,e){let r=n.arraySync(),i=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),s=Math.max(r[t][0],r[t][2]),o=Math.max(r[t][1],r[t][3]),l=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),p=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),y=(s-i)*(o-a),x=(p-l)*(d-c);if(y<=0||x<=0)return 0;let M=Math.max(i,l),w=Math.max(a,c),b=Math.min(s,p),g=Math.min(o,d),v=Math.max(b-M,0)*Math.max(g-w,0);return v/(y+x-v)}function so(n,t,e,r,i){let a=n.shape[0],s=Math.min(e,a),o=t.map((p,d)=>({score:p,boxIndex:d})).filter(p=>p.score>i).sort((p,d)=>d.score-p.score),l=p=>p<=r?1:0,c=[];return o.forEach(p=>{if(c.length>=s)return;let d=p.score;for(let y=c.length-1;y>=0;--y){let x=Li(n,p.boxIndex,c[y]);if(x!==0&&(p.score*=l(x),p.score<=i))break}d===p.score&&c.push(p.boxIndex)}),c}function Ri(n){let t=(void 0)((void 0)(n,[1,0])),e=[(void 0)(t[2],t[0]),(void 0)(t[3],t[1])],r=[(void 0)(t[0],(void 0)(e[0],2)),(void 0)(t[1],(void 0)(e[1],2))];return{sizes:e,centers:r}}function Ci(n,t){let{sizes:e,centers:r}=Ri(n),i=(void 0)((void 0)(t,[1,0])),a=(void 0)((void 0)((void 0)((void 0)(i[2],5)),e[0]),2),s=(void 0)((void 0)((void 0)(i[0],10),e[0]),r[0]),o=(void 0)((void 0)((void 0)((void 0)(i[3],5)),e[1]),2),l=(void 0)((void 0)((void 0)(i[1],10),e[1]),r[1]);return(void 0)((void 0)([(void 0)(s,a),(void 0)(l,o),(void 0)(s,a),(void 0)(l,o)]),[1,0])}function ao(n,t,e){return(void 0)(()=>{let r=n.shape[0],i=Ci((void 0)((void 0)(e.extra_dim,[r,1,1]),[-1,4]),(void 0)(n,[-1,4]));i=(void 0)(i,[r,i.shape[0]/r,4]);let a=(void 0)((void 0)(t,[0,0,1],[-1,-1,-1])),s=(void 0)(a,[0,0,0],[-1,-1,1]);s=(void 0)(s,[r,s.shape[1]]);let o=(void 0)(i),l=(void 0)(s);return{boxes:o,scores:l}})}function ee(n,t){return(void 0)(()=>{let e=n.shape[0],r=(void 0)(te(n,t.box_encoding_predictor),[e,-1,1,4]),i=(void 0)(te(n,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function co(n,t,e){return(void 0)(()=>{let r=wt(n,e.conv_0,[1,1]),i=wt(r,e.conv_1,[2,2]),a=wt(i,e.conv_2,[1,1]),s=wt(a,e.conv_3,[2,2]),o=wt(s,e.conv_4,[1,1]),l=wt(o,e.conv_5,[2,2]),c=wt(l,e.conv_6,[1,1]),p=wt(c,e.conv_7,[2,2]),d=ee(t,e.box_predictor_0),y=ee(n,e.box_predictor_1),x=ee(i,e.box_predictor_2),M=ee(s,e.box_predictor_3),w=ee(l,e.box_predictor_4),b=ee(p,e.box_predictor_5),g=(void 0)([d.boxPredictionEncoding,y.boxPredictionEncoding,x.boxPredictionEncoding,M.boxPredictionEncoding,w.boxPredictionEncoding,b.boxPredictionEncoding],1),v=(void 0)([d.classPrediction,y.classPrediction,x.classPrediction,M.classPrediction,w.classPrediction,b.classPrediction],1);return{boxPredictions:g,classPredictions:v}})}var _t=class{_name="SsdMobilenetv1Options";_minConfidence;_maxResults;constructor({minConfidence:t,maxResults:e}={}){if(this._minConfidence=t||.5,this._maxResults=e||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(`${this._name} - expected minConfidence to be a number between 0 and 1`);if(typeof this._maxResults!="number")throw new Error(`${this._name} - expected maxResults to be a number`)}get minConfidence(){return this._minConfidence}get maxResults(){return this._maxResults}};var re=class extends lt{constructor(){super("SsdMobilenetv1")}forwardInput(t){let{params:e}=this;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return(void 0)(()=>{let r=(void 0)(t.toBatchTensor(512,!1),"float32"),i=(void 0)((void 0)(r,127.5),1),a=io(i,e.mobilenetv1),{boxPredictions:s,classPredictions:o}=co(a.out,a.conv11,e.prediction_layer);return ao(s,o,e.output_layer)})}async forward(t){return this.forwardInput(await ot(t))}async locateFaces(t,e={}){let{maxResults:r,minConfidence:i}=new _t(e),a=await ot(t),{boxes:s,scores:o}=this.forwardInput(a),l=s[0],c=o[0];for(let _=1;_<s.length;_++)s[_].dispose(),o[_].dispose();let p=Array.from(c.dataSync()),y=so(l,p,r,.5,i),x=a.getReshapedInputDimensions(0),M=a.inputSize,w=M/x.width,b=M/x.height,g=l.arraySync(),v=y.map(_=>{let[T,D]=[Math.max(0,g[_][0]),Math.min(1,g[_][2])].map(P=>P*b),[F,k]=[Math.max(0,g[_][1]),Math.min(1,g[_][3])].map(P=>P*w);return new nt(p[_],new pe(F,T,k-F,D-T),{height:a.getInputHeight(0),width:a.getInputWidth(0)})});return l.dispose(),c.dispose(),v}getDefaultModelName(){return"ssd_mobilenetv1_model"}extractParamsFromWeightMap(t){return oo(t)}extractParams(t){return no(t)}};function Ii(n){let t=new re;return t.extractWeights(n),t}function Fd(n){return Ii(n)}var ho=class extends re{};var lo=.4,mo=[new G(.738768,.874946),new G(2.42204,2.65704),new G(4.30971,7.04493),new G(10.246,4.59428),new G(12.6868,11.8741)],po=[new G(1.603231,2.094468),new G(6.041143,7.080126),new G(2.882459,3.518061),new G(4.266906,5.178857),new G(9.041765,10.66308)],uo=[117.001,114.697,97.404],fo="tiny_yolov2_model",bo="tiny_yolov2_separable_conv_model";var wr=n=>typeof n=="number";function go(n){if(!n)throw new Error(`invalid config: ${n}`);if(typeof n.withSeparableConvs!="boolean")throw new Error(`config.withSeparableConvs has to be a boolean, have: ${n.withSeparableConvs}`);if(!wr(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error(`config.iouThreshold has to be a number between [0, 1], have: ${n.iouThreshold}`);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(t=>typeof t=="string"))throw new Error(`config.classes has to be an array class names: string[], have: ${JSON.stringify(n.classes)}`);if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(t=>t||{}).every(t=>wr(t.x)&&wr(t.y)))throw new Error(`config.anchors has to be an array of { x: number, y: number }, have: ${JSON.stringify(n.anchors)}`);if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(wr)))throw new Error(`config.meanRgb has to be an array of shape [number, number, number], have: ${JSON.stringify(n.meanRgb)}`)}function Se(n){return(void 0)(()=>{let t=(void 0)(n,(void 0)(.10000000149011612));return(void 0)((void 0)((void 0)(n,t)),t)})}function Ot(n,t){return(void 0)(()=>{let e=(void 0)(n,[[0,0],[1,1],[1,1],[0,0]]);return e=(void 0)(e,t.conv.filters,[1,1],"valid"),e=(void 0)(e,t.bn.sub),e=(void 0)(e,t.bn.truediv),e=(void 0)(e,t.conv.bias),Se(e)})}function Bt(n,t){return(void 0)(()=>{let e=(void 0)(n,[[0,0],[1,1],[1,1],[0,0]]);return e=(void 0)(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=(void 0)(e,t.bias),Se(e)})}function ki(n,t){let e=ve(n,t);function r(s,o){let l=(void 0)(n(s)),c=(void 0)(n(s));return t.push({paramPath:`${o}/sub`},{paramPath:`${o}/truediv`}),{sub:l,truediv:c}}function i(s,o,l){let c=e(s,o,3,`${l}/conv`),p=r(o,`${l}/bn`);return{conv:c,bn:p}}let a=xe(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function yo(n,t,e,r){let{extractWeights:i,getRemainingWeights:a}=ut(n),s=[],{extractConvParams:o,extractConvWithBatchNormParams:l,extractSeparableConvParams:c}=ki(i,s),p;if(t.withSeparableConvs){let[d,y,x,M,w,b,g,v,_]=r,T=t.isFirstLayerConv2d?o(d,y,3,"conv0"):c(d,y,"conv0"),D=c(y,x,"conv1"),F=c(x,M,"conv2"),k=c(M,w,"conv3"),P=c(w,b,"conv4"),S=c(b,g,"conv5"),R=v?c(g,v,"conv6"):void 0,A=_?c(v,_,"conv7"):void 0,W=o(_||v||g,5*e,1,"conv8");p={conv0:T,conv1:D,conv2:F,conv3:k,conv4:P,conv5:S,conv6:R,conv7:A,conv8:W}}else{let[d,y,x,M,w,b,g,v,_]=r,T=l(d,y,"conv0"),D=l(y,x,"conv1"),F=l(x,M,"conv2"),k=l(M,w,"conv3"),P=l(w,b,"conv4"),S=l(b,g,"conv5"),R=l(g,v,"conv6"),A=l(v,_,"conv7"),W=o(_,5*e,1,"conv8");p={conv0:T,conv1:D,conv2:F,conv3:k,conv4:P,conv5:S,conv6:R,conv7:A,conv8:W}}if(a().length!==0)throw new Error(`weights remaing after extract: ${a().length}`);return{params:p,paramMappings:s}}function Ai(n,t){let e=bt(n,t);function r(o){let l=e(`${o}/sub`,1),c=e(`${o}/truediv`,1);return{sub:l,truediv:c}}function i(o){let l=e(`${o}/filters`,4),c=e(`${o}/bias`,1);return{filters:l,bias:c}}function a(o){let l=i(`${o}/conv`),c=r(`${o}/bn`);return{conv:l,bn:c}}let s=we(e);return{extractConvParams:i,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function vo(n,t){let e=[],{extractConvParams:r,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}=Ai(n,e),s;if(t.withSeparableConvs){let o=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?r("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:o>7?a("conv6"):void 0,conv7:o>8?a("conv7"):void 0,conv8:r("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:r("conv8")};return pt(n,e),{params:s,paramMappings:e}}var Mt=class{_name="TinyYolov2Options";_inputSize;_scoreThreshold;constructor({inputSize:t,scoreThreshold:e}={}){if(this._inputSize=t||416,this._scoreThreshold=e||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(`${this._name} - expected inputSize to be a number divisible by 32`);if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(`${this._name} - expected scoreThreshold to be a number between 0 and 1`)}get inputSize(){return this._inputSize}get scoreThreshold(){return this._scoreThreshold}};var an=class extends lt{_config;constructor(t){super("TinyYolov2"),go(t),this._config=t}get config(){return this._config}get withClassScores(){return this.config.withClassScores||this.config.classes.length>1}get boxEncodingSize(){return 5+(this.withClassScores?this.config.classes.length:0)}runTinyYolov2(t,e){let r=Ot(t,e.conv0);return r=(void 0)(r,[2,2],[2,2],"same"),r=Ot(r,e.conv1),r=(void 0)(r,[2,2],[2,2],"same"),r=Ot(r,e.conv2),r=(void 0)(r,[2,2],[2,2],"same"),r=Ot(r,e.conv3),r=(void 0)(r,[2,2],[2,2],"same"),r=Ot(r,e.conv4),r=(void 0)(r,[2,2],[2,2],"same"),r=Ot(r,e.conv5),r=(void 0)(r,[2,2],[1,1],"same"),r=Ot(r,e.conv6),r=Ot(r,e.conv7),te(r,e.conv8,"valid",!1)}runMobilenet(t,e){let r=this.config.isFirstLayerConv2d?Se(te(t,e.conv0,"valid",!1)):Bt(t,e.conv0);return r=(void 0)(r,[2,2],[2,2],"same"),r=Bt(r,e.conv1),r=(void 0)(r,[2,2],[2,2],"same"),r=Bt(r,e.conv2),r=(void 0)(r,[2,2],[2,2],"same"),r=Bt(r,e.conv3),r=(void 0)(r,[2,2],[2,2],"same"),r=Bt(r,e.conv4),r=(void 0)(r,[2,2],[2,2],"same"),r=Bt(r,e.conv5),r=(void 0)(r,[2,2],[1,1],"same"),r=e.conv6?Bt(r,e.conv6):r,r=e.conv7?Bt(r,e.conv7):r,te(r,e.conv8,"valid",!1)}forwardInput(t,e){let{params:r}=this;if(!r)throw new Error("TinyYolov2 - load model before inference");return(void 0)(()=>{let i=(void 0)(t.toBatchTensor(e,!1),"float32");return i=this.config.meanRgb?St(i,this.config.meanRgb):i,i=i.div(255),this.config.withSeparableConvs?this.runMobilenet(i,r):this.runTinyYolov2(i,r)})}async forward(t,e){return this.forwardInput(await ot(t),e)}async detect(t,e={}){let{inputSize:r,scoreThreshold:i}=new Mt(e),a=await ot(t),s=await this.forwardInput(a,r),o=(void 0)(()=>(void 0)(s)[0].expandDims()),l={width:a.getInputWidth(0),height:a.getInputHeight(0)},c=await this.extractBoxes(o,a.getReshapedInputDimensions(0),i);s.dispose(),o.dispose();let p=c.map(b=>b.box),d=c.map(b=>b.score),y=c.map(b=>b.classScore),x=c.map(b=>this.config.classes[b.label]);return Fn(p.map(b=>b.rescale(r)),d,this.config.iouThreshold,!0).map(b=>new $t(d[b],y[b],x[b],p[b],l))}getDefaultModelName(){return""}extractParamsFromWeightMap(t){return vo(t,this.config)}extractParams(t){let e=this.config.filterSizes||an.DEFAULT_FILTER_SIZES,r=e?e.length:void 0;if(r!==7&&r!==8&&r!==9)throw new Error(`TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ${r} filterSizes in config`);return yo(t,this.config,this.boxEncodingSize,e)}async extractBoxes(t,e,r){let{width:i,height:a}=e,s=Math.max(i,a),o=s/i,l=s/a,c=t.shape[1],p=this.config.anchors.length,[d,y,x]=(void 0)(()=>{let g=t.reshape([c,c,p,this.boxEncodingSize]),v=g.slice([0,0,0,0],[c,c,p,4]),_=g.slice([0,0,0,4],[c,c,p,1]),T=this.withClassScores?(void 0)(g.slice([0,0,0,5],[c,c,p,this.config.classes.length]),3):(void 0)(0);return[v,_,T]}),M=[],w=await y.array(),b=await d.array();for(let g=0;g<c;g++)for(let v=0;v<c;v++)for(let _=0;_<p;_++){let T=er(w[g][v][_][0]);if(!r||T>r){let D=(v+er(b[g][v][_][0]))/c*o,F=(g+er(b[g][v][_][1]))/c*l,k=Math.exp(b[g][v][_][2])*this.config.anchors[_].x/c*o,P=Math.exp(b[g][v][_][3])*this.config.anchors[_].y/c*l,S=D-k/2,R=F-P/2,A={row:g,col:v,anchor:_},{classScore:W,label:z}=this.withClassScores?await this.extractPredictedClass(x,A):{classScore:1,label:0};M.push({box:new me(S,R,S+k,R+P),score:T,classScore:T*W,label:z,...A})}}return d.dispose(),y.dispose(),x.dispose(),M}async extractPredictedClass(t,e){let{row:r,col:i,anchor:a}=e,s=await t.array();return Array(this.config.classes.length).fill(0).map((o,l)=>s[r][i][a][l]).map((o,l)=>({classScore:o,label:l})).reduce((o,l)=>o.classScore>l.classScore?o:l)}},ne=an;mn(ne,"DEFAULT_FILTER_SIZES",[3,16,32,64,128,256,512,1024,1024]);var Me=class extends ne{constructor(t=!0){let e={withSeparableConvs:t,iouThreshold:lo,classes:["face"],...t?{anchors:po,meanRgb:uo}:{anchors:mo,withClassScores:!0}};super(e)}get withSeparableConvs(){return this.config.withSeparableConvs}get anchors(){return this.config.anchors}async locateFaces(t,e){return(await this.detect(t,e)).map(i=>new nt(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight}))}getDefaultModelName(){return this.withSeparableConvs?bo:fo}extractParamsFromWeightMap(t){return super.extractParamsFromWeightMap(t)}};function yb(n,t=!0){let e=new Me(t);return e.extractWeights(n),e}var _r=class extends Mt{_name="TinyFaceDetectorOptions"};var Tt=class{async then(t){return t(await this.run())}async run(){throw new Error("ComposableTask - run is not implemented")}};async function oe(n,t,e,r,i=({alignedRect:a})=>a){let a=n.map(l=>Pe(l)?i(l):l.detection),s=r||(t instanceof void 0?await He(t,a):await ze(t,a)),o=await e(s);return s.forEach(l=>l instanceof void 0&&l.dispose()),o}async function Le(n,t,e,r,i){return oe([n],t,async a=>e(a[0]),r,i)}var xo=.4,wo=[new G(1.603231,2.094468),new G(6.041143,7.080126),new G(2.882459,3.518061),new G(4.266906,5.178857),new G(9.041765,10.66308)],_o=[117.001,114.697,97.404];var Re=class extends ne{constructor(){let t={withSeparableConvs:!0,iouThreshold:xo,classes:["face"],anchors:wo,meanRgb:_o,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};super(t)}get anchors(){return this.config.anchors}async locateFaces(t,e){return(await this.detect(t,e)).map(i=>new nt(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight}))}getDefaultModelName(){return"tiny_face_detector_model"}extractParamsFromWeightMap(t){return super.extractParamsFromWeightMap(t)}};var Q={ssdMobilenetv1:new re,tinyFaceDetector:new Re,tinyYolov2:new Me,faceLandmark68Net:new Fe,faceLandmark68TinyNet:new vr,faceRecognitionNet:new De,faceExpressionNet:new ur,ageGenderNet:new gr},Ni=(n,t)=>Q.ssdMobilenetv1.locateFaces(n,t),Zb=(n,t)=>Q.tinyFaceDetector.locateFaces(n,t),Xb=(n,t)=>Q.tinyYolov2.locateFaces(n,t),Oi=n=>Q.faceLandmark68Net.detectLandmarks(n),qb=n=>Q.faceLandmark68TinyNet.detectLandmarks(n),Jb=n=>Q.faceRecognitionNet.computeFaceDescriptor(n),Kb=n=>Q.faceExpressionNet.predictExpressions(n),Qb=n=>Q.ageGenderNet.predictAgeAndGender(n),Bi=n=>Q.ssdMobilenetv1.load(n),tg=n=>Q.tinyFaceDetector.load(n),eg=n=>Q.tinyYolov2.load(n),rg=n=>Q.faceLandmark68Net.load(n),ng=n=>Q.faceLandmark68TinyNet.load(n),og=n=>Q.faceRecognitionNet.load(n),ig=n=>Q.faceExpressionNet.load(n),sg=n=>Q.ageGenderNet.load(n),ag=Bi,cg=Ni,hg=Oi;var Tr=class extends Tt{constructor(e,r,i){super();this.parentTask=e;this.input=r;this.extractedFaces=i}},ie=class extends Tr{async run(){let t=await this.parentTask,e=await oe(t,this.input,async r=>Promise.all(r.map(i=>Q.faceExpressionNet.predictExpressions(i))),this.extractedFaces);return t.map((r,i)=>Kr(r,e[i]))}withAgeAndGender(){return new ae(this,this.input)}},se=class extends Tr{async run(){let t=await this.parentTask;if(!t)return;let e=await Le(t,this.input,r=>Q.faceExpressionNet.predictExpressions(r),this.extractedFaces);return Kr(t,e)}withAgeAndGender(){return new ce(this,this.input)}},jt=class extends ie{withAgeAndGender(){return new Gt(this,this.input)}withFaceDescriptors(){return new Yt(this,this.input)}},Ut=class extends se{withAgeAndGender(){return new Vt(this,this.input)}withFaceDescriptor(){return new Zt(this,this.input)}};var Pr=class extends Tt{constructor(e,r,i){super();this.parentTask=e;this.input=r;this.extractedFaces=i}},ae=class extends Pr{async run(){let t=await this.parentTask,e=await oe(t,this.input,async r=>Promise.all(r.map(i=>Q.ageGenderNet.predictAgeAndGender(i))),this.extractedFaces);return t.map((r,i)=>{let{age:a,gender:s,genderProbability:o}=e[i];return on(sn(r,s,o),a)})}withFaceExpressions(){return new ie(this,this.input)}},ce=class extends Pr{async run(){let t=await this.parentTask;if(!t)return;let{age:e,gender:r,genderProbability:i}=await Le(t,this.input,a=>Q.ageGenderNet.predictAgeAndGender(a),this.extractedFaces);return on(sn(t,r,i),e)}withFaceExpressions(){return new se(this,this.input)}},Gt=class extends ae{withFaceExpressions(){return new jt(this,this.input)}withFaceDescriptors(){return new Yt(this,this.input)}},Vt=class extends ce{withFaceExpressions(){return new Ut(this,this.input)}withFaceDescriptor(){return new Zt(this,this.input)}};var Er=class extends Tt{constructor(e,r){super();this.parentTask=e;this.input=r}},Yt=class extends Er{async run(){let t=await this.parentTask;return(await oe(t,this.input,r=>Promise.all(r.map(i=>Q.faceRecognitionNet.computeFaceDescriptor(i))),null,r=>r.landmarks.align(null,{useDlibAlignment:!0}))).map((r,i)=>nn(t[i],r))}withFaceExpressions(){return new jt(this,this.input)}withAgeAndGender(){return new Gt(this,this.input)}},Zt=class extends Er{async run(){let t=await this.parentTask;if(!t)return;let e=await Le(t,this.input,r=>Q.faceRecognitionNet.computeFaceDescriptor(r),null,r=>r.landmarks.align(null,{useDlibAlignment:!0}));return nn(t,e)}withFaceExpressions(){return new Ut(this,this.input)}withAgeAndGender(){return new Vt(this,this.input)}};var Fr=class extends Tt{constructor(e,r,i){super();this.parentTask=e;this.input=r;this.useTinyLandmarkNet=i}get landmarkNet(){return this.useTinyLandmarkNet?Q.faceLandmark68TinyNet:Q.faceLandmark68Net}},Dr=class extends Fr{async run(){let t=await this.parentTask,e=t.map(s=>s.detection),r=this.input instanceof void 0?await He(this.input,e):await ze(this.input,e),i=await Promise.all(r.map(s=>this.landmarkNet.detectLandmarks(s)));return r.forEach(s=>s instanceof void 0&&s.dispose()),t.filter((s,o)=>i[o]).map((s,o)=>Ve(s,i[o]))}withFaceExpressions(){return new jt(this,this.input)}withAgeAndGender(){return new Gt(this,this.input)}withFaceDescriptors(){return new Yt(this,this.input)}},Sr=class extends Fr{async run(){let t=await this.parentTask;if(!t)return;let{detection:e}=t,r=this.input instanceof void 0?await He(this.input,[e]):await ze(this.input,[e]),i=await this.landmarkNet.detectLandmarks(r[0]);return r.forEach(a=>a instanceof void 0&&a.dispose()),Ve(t,i)}withFaceExpressions(){return new Ut(this,this.input)}withAgeAndGender(){return new Vt(this,this.input)}withFaceDescriptor(){return new Zt(this,this.input)}};var Mr=class extends Tt{constructor(e,r=new _t){super();this.input=e;this.options=r}},Ze=class extends Mr{async run(){let{input:t,options:e}=this,r;if(e instanceof _r)r=Q.tinyFaceDetector.locateFaces(t,e);else if(e instanceof _t)r=Q.ssdMobilenetv1.locateFaces(t,e);else if(e instanceof Mt)r=Q.tinyYolov2.locateFaces(t,e);else throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");return r}runAndExtendWithFaceDetections(){return new Promise((t,e)=>{this.run().then(r=>t(r.map(i=>fe({},i)))).catch(r=>e(r))})}withFaceLandmarks(t=!1){return new Dr(this.runAndExtendWithFaceDetections(),this.input,t)}withFaceExpressions(){return new ie(this.runAndExtendWithFaceDetections(),this.input)}withAgeAndGender(){return new ae(this.runAndExtendWithFaceDetections(),this.input)}},Lr=class extends Mr{async run(){let t=await new Ze(this.input,this.options),e=t[0];return t.forEach(r=>{r.score>e.score&&(e=r)}),e}runAndExtendWithFaceDetection(){return new Promise(async t=>{let e=await this.run();t(e?fe({},e):void 0)})}withFaceLandmarks(t=!1){return new Sr(this.runAndExtendWithFaceDetection(),this.input,t)}withFaceExpressions(){return new se(this.runAndExtendWithFaceDetection(),this.input)}withAgeAndGender(){return new ce(this.runAndExtendWithFaceDetection(),this.input)}};function sy(n,t=new _t){return new Lr(n,t)}function cn(n,t=new _t){return new Ze(n,t)}async function Wi(n,t){return cn(n,new _t(t?{minConfidence:t}:{})).withFaceLandmarks().withFaceDescriptors()}async function py(n,t={}){return cn(n,new Mt(t)).withFaceLandmarks().withFaceDescriptors()}var uy=Wi;function To(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");let e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map((i,a)=>i-r[a]).reduce((i,a)=>i+a*a,0))}var Rr=class{_labeledDescriptors;_distanceThreshold;constructor(t,e=.6){this._distanceThreshold=e;let r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");let i=1,a=()=>`person ${i++}`;this._labeledDescriptors=r.map(s=>{if(s instanceof It)return s;if(s instanceof Float32Array)return new It(a(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new It(a(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}get labeledDescriptors(){return this._labeledDescriptors}get distanceThreshold(){return this._distanceThreshold}computeMeanDistance(t,e){return e.map(r=>To(r,t)).reduce((r,i)=>r+i,0)/(e.length||1)}matchDescriptor(t){return this.labeledDescriptors.map(({descriptors:e,label:r})=>new Be(r,this.computeMeanDistance(t,e))).reduce((e,r)=>e.distance<r.distance?e:r)}findBestMatch(t){let e=this.matchDescriptor(t);return e.distance<this._distanceThreshold?e:new Be("unknown",e.distance)}toJSON(){return{distanceThreshold:this._distanceThreshold,labeledDescriptors:this._labeledDescriptors.map(t=>t.toJSON())}}static fromJSON(t){let e=t.labeledDescriptors.map(r=>It.fromJSON(r));return new Rr(e,t.distanceThreshold)}};function Ry(n){let t=new Re;return t.extractWeights(n),t}function $i(n,t){let{width:e,height:r}=new mt(t.width,t.height);if(e<=0||r<=0)throw new Error(`resizeResults - invalid dimensions: ${JSON.stringify({width:e,height:r})}`);if(Array.isArray(n))return n.map(i=>$i(i,{width:e,height:r}));if(Pe(n)){let i=n.detection.forSize(e,r),a=n.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Ve(fe(n,i),a)}return kt(n)?fe(n,n.detection.forSize(e,r)):n instanceof xt||n instanceof nt?n.forSize(e,r):n}var Hy=Un;export{gr as AgeGenderNet,me as BoundingBox,tt as Box,Tt as ComposableTask,Yt as ComputeAllFaceDescriptorsTask,Er as ComputeFaceDescriptorsTaskBase,Zt as ComputeSingleFaceDescriptorTask,Dr as DetectAllFaceLandmarksTask,Ze as DetectAllFacesTask,Fr as DetectFaceLandmarksTaskBase,Mr as DetectFacesTaskBase,Sr as DetectSingleFaceLandmarksTask,Lr as DetectSingleFaceTask,mt as Dimensions,zn as FACE_EXPRESSION_LABELS,nt as FaceDetection,ho as FaceDetectionNet,ur as FaceExpressionNet,Ht as FaceExpressions,Fe as FaceLandmark68Net,vr as FaceLandmark68TinyNet,Kn as FaceLandmarkNet,xt as FaceLandmarks,Sn as FaceLandmarks5,ue as FaceLandmarks68,Be as FaceMatch,Rr as FaceMatcher,De as FaceRecognitionNet,tn as Gender,We as LabeledBox,It as LabeledFaceDescriptors,Nt as NetInput,lt as NeuralNetwork,$t as ObjectDetection,G as Point,Mn as PredictedBox,pe as Rect,re as SsdMobilenetv1,_t as SsdMobilenetv1Options,Re as TinyFaceDetector,_r as TinyFaceDetectorOptions,Me as TinyYolov2,Mt as TinyYolov2Options,uy as allFaces,Wi as allFacesSsdMobilenetv1,py as allFacesTinyYolov2,Ln as awaitMediaLoaded,Rn as bufferToImage,Jb as computeFaceDescriptor,ye as createCanvas,ir as createCanvasFromMedia,Fd as createFaceDetectionNet,Ff as createFaceRecognitionNet,Ii as createSsdMobilenetv1,Ry as createTinyFaceDetector,yb as createTinyYolov2,cn as detectAllFaces,Oi as detectFaceLandmarks,qb as detectFaceLandmarksTiny,hg as detectLandmarks,sy as detectSingleFace,jn as draw,K as env,To as euclideanDistance,on as extendWithAge,nn as extendWithFaceDescriptor,fe as extendWithFaceDetection,Kr as extendWithFaceExpressions,Ve as extendWithFaceLandmarks,sn as extendWithGender,He as extractFaceTensors,ze as extractFaces,Ah as fetchImage,kn as fetchJson,$h as fetchNetWeights,zt as fetchOrThrow,Vh as fetchVideo,dt as getContext2dOrThrow,ge as getMediaDimensions,Cn as imageTensorToCanvas,In as imageToSquare,Js as inverseSigmoid,Pn as iou,Jr as isMediaElement,or as isMediaLoaded,Lf as isWithAge,kt as isWithFaceDetection,Hn as isWithFaceExpressions,Pe as isWithFaceLandmarks,kf as isWithGender,sg as loadAgeGenderModel,ag as loadFaceDetectionModel,ig as loadFaceExpressionModel,rg as loadFaceLandmarkModel,ng as loadFaceLandmarkTinyModel,og as loadFaceRecognitionModel,Bi as loadSsdMobilenetv1Model,tg as loadTinyFaceDetectorModel,eg as loadTinyYolov2Model,Nn as loadWeightMap,cg as locateFaces,Qh as matchDimensions,En as minBbox,Q as nets,Fn as nonMaxSuppression,St as normalize,Dn as padToSquare,Qb as predictAgeAndGender,Kb as recognizeFaceExpressions,$i as resizeResults,de as resolveInput,Xs as shuffleArray,er as sigmoid,Ni as ssdMobilenetv1,m as tf,Zb as tinyFaceDetector,Xb as tinyYolov2,ot as toNetInput,Tn as utils,go as validateConfig,Hy as version};
